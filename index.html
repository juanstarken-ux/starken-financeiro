<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STARK Intelligence - Dashboard Financeiro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="auth.js"></script>
    <script src="theme.js"></script>
    <script src="js/stark-core.js"></script>
    <script src="js/stark-realtime.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        .client-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            border: 2px dashed #3b82f6;
        }
        
        .clients-grid {
            min-height: 100px; /* Permitir drop em grid vazia */
        }

        /* Ocultar menu Gest√£o por padr√£o - ser√° mostrado apenas para CEO */
        #menu-gestao-financeira {
            display: none !important;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #4A6B54;
            --secondary-green: #7A9B84;
            --light-green: #B8D4BE;
            --bg-gray: #f5f7fa;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #e1e8ed;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-gray);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: var(--primary-green);
            color: var(--white);
            padding: 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo-image {
            width: 140px;
            height: auto;
            display: block;
            margin: 0 auto 15px;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--white);
            text-align: center;
            letter-spacing: 1px;
            display: none;
        }

        .company-info {
            text-align: center;
            font-size: 11px;
            color: rgba(255,255,255,0.7);
            margin-top: 8px;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            padding: 14px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background-color: rgba(255,255,255,0.1);
            color: var(--white);
            border-left-color: var(--light-green);
        }

        .nav-item.active {
            background-color: rgba(255,255,255,0.15);
            color: var(--white);
            border-left-color: var(--white);
            font-weight: 600;
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 30px;
        }

        .page-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
        }

        .page-header-content {
            flex: 1;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-light);
            font-size: 14px;
        }

        #user-info {
            display: flex;
            align-items: center;
        }

        /* KPI Cards */
        .kpi-sections-container {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 28px;
        }

        .kpi-section {
            border: 1px solid var(--border-color);
            background: #f8fafc;
            padding: 16px;
            border-radius: 16px;
        }

        .kpi-section-title {
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
        }

        .kpi-section.total {
            --kpi-accent: #1f7a5f;
            --kpi-soft: #eef7f3;
        }

        .kpi-section.starken {
            --kpi-accent: #1f6e43;
            --kpi-soft: #ecf7f1;
        }

        .kpi-section.alpha {
            --kpi-accent: #9a6b00;
            --kpi-soft: #fff6db;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-section .kpi-grid {
            margin-bottom: 0;
        }

        .kpi-card {
            background: linear-gradient(145deg, #ffffff 0%, var(--kpi-soft, #f6f8fa) 100%);
            padding: 18px;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(15,23,42,0.08);
            border: 1px solid #e5ebf0;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--kpi-accent, #4A6B54);
        }

        .kpi-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 26px rgba(15,23,42,0.12);
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .kpi-title {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.7px;
        }

        .kpi-icon {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .kpi-value {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 6px;
        }

        .kpi-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .kpi-change.positive {
            color: var(--success);
        }

        .kpi-change.negative {
            color: var(--danger);
        }

        /* Charts Section */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Tables */
        .data-table {
            width: 100%;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--bg-gray);
        }

        th {
            padding: 15px 25px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 18px 25px;
            border-top: 1px solid var(--border-color);
            font-size: 14px;
        }

        tr:hover {
            background-color: var(--bg-gray);
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            display: inline-block;
        }

        .status-badge.pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-badge.paid {
            background-color: #d4edda;
            color: #155724;
        }

        .status-badge.overdue {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Grid Layout */
        .grid-2col {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .grid-2col {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Clients Section */
        .clients-section {
            margin: 40px 0;
            padding: 30px;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .section-header-clients {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-title-clients {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .section-subtitle-clients {
            font-size: 14px;
            color: var(--text-light);
        }

        .clients-tabs {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .client-tab {
            padding: 12px 24px;
            border: 2px solid var(--border-color);
            background: var(--white);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .client-tab:hover {
            border-color: var(--primary-green);
            background: var(--bg-gray);
        }

        .client-tab.active {
            background: var(--primary-green);
            color: var(--white);
            border-color: var(--primary-green);
        }

        .tab-icon {
            font-size: 18px;
        }

        .clients-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            animation: fadeIn 0.5s ease;
        }

        @media (max-width: 1200px) {
            .clients-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 900px) {
            .clients-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .clients-grid {
                grid-template-columns: 1fr;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .client-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            padding: 0;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .client-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 6px;
            height: 100%;
            background: linear-gradient(180deg, #4CAF50 0%, #45a049 100%);
            transition: width 0.3s ease;
        }

        .client-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 28px rgba(0,0,0,0.15);
            border-color: #4CAF50;
        }

        .client-card:hover::before {
            width: 8px;
        }

        .client-card.new-client {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #4CAF50;
            position: relative;
        }

        .client-card.new-client::before {
            content: '‚ú® NOVO';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #4CAF50;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .client-card.projecao-client {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border: 2px solid #FFC107;
            position: relative;
        }

        .client-card.projecao-client::before {
            content: 'üìä PROJE√á√ÉO';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #FFC107;
            color: #333;
            font-size: 10px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 10px;
        }

        /* Card aguardando renova√ß√£o */
        .client-card.aguardando-client {
            background: linear-gradient(135deg, #f5f5f5 0%, #eeeeee 100%);
            border: 2px solid #bdbdbd;
            opacity: 0.85;
        }

        .client-card.aguardando-client .client-value {
            color: #757575;
            background: rgba(0,0,0,0.05);
        }

        /* Card renova√ß√£o MRR */
        .client-card.renovacao-client {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border: 2px solid #4CAF50;
            position: relative;
        }

        .client-card.renovacao-client::before {
            content: 'üîÑ RENOVA√á√ÉO';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #4CAF50;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .client-card.renovacao-client .client-value {
            color: #2e7d32;
            background: rgba(46, 125, 50, 0.1);
        }

        .client-logo {
            font-size: 36px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .client-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
            flex-shrink: 0;
            line-height: 1.2;
        }

        .client-category {
            font-size: 11px;
            color: var(--text-light);
            margin-bottom: 8px;
            flex-grow: 0;
        }

        .client-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-green);
            padding: 6px 10px;
            background: rgba(74, 107, 84, 0.1);
            border-radius: 8px;
            display: inline-block;
            flex-shrink: 0;
        }

        /* Utility Classes */
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .text-muted { color: var(--text-light); }

        .bg-primary { background-color: var(--primary-green); }
        .bg-success { background-color: #d4edda; }
        .bg-warning { background-color: #fff3cd; }
        .bg-danger { background-color: #f8d7da; }

        .mb-30 { margin-bottom: 30px; }
        .mt-20 { margin-top: 20px; }

        /* Client Badge */
        .client-badge {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 4px;
            background-color: var(--light-green);
            color: var(--primary-green);
            font-weight: 600;
            margin-left: 8px;
        }

        /* Modern Client Tables */
        .client-tables-container {
            margin-top: 30px;
        }

        .client-table-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .tables-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        @media (max-width: 1200px) {
            .tables-grid {
                grid-template-columns: 1fr;
            }
        }

        .company-table-card {
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 2px solid var(--border-color);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .company-table-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .starken-card {
            border-top: 4px solid var(--primary-green);
        }

        .alpha-card {
            border-top: 4px solid #7A9B84;
        }

        .company-table-header {
            background: linear-gradient(135deg, #f8faf9 0%, #ffffff 100%);
            padding: 24px 28px;
            display: flex;
            align-items: center;
            gap: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .company-icon {
            width: 56px;
            height: 56px;
            background: var(--primary-green);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 4px 12px rgba(74, 107, 84, 0.2);
        }

        .alpha-icon {
            background: linear-gradient(135deg, #7A9B84 0%, #B8D4BE 100%);
        }

        .company-info {
            flex: 1;
        }

        .company-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .company-label {
            font-size: 13px;
            color: var(--text-light);
            font-weight: 500;
        }

        .company-stats {
            text-align: right;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .table-wrapper {
            padding: 0;
        }

        .modern-table {
            width: 100%;
            border-collapse: collapse;
        }

        .modern-table thead {
            background: var(--bg-gray);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modern-table th {
            padding: 14px 20px;
            text-align: left;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-bottom: 2px solid var(--border-color);
        }

        .modern-table td {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
            color: var(--text-dark);
        }

        .modern-table tbody tr:hover {
            background: #f8faf9;
        }

        .modern-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Badges */
        .badge-active, .badge-new, .badge-completed, .badge-pending,
        .badge-tcv, .badge-bonus, .badge-transition {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            display: inline-block;
        }

        .badge-active {
            background: #6b7280;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-new {
            background: #cfe2ff;
            color: #084298;
        }

        .badge-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-pending {
            background: #fff3cd;
            color: #856404;
        }

        .badge-tcv {
            background: #9333ea;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-bonus {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-transition {
            background: #fff3cd;
            color: #856404;
        }

        /* Month Selector */
        .month-selector-container {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: var(--white);
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .month-selector-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-light);
        }

        .month-select {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: var(--white);
            color: var(--text-dark);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            outline: none;
        }

        .month-select:hover {
            border-color: var(--primary-green);
        }

        .month-select:focus {
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(74, 107, 84, 0.1);
        }

        .badge-outbound {
            background: #f59e0b;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-envio {
            background: #3b82f6;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-growth {
            background: #10b981;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-projecao {
            font-size: 12px;
        }

        .badge-projecao-status {
            background-color: #FFC107;
            color: #333;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-renovacao {
            background-color: #4CAF50;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        /* Bot√£o Novo Cliente */
        .btn-add-client {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-green) 0%, #5d8a6b 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(74, 107, 84, 0.3);
        }

        .btn-add-client:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 107, 84, 0.4);
        }

        .btn-add-client:active {
            transform: translateY(0);
        }

        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }

        /* Modal de Novo Cliente */
        .client-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .client-modal-overlay.active {
            display: flex;
        }

    .client-modal {
        background: white;
        border-radius: 16px;
        width: 95%; /* Aumentado de 90% para 95% */
        max-width: 1000px; /* Aumentado de 900px para 1000px */
        max-height: 95vh; /* Aumentado de 90vh para 95vh */
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.3s ease;
        margin: 20px;
    }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, #f8faf9 0%, #ffffff 100%);
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-gray);
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-light);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #ffebee;
            color: #e74c3c;
        }

        .modal-body {
        padding: 40px 60px; /* Aumentado padding interno (mais espa√ßo nas laterais) */
    }

    .form-group {
        margin-bottom: 32px; /* Mais espa√ßo entre campos */
    }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px 12px; /* Reduzido de 12px 16px */
            border: 2px solid var(--border-color);
            border-radius: 8px; /* Reduzido de 10px */
            font-size: 13px; /* Reduzido de 14px */
            color: var(--text-dark);
            background: white;
            transition: all 0.2s ease;
            height: 38px; /* Altura fixa controlada */
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 4px rgba(74, 107, 84, 0.1);
        }

        .form-group input::placeholder {
            color: var(--text-light);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            background: var(--bg-gray);
            border-radius: 0 0 16px 16px;
        }

        .btn-cancel {
            padding: 12px 24px;
            border: 2px solid var(--border-color);
            background: white;
            color: var(--text-dark);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-cancel:hover {
            border-color: var(--text-light);
            background: var(--bg-gray);
        }

        .btn-save {
            padding: 12px 24px;
            border: none;
            background: linear-gradient(135deg, var(--primary-green) 0%, #5d8a6b 100%);
            color: white;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(74, 107, 84, 0.3);
        }

        .btn-save:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(74, 107, 84, 0.4);
        }

        /* Clientes Manuais Badge */
        /* Estilos manual-client removidos - todos os cards t√™m o mesmo visual */

        /* Card de Renova√ß√£o (apenas informativo) */
        .renovacao-card {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 2px dashed #f59e0b !important;
            opacity: 0.85;
        }

        .renovacao-card:hover {
            opacity: 1;
            border-color: #d97706 !important;
        }

        /* Card de Proje√ß√£o (futuro/n√£o faturado) */
        .projecao-card {
            background: linear-gradient(135deg, #fefce8 0%, #fef08a 100%);
            border: 2px solid #eab308 !important;
            position: relative;
        }

        .projecao-card::before {
            content: 'üìä PROJE√á√ÉO';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #eab308;
            color: #713f12;
            font-size: 10px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 10px;
            z-index: 1;
        }

        .projecao-card:hover {
            border-color: #ca8a04 !important;
            box-shadow: 0 4px 12px rgba(234, 179, 8, 0.3);
        }

        .btn-delete-client {
            position: absolute;
            top: 8px;
            left: 8px;
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .client-card:hover .btn-delete-client {
            display: flex;
        }

        .btn-delete-client:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        /* Anima√ß√£o de exclus√£o */
        @keyframes fadeOutScale {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.8);
            }
        }

        .client-card.deleting {
            animation: fadeOutScale 0.3s ease-out forwards;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="logo-starken.png" alt="STARK Intelligence" class="logo-image">
                <div class="company-info">STARK Intelligence<br>Starken Tecnologia Ltda</div>
            </div>
            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item active">
                    <span class="nav-icon">üìä</span>
                    Dashboard Financeiro
                </a>
                <a href="pages/dashboard-comercial.html" class="nav-item">
                    <span class="nav-icon">üíº</span>
                    Dashboard Comercial
                </a>

                <div class="nav-separator"></div>

                <a href="pages/stark.html" class="nav-item">
                    <span class="nav-icon">‚ö°</span>
                    STARK - CFO Virtual
                </a>

                <div class="nav-separator"></div>

                <!-- Menu Gest√£o Financeira Expans√≠vel -->
                <div class="nav-item nav-item-expandable" data-menu="submenu-gestao" onclick="ThemeManager.toggleSubMenu('submenu-gestao')">
                    <span class="nav-icon">üí∞</span>
                    Gest√£o Financeira
                    <span class="menu-arrow">‚ñ∂</span>
                </div>
                <div id="submenu-gestao" class="submenu">
                    <a href="pages/contas-pagar.html" class="nav-item">
                        <span class="nav-icon">üí≥</span>
                        Contas a Pagar
                    </a>
                    <a href="pages/contas-receber.html" class="nav-item">
                        <span class="nav-icon">ü§ë</span>
                        Contas a Receber
                    </a>
                    <a href="pages/fluxo-caixa.html" class="nav-item">
                        <span class="nav-icon">üìà</span>
                        Fluxo de Caixa
                    </a>
                    <a href="pages/financeiro-pessoal.html" class="nav-item">
                        <span class="nav-icon">üîê</span>
                        Finan√ßas Pessoais
                    </a>
                </div>

                <div class="nav-separator"></div>

                <a href="pages/dre.html" class="nav-item">
                    <span class="nav-icon">üìã</span>
                    DRE
                </a>
                <a href="pages/analiticos.html" class="nav-item">
                    <span class="nav-icon">üîç</span>
                    Anal√≠ticos
                </a>
                <a href="pages/relatorios.html" class="nav-item">
                    <span class="nav-icon">üìÑ</span>
                    Relat√≥rios
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">Dashboard Financeiro</h1>
                    <p class="page-subtitle" id="page-subtitle">Vis√£o geral do desempenho financeiro - <span id="periodo-atual">Carregando...</span></p>
                </div>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <!-- Month Selector - ser√° preenchido dinamicamente -->
                    <div class="month-selector-container">
                        <span class="month-selector-label">üìÖ Per√≠odo:</span>
                        <select class="month-select" id="monthSelector" onchange="changeMes(this.value)">
                            <!-- Op√ß√µes ser√£o geradas dinamicamente -->
                        </select>
                    </div>

                    <div id="user-info">
                        <!-- Informa√ß√µes do usu√°rio ser√£o inseridas aqui pelo JavaScript -->
                    </div>
                </div>
            </div>

            <!-- KPI Sections -->
            <div class="kpi-sections-container">
                
                <!-- TOTAL Section -->
                <div class="kpi-section total">
                    <h3 class="kpi-section-title">üìä Total Consolidado</h3>
                    <div class="kpi-grid">
                        <!-- MRR Total -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Receita Total</div><div class="kpi-icon bg-success">üí∞</div></div>
                            <div class="kpi-value" id="kpi-total-mrr">R$ 0</div>
                            <div class="kpi-change" id="kpi-total-mrr-change">Starken + Alpha</div>
                        </div>
                        <!-- Clientes Total -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Clientes Ativos</div><div class="kpi-icon bg-primary">üë•</div></div>
                            <div class="kpi-value" id="kpi-total-clientes">0</div>
                            <div class="kpi-change" id="kpi-total-clientes-breakdown">0 Starken + 0 Alpha</div>
                        </div>
                        <!-- Despesas Total -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Despesas Totais</div><div class="kpi-icon bg-warning">üí∏</div></div>
                            <div class="kpi-value" id="kpi-total-despesas">R$ 0</div>
                            <div class="kpi-change">Operacional + Royalties</div>
                        </div>
                        <!-- Resultado Total -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Resultado L√≠quido</div><div class="kpi-icon bg-success">üíé</div></div>
                            <div class="kpi-value" id="kpi-total-resultado">R$ 0</div>
                            <div class="kpi-change" id="kpi-total-margem">0% de margem</div>
                        </div>
                    </div>
                </div>

                <!-- STARKEN Section -->
                <div class="kpi-section starken">
                    <h3 class="kpi-section-title">üöÄ Starken (Opera√ß√£o)</h3>
                    <div class="kpi-grid">
                         <!-- MRR Starken -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Receita Starken</div><div class="kpi-icon bg-success">üí∞</div></div>
                            <div class="kpi-value" id="kpi-starken-mrr">R$ 0</div>
                        </div>
                         <!-- Clientes Starken -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Clientes Ativos</div><div class="kpi-icon bg-primary">üë•</div></div>
                            <div class="kpi-value" id="kpi-starken-clientes">0</div>
                        </div>
                         <!-- Despesas Starken -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Despesas Operacionais</div><div class="kpi-icon bg-warning">üí∏</div></div>
                            <div class="kpi-value" id="kpi-starken-despesas">R$ 0</div>
                        </div>
                         <!-- Resultado Starken -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Resultado Starken</div><div class="kpi-icon bg-success">üìä</div></div>
                            <div class="kpi-value" id="kpi-starken-resultado">R$ 0</div>
                        </div>
                    </div>
                </div>

                <!-- ALPHA Section -->
                <div class="kpi-section alpha">
                    <h3 class="kpi-section-title">‚≠ê Alpha (Projeto)</h3>
                    <div class="kpi-grid">
                         <!-- MRR Alpha -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Receita Alpha</div><div class="kpi-icon bg-success">üí∞</div></div>
                            <div class="kpi-value" id="kpi-alpha-mrr">R$ 0</div>
                        </div>
                         <!-- Clientes Alpha -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Clientes Ativos</div><div class="kpi-icon bg-primary">üë•</div></div>
                            <div class="kpi-value" id="kpi-alpha-clientes">0</div>
                        </div>
                         <!-- Royalties/Despesas Alpha -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Royalties & Taxas</div><div class="kpi-icon bg-warning">üí∏</div></div>
                            <div class="kpi-value" id="kpi-alpha-despesas">R$ 0</div>
                        </div>
                         <!-- Resultado Alpha -->
                        <div class="kpi-card">
                            <div class="kpi-header"><div class="kpi-title">Resultado Alpha</div><div class="kpi-icon bg-success">üìä</div></div>
                            <div class="kpi-value" id="kpi-alpha-resultado">R$ 0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Evolu√ß√£o da Receita (√öltimos 6 Meses)</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Despesas por Categoria</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="expensesChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Clientes Ativos Section -->
            <div class="clients-section">
                <div class="section-header-clients" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                    <div>
                        <h2 class="section-title-clients">Clientes Ativos</h2>
                        <p class="section-subtitle-clients">Portf√≥lio atual de 0 clientes da Starken e Alpha</p>
                    </div>
                    <button class="btn-add-client" onclick="openClientModal()">
                        <span>‚ûï</span> Novo Cliente
                    </button>
                </div>

                <div class="clients-tabs">
                    <button class="client-tab active" onclick="showClientTab('starken')" id="tab-starken">
                        <span class="tab-icon">üöÄ</span>
                        <span class="tab-label" id="starken-tab-label">Starken (0)</span>
                    </button>
                    <button class="client-tab" onclick="showClientTab('alpha')" id="tab-alpha">
                        <span class="tab-icon">‚≠ê</span>
                        <span class="tab-label" id="alpha-tab-label">Alpha (0)</span>
                    </button>
                </div>

                <!-- Barra de Busca -->
                <div style="padding: 16px 20px; background: white; border-radius: 12px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="flex: 1; position: relative;">
                            <input
                                type="text"
                                id="searchClientInput"
                                placeholder="üîç Buscar cliente por nome..."
                                style="width: 100%; padding: 12px 16px 12px 44px; border: 2px solid #e1e8ed; border-radius: 10px; font-size: 14px; transition: all 0.2s ease;"
                                oninput="searchClients(this.value)"
                                onfocus="this.style.borderColor='#4A6B54'; this.style.boxShadow='0 0 0 4px rgba(74,107,84,0.1)'"
                                onblur="this.style.borderColor='#e1e8ed'; this.style.boxShadow='none'"
                            >
                            <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 18px;">üîç</span>
                        </div>
                        <button
                            onclick="clearSearch()"
                            style="padding: 12px 20px; background: #f5f7fa; border: 2px solid #e1e8ed; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; color: #7f8c8d; transition: all 0.2s ease;"
                            onmouseover="this.style.background='#e1e8ed'"
                            onmouseout="this.style.background='#f5f7fa'"
                        >
                            ‚úï Limpar
                        </button>
                        <button
                            onclick="syncClientsNow()"
                            id="btnSyncClients"
                            style="padding: 12px 20px; background: #0ea5e9; border: none; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; color: white; transition: all 0.2s ease;"
                            onmouseover="this.style.background='#0284c7'"
                            onmouseout="this.style.background='#0ea5e9'"
                        >
                            üîÑ Sincronizar agora
                        </button>
                        <button
                            onclick="togglePainelMeses()"
                            id="btnPainelMeses"
                            style="padding: 12px 20px; background: #4A6B54; border: none; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; color: white; transition: all 0.2s ease;"
                            onmouseover="this.style.background='#3d5a45'"
                            onmouseout="this.style.background='#4A6B54'"
                        >
                            üìÖ Ver Calend√°rio de Clientes
                        </button>
                    </div>
                    <div id="searchResults" style="margin-top: 12px; display: none;">
                        <div style="font-size: 13px; color: #7f8c8d; margin-bottom: 8px;">
                            <strong id="searchCount">0</strong> cliente(s) encontrado(s)
                        </div>
                        <div id="searchMeses" style="font-size: 12px; color: #4A6B54; padding: 8px; background: #f0fdf4; border-radius: 8px; display: none;">
                            <!-- Meses onde o cliente aparece -->
                        </div>
                    </div>
                </div>

                <!-- Painel de Calend√°rio de Clientes -->
                <div id="painelCalendario" style="display: none; padding: 20px; background: white; border-radius: 12px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="margin: 0; color: #2c3e50; font-size: 18px;">
                            üìÖ Calend√°rio de Visibilidade dos Clientes
                        </h3>
                        <button
                            onclick="togglePainelMeses()"
                            style="padding: 8px 16px; background: #f5f7fa; border: 2px solid #e1e8ed; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: #7f8c8d;"
                        >
                            ‚úï Fechar
                        </button>
                    </div>
                    <p style="margin: 0 0 16px 0; color: #7f8c8d; font-size: 14px;">
                        Veja em quais meses cada cliente aparece no dashboard
                    </p>
                    <div id="calendarioContent" style="max-height: 500px; overflow-y: auto;">
                        <!-- Conte√∫do ser√° gerado dinamicamente -->
                    </div>
                </div>

                <!-- Starken Clients - Renderizados dinamicamente -->
                <div id="starken-clients" class="clients-grid">
                    <!-- Cards ser√£o renderizados via JavaScript -->
                </div>

                <!-- Alpha Clients - Renderizados dinamicamente -->
                <div id="alpha-clients" class="clients-grid" style="display: none;">
                    <!-- Cards ser√£o renderizados via JavaScript -->
                </div>

                <!-- Container para clientes Matriz (usado pelo sistema de renderiza√ß√£o) -->
                <div id="matriz-clients-container" class="clients-grid" style="display: none; margin-top: 20px;"></div>
            </div>

            <!-- Dashboard de Indicadores - Entre Cards e Tabelas -->
            <div class="client-tables-container" style="margin-top: 40px; margin-bottom: 20px;">
                <div class="client-table-header" style="margin-bottom: 25px;">
                    <h2 class="section-title">üìä Indicadores Financeiros</h2>
                    <p class="section-subtitle" id="dashboard-indicators-subtitle">An√°lise detalhada de receitas e lucros do m√™s</p>
                </div>

                <div class="tables-grid">
                    <!-- INDICADORES STARKEN -->
                    <div class="company-table-card starken-card">
                        <div class="company-table-header" style="margin-bottom: 20px;">
                            <div class="company-icon">üöÄ</div>
                            <div class="company-info">
                                <h3 class="company-name">Starken</h3>
                                <p class="company-label">Indicadores da Matriz</p>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 0 20px;">
                            <!-- Indicador: MRR Total -->
                            <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üí∞ MRR Total</div>
                                <div id="dash-starken-mrr" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">Receita Mensal Recorrente</div>
                            </div>

                            <!-- Indicador: Valor Bruto -->
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üìä Valor Bruto</div>
                                <div id="dash-starken-bruto" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">MRR Bruto + TCV Bruto</div>
                            </div>

                            <!-- Indicador: Valor L√≠quido -->
                            <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üíµ Valor L√≠quido</div>
                                <div id="dash-starken-liquido" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">MRR L√≠quido + TCV L√≠quido</div>
                            </div>

                            <!-- Indicador: Proje√ß√£o Anual -->
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üìà Proje√ß√£o Anual</div>
                                <div id="dash-starken-projecao" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">MRR √ó 12 meses</div>
                            </div>
                        </div>
                    </div>

                    <!-- INDICADORES ALPHA -->
                    <div class="company-table-card alpha-card">
                        <div class="company-table-header" style="margin-bottom: 20px;">
                            <div class="company-icon alpha-icon">‚≠ê</div>
                            <div class="company-info">
                                <h3 class="company-name">Alpha</h3>
                                <p class="company-label">Indicadores do Projeto</p>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; padding: 0 20px;">
                            <!-- Indicador: MRR Total -->
                            <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üí∞ MRR Total</div>
                                <div id="dash-alpha-mrr" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">Receita Mensal Recorrente</div>
                            </div>

                            <!-- Indicador: TCV Bruto -->
                            <div style="background: linear-gradient(135deg, #FFC107 0%, #FFB300 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üìä TCV Bruto</div>
                                <div id="dash-alpha-tcv-bruto" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">Total Contract Value Bruto</div>
                            </div>

                            <!-- Indicador: TCV L√≠quido (Contas a Receber) -->
                            <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üíµ TCV L√≠quido</div>
                                <div id="dash-alpha-tcv-liquido" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">Entrada para Contas a Receber</div>
                            </div>

                            <!-- Indicador: Valor Bruto Total -->
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üìä Valor Bruto</div>
                                <div id="dash-alpha-bruto" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">MRR Bruto + TCV Bruto</div>
                            </div>

                            <!-- Indicador: Royalties Alpha -->
                            <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(250, 112, 154, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üëë Royalties (15%)</div>
                                <div id="dash-alpha-royalties" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">15% sobre valor bruto</div>
                            </div>

                            <!-- Indicador: Taxas de Cart√£o -->
                            <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üí≥ Taxas Cart√£o</div>
                                <div id="dash-alpha-taxas" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">Juros de parcelamento</div>
                            </div>

                            <!-- Indicador: Comiss√£o de Repasse -->
                            <div style="background: linear-gradient(135deg, #FF6F00 0%, #FFA726 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(255, 111, 0, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üíº Comiss√£o Repasse</div>
                                <div id="dash-alpha-comissao" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">Valor √∑ Dura√ß√£o (meses)</div>
                            </div>

                            <!-- Indicador: Valor L√≠quido Total -->
                            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üíµ Valor L√≠quido</div>
                                <div id="dash-alpha-liquido" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">Lucro Final Starken</div>
                            </div>

                            <!-- Indicador: Proje√ß√£o Anual -->
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 6px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">üìà Proje√ß√£o Anual</div>
                                <div id="dash-alpha-projecao" style="font-size: 26px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 10px; opacity: 0.8; margin-top: 5px;">MRR √ó 12 meses</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Two Column Client Tables -->
            <div class="client-tables-container">
                <div class="client-table-header">
                    <h2 class="section-title" id="carteira-clientes-titulo">Carteira de Clientes (0 Ativos)</h2>
                    <p class="section-subtitle">Distribui√ß√£o entre Starken (Matriz) e Alpha (Projeto)</p>
                </div>

                <div class="tables-grid">
                    <!-- STARKEN TABLE - Din√¢mica por m√™s -->
                    <div class="company-table-card starken-card">
                        <div class="company-table-header">
                            <div class="company-icon">üöÄ</div>
                            <div class="company-info">
                                <h3 class="company-name">Starken</h3>
                                <p class="company-label" id="starken-clientes-label">Empresa Matriz ¬∑ 0 Clientes</p>
                            </div>
                            <div class="company-stats">
                                <div class="stat-value" id="starken-mrr-total">R$ 19.833</div>
                                <div class="stat-label">MRR Total</div>
                            </div>
                        </div>

                        <div class="table-wrapper">
                            <table class="modern-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Cidade</th>
                                        <th>MRR</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="starken-table-body">
                                    <!-- Conte√∫do gerado dinamicamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Indicadores Starken -->
                        <div id="starken-indicators" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 20px; padding: 0 20px;">
                            <!-- Indicador 1: Valor Bruto Total -->
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üí∞ Valor Bruto Total</div>
                                <div id="starken-valor-bruto" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">MRR bruto + TCV bruto</div>
                            </div>

                            <!-- Indicador 2: Valor L√≠quido Total -->
                            <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üíµ Valor L√≠quido Total</div>
                                <div id="starken-valor-liquido" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">MRR l√≠quido + TCV l√≠quido</div>
                            </div>

                            <!-- Indicador 3: Proje√ß√£o MRR Anual -->
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üìà Proje√ß√£o MRR Anual</div>
                                <div id="starken-projecao-mrr" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">MRR √ó 12 meses</div>
                            </div>
                        </div>
                    </div>

                    <!-- ALPHA TABLE - Din√¢mica por m√™s -->
                    <div class="company-table-card alpha-card">
                        <div class="company-table-header">
                            <div class="company-icon alpha-icon">‚≠ê</div>
                            <div class="company-info">
                                <h3 class="company-name">Alpha</h3>
                                <p class="company-label" id="alpha-clientes-label">Projeto Nichado ¬∑ 0 Clientes</p>
                            </div>
                            <div class="company-stats" style="text-align: right;">
                                <div style="display: flex; gap: 20px;">
                                    <div>
                                        <div class="stat-value" style="color: #4A6B54;" id="alpha-mrr-total">R$ 15.000</div>
                                        <div class="stat-label">MRR</div>
                                    </div>
                                    <div>
                                        <div class="stat-value" style="color: #FFC107;" id="alpha-tcv-total">R$ 0</div>
                                        <div class="stat-label">TCV</div>
                                    </div>
                                    <div>
                                        <div class="stat-value" style="color: #2c3e50;" id="alpha-total-mes">R$ 15.000</div>
                                        <div class="stat-label">TOTAL M√äS</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="table-wrapper">
                            <table class="modern-table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Tipo</th>
                                        <th>Origem</th>
                                        <th>MRR</th>
                                        <th>TCV Bruto</th>
                                        <th>TCV L√≠quido</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="alpha-table-body">
                                    <!-- Conte√∫do gerado dinamicamente -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Indicadores Alpha -->
                        <div id="alpha-indicators" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 20px; padding: 0 20px;">
                            <!-- Indicador 1: Valor Bruto Total -->
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üí∞ Valor Bruto Total</div>
                                <div id="alpha-valor-bruto" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">MRR bruto + TCV bruto</div>
                            </div>

                            <!-- Indicador 2: Royalties Alpha (15%) -->
                            <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(250, 112, 154, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üëë Royalties Alpha (15%)</div>
                                <div id="alpha-royalties" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">15% sobre valor bruto</div>
                            </div>

                            <!-- Indicador 3: Taxas de Cart√£o -->
                            <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üí≥ Taxas de Cart√£o</div>
                                <div id="alpha-taxas-cartao" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">Juros de parcelamento</div>
                            </div>

                            <!-- Indicador 4: Valor L√≠quido Total -->
                            <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üíµ Valor L√≠quido Total</div>
                                <div id="alpha-valor-liquido" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">Bruto - Royalties - Taxas</div>
                            </div>

                            <!-- Indicador 5: Lucro Final Starken -->
                            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(67, 233, 123, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üéØ Lucro Final Starken</div>
                                <div id="alpha-lucro-final" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">Valor que fica na Starken</div>
                            </div>

                            <!-- Indicador 6: Proje√ß√£o MRR Anual -->
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 20px; color: white; box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);">
                                <div style="font-size: 13px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">üìà Proje√ß√£o MRR Anual</div>
                                <div id="alpha-projecao-mrr" style="font-size: 28px; font-weight: 700; letter-spacing: -0.5px;">R$ 0,00</div>
                                <div style="font-size: 11px; opacity: 0.8; margin-top: 6px;">MRR √ó 12 meses</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            </div>

        </main>
    </div>

    <script src="dados-mensais.js"></script>
    <script>
        // Verificar se dados foram carregados
        console.log('Dados mensais carregados:', typeof dadosMensais !== 'undefined');
        console.log('Novembro:', dadosMensais['2025-11']);
        console.log('Dezembro:', dadosMensais['2025-12']);

        // ==========================================
        // SISTEMA DE GEST√ÉO DE MESES - DASHBOARD
        // ==========================================

        // Fun√ß√£o para obter o m√™s atual em tempo real
        function getMesAtualReal() {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            return `${ano}-${mes}`;
        }

        // Fun√ß√£o para formatar nome do m√™s
        function getNomeMes(mesChave) {
            const meses = {
                '01': 'Janeiro', '02': 'Fevereiro', '03': 'Mar√ßo',
                '04': 'Abril', '05': 'Maio', '06': 'Junho',
                '07': 'Julho', '08': 'Agosto', '09': 'Setembro',
                '10': 'Outubro', '11': 'Novembro', '12': 'Dezembro'
            };
            const [ano, mes] = mesChave.split('-');
            return `${meses[mes]} ${ano}`;
        }

        // Verificar se o m√™s existe nos dados, sen√£o usar o mais recente dispon√≠vel
        function getMesDisponivel(mesDesejado) {
            if (dadosMensais[mesDesejado]) {
                return mesDesejado;
            }
            // Se n√£o existe, pegar o m√™s mais recente dispon√≠vel
            const mesesDisponiveis = Object.keys(dadosMensais).sort().reverse();
            return mesesDisponiveis[0] || '2025-11';
        }

        // Estado global do dashboard - DECLARADO ANTES DOS CHARTS
        const mesRealAtual = getMesAtualReal();
        const mesInicial = getMesDisponivel(mesRealAtual);

        const DashboardState = {
            mesAtual: mesInicial, // M√™s atual baseado na data real
            mesReal: mesRealAtual, // Data real do sistema
            charts: {
                mrr: null,
                despesas: null
            }
        };

        console.log('üìÖ Data atual do sistema:', new Date().toLocaleDateString('pt-BR'));
        console.log('üìÖ M√™s real:', mesRealAtual);
        console.log('üìÖ M√™s carregado:', mesInicial);

        // Revenue Chart
        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        DashboardState.charts.mrr = new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Outubro', 'Novembro', 'Dezembro', 'Janeiro/26'],
                datasets: [{
                    label: 'MRR',
                    data: [46365, 34768, 29530, 32536],
                    borderColor: '#4A6B54',
                    backgroundColor: 'rgba(74, 107, 84, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointBackgroundColor: '#4A6B54',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#2c3e50',
                        padding: 12,
                        titleFont: {
                            size: 14,
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            label: function(context) {
                                return 'MRR: R$ ' + context.parsed.y.toLocaleString('pt-BR');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + (value / 1000) + 'k';
                            },
                            font: {
                                size: 12
                            }
                        },
                        grid: {
                            color: '#e1e8ed'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        // Expenses Pie Chart
        const expensesCtx = document.getElementById('expensesChart').getContext('2d');
        DashboardState.charts.despesas = new Chart(expensesCtx, {
            type: 'doughnut',
            data: {
                labels: ['Pessoal', 'Repasse Alpha', 'Comercial', 'Estrutura', 'Ferramentas'],
                datasets: [{
                    data: [11300, 7500, 6000, 3009, 2560.90],
                    backgroundColor: [
                        '#4A6B54',
                        '#7A9B84',
                        '#B8D4BE',
                        '#27ae60',
                        '#f39c12'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            font: {
                                size: 12
                            },
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: '#2c3e50',
                        padding: 12,
                        titleFont: {
                            size: 14,
                            weight: 'bold'
                        },
                        bodyFont: {
                            size: 13
                        },
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return label + ': R$ ' + value.toLocaleString('pt-BR') + ' (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });

        // Navigation interactivity - removed preventDefault to allow normal link navigation

        // Vari√°vel global para guardar aba ativa
        let abaAtiva = 'starken';

        // Client tabs functionality
        function showClientTab(tabName) {
            // Salvar aba ativa
            abaAtiva = tabName;

            // Hide all client grids
            document.getElementById('starken-clients').style.display = 'none';
            document.getElementById('alpha-clients').style.display = 'none';

            // Mostrar/ocultar container Matriz baseado na tab
            const matrizContainer = document.getElementById('matriz-clients-container');
            if (matrizContainer) {
                matrizContainer.style.display = tabName === 'alpha' ? 'flex' : 'none';
            }

            // Show selected grid
            document.getElementById(tabName + '-clients').style.display = 'grid';

            // Update active tab
            const tabs = document.querySelectorAll('.client-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');
        }

        // Fun√ß√£o de busca de clientes
        function searchClients(query) {
            const searchResults = document.getElementById('searchResults');
            const searchCount = document.getElementById('searchCount');
            const searchMeses = document.getElementById('searchMeses');

            if (!query || query.trim().length < 2) {
                searchResults.style.display = 'none';
                // Mostrar todos os cards
                document.querySelectorAll('.client-card').forEach(card => {
                    card.style.display = 'flex';
                });
                return;
            }

            const clientes = getManualClients();
            const deletedIds = getDeletedCards();
            const queryLower = query.trim().toLowerCase();

            // Buscar clientes que correspondem √† query
            const clientesEncontrados = clientes.filter(c => {
                const isDeleted = deletedIds.includes(c.id);
                if (isDeleted || c.isProjecao) return false;
                return c.nome.toLowerCase().includes(queryLower);
            });

            searchCount.textContent = clientesEncontrados.length;
            searchResults.style.display = 'block';

            if (clientesEncontrados.length === 0) {
                searchMeses.style.display = 'none';
                // Ocultar todos os cards
                document.querySelectorAll('.client-card').forEach(card => {
                    card.style.display = 'none';
                });
                return;
            }

            // Se encontrou apenas 1 cliente, mostrar em quais meses ele aparece
            if (clientesEncontrados.length === 1) {
                const cliente = clientesEncontrados[0];
                const mesesDisponiveis = getMesesDoCliente(cliente);

                searchMeses.style.display = 'block';
                searchMeses.innerHTML = `
                    <strong>üìÖ ${cliente.nome}</strong> aparece em: ${mesesDisponiveis.join(', ')}
                `;
            } else {
                searchMeses.style.display = 'none';
            }

            // Mostrar apenas cards que correspondem √† busca
            document.querySelectorAll('.client-card').forEach(card => {
                const clientId = card.getAttribute('data-client-id');
                const clienteEncontrado = clientesEncontrados.find(c => c.id == clientId);
                card.style.display = clienteEncontrado ? 'flex' : 'none';
            });
        }

        // Fun√ß√£o para obter meses em que o cliente aparece
        function getMesesDoCliente(cliente) {
            const meses = [];
            const mesesNomes = {
                '2025-10': 'Out/2025', '2025-11': 'Nov/2025', '2025-12': 'Dez/2025',
                '2026-01': 'Jan/2026', '2026-02': 'Fev/2026', '2026-03': 'Mar/2026',
                '2026-04': 'Abr/2026', '2026-05': 'Mai/2026', '2026-06': 'Jun/2026',
                '2026-07': 'Jul/2026', '2026-08': 'Ago/2026', '2026-09': 'Set/2026',
                '2026-10': 'Out/2026', '2026-11': 'Nov/2026', '2026-12': 'Dez/2026'
            };

            // SE TEM MESES PERSONALIZADOS, usar eles!
            if (cliente.mesesPersonalizados && cliente.mesesPersonalizados.length > 0) {
                cliente.mesesPersonalizados.forEach(mes => {
                    if (mesesNomes[mes]) {
                        meses.push(mesesNomes[mes]);
                    }
                });
                return meses;
            }

            // Sen√£o, usar l√≥gica autom√°tica
            Object.keys(mesesNomes).forEach(mesChave => {
                let aparece = false;

                // Card de renova√ß√£o
                if (cliente.statusRenovacao && cliente.mesRenovacao === mesChave) {
                    aparece = true;
                }

                // TCV: apenas no m√™s de pagamento
                if (cliente.tipoValor === 'tcv') {
                    const mesPagamento = (cliente.dataPagamentoTCV || cliente.mesInicio || '').substring(0, 7);
                    if (mesPagamento === mesChave) {
                        aparece = true;
                    }
                }

                // MRR: 12 meses a partir do in√≠cio
                if (cliente.tipoValor === 'mrr' && cliente.mesInicio) {
                    const [anoInicio, mesInicio] = cliente.mesInicio.split('-').map(Number);
                    const dataInicio = new Date(anoInicio, mesInicio - 1, 1);
                    const dataFim = new Date(dataInicio);
                    dataFim.setMonth(dataFim.getMonth() + 12);

                    const [anoMes, mesMes] = mesChave.split('-').map(Number);
                    const dataMes = new Date(anoMes, mesMes - 1, 1);

                    if (dataMes >= dataInicio && dataMes < dataFim) {
                        aparece = true;
                    }
                }

                if (aparece) {
                    meses.push(mesesNomes[mesChave]);
                }
            });

            return meses.length > 0 ? meses : ['Nenhum m√™s'];
        }

        // Limpar busca
        function clearSearch() {
            document.getElementById('searchClientInput').value = '';
            document.getElementById('searchResults').style.display = 'none';
            // Mostrar todos os cards
            document.querySelectorAll('.client-card').forEach(card => {
                card.style.display = 'flex';
            });
        }

        // Toggle painel de calend√°rio
        function togglePainelMeses() {
            const painel = document.getElementById('painelCalendario');
            const btn = document.getElementById('btnPainelMeses');

            if (painel.style.display === 'none') {
                painel.style.display = 'block';
                btn.textContent = '‚úï Fechar Calend√°rio';
                renderCalendarioClientes();
            } else {
                painel.style.display = 'none';
                btn.textContent = 'üìÖ Ver Calend√°rio de Clientes';
            }
        }

        // Renderizar calend√°rio de clientes
        function renderCalendarioClientes() {
            const clientes = getManualClients();
            const deletedIds = getDeletedCards();
            const container = document.getElementById('calendarioContent');

            // Filtrar apenas clientes ativos (n√£o deletados, n√£o proje√ß√£o)
            const clientesAtivos = clientes.filter(c => {
                return !deletedIds.includes(c.id) && !c.isProjecao;
            });

            // Separar por empresa
            const clientesStarken = clientesAtivos.filter(c => c.empresa === 'starken');
            const clientesAlpha = clientesAtivos.filter(c => c.empresa === 'alpha');

            let html = '';

            // Renderizar Starken
            if (clientesStarken.length > 0) {
                html += `
                    <div style="margin-bottom: 24px;">
                        <h4 style="margin: 0 0 12px 0; color: #4A6B54; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                            <span>üöÄ</span> Starken (${clientesStarken.length} clientes)
                        </h4>
                        <div style="display: grid; gap: 12px;">
                            ${clientesStarken.map(c => criarLinhaCalendario(c)).join('')}
                        </div>
                    </div>
                `;
            }

            // Renderizar Alpha
            if (clientesAlpha.length > 0) {
                html += `
                    <div>
                        <h4 style="margin: 0 0 12px 0; color: #4A6B54; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                            <span>‚≠ê</span> Alpha (${clientesAlpha.length} clientes)
                        </h4>
                        <div style="display: grid; gap: 12px;">
                            ${clientesAlpha.map(c => criarLinhaCalendario(c)).join('')}
                        </div>
                    </div>
                `;
            }

            if (clientesAtivos.length === 0) {
                html = `
                    <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üì≠</div>
                        <p style="margin: 0; font-size: 16px; font-weight: 600;">Nenhum cliente cadastrado</p>
                        <p style="margin: 8px 0 0 0; font-size: 14px;">Adicione clientes para ver o calend√°rio de visibilidade</p>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // Criar linha do calend√°rio para um cliente
        function criarLinhaCalendario(cliente) {
            const meses = getMesesDoCliente(cliente);
            const totalMeses = meses.length;

            // Badge de tipo
            let tipoBadge = '';
            if (cliente.tipoValor === 'tcv') {
                tipoBadge = '<span style="background:#9333ea;color:white;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-left:8px;">TCV</span>';
            } else if (cliente.tipoValor === 'mrr') {
                tipoBadge = '<span style="background:#4CAF50;color:white;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-left:8px;">MRR</span>';
            }

            // Badge de origem
            let origemBadge = '';
            const origemMap = {
                'outbound': '<span style="background:#f97316;color:white;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-left:4px;">Outbound</span>',
                'growth-hub': '<span style="background:#4ade80;color:white;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-left:4px;">Growth Hub</span>',
                'repasse-matriz': '<span style="background:#3b82f6;color:white;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-left:4px;">Repasse Matriz</span>',
                'inbound': '<span style="background:#22c55e;color:white;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-left:4px;">Inbound</span>',
                'outros': '<span style="background:#94a3b8;color:white;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-left:4px;">Outros</span>'
            };
            origemBadge = origemMap[cliente.origem] || '';

            return `
                <div style="padding: 12px 16px; background: #f8fafc; border-left: 4px solid #4A6B54; border-radius: 8px; transition: all 0.2s ease;"
                     onmouseover="this.style.background='#f1f5f9'"
                     onmouseout="this.style.background='#f8fafc'">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                        <div style="flex: 1;">
                            <strong style="font-size: 14px; color: #2c3e50;">${cliente.nome}</strong>
                            ${tipoBadge}
                            ${origemBadge}
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 12px; color: #4A6B54; font-weight: 600;">
                                ${totalMeses} ${totalMeses === 1 ? 'm√™s' : 'meses'}
                            </div>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: #64748b; line-height: 1.6;">
                        üìÖ <strong>Aparece em:</strong> ${meses.join(', ')}
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o para renderizar cards Alpha dinamicamente
        function renderAlphaCards(mesChave) {
            console.log('üé¥ renderAlphaCards chamado para:', mesChave);
            const container = document.getElementById('alpha-clients');
            if (!container) {
                console.error('‚ùå Container alpha-clients n√£o encontrado!');
                return;
            }
            console.log('‚úÖ Container alpha-clients encontrado');

            const clientesPorMes = {
                '2025-11': 16,
                '2025-12': 20,
                '2026-01': 23,
                '2026-02': 26,
                '2026-03': 29,
                '2026-04': 32,
                '2026-05': 35,
                '2026-06': 38,
                '2026-07': 41,
                '2026-08': 44,
                '2026-09': 47,
                '2026-10': 50,
                '2026-11': 53,
                '2026-12': 56
            };

            // Atualizar label do tab
            const alphaTab = document.querySelector('.client-tab:nth-child(2) .tab-label');
            if (alphaTab) {
                const qtdClientes = clientesPorMes[mesChave] || 20;
                alphaTab.textContent = `Alpha (${qtdClientes})`;
            }

            // Cards base (sempre aparecem)
            let html = `
                <div class="client-card">
                    <div class="client-logo">üçΩÔ∏è</div>
                    <h3 class="client-name">Oca Restaurante</h3>
                    <p class="client-category">Outbound - Restaurante</p>
                    <div class="client-value">R$ 2.000/m√™s</div>
                </div>
                <div class="client-card">
                    <div class="client-logo">üåÆ</div>
                    <h3 class="client-name">Madrug√£o Lanches</h3>
                    <p class="client-category">Outbound - Lanchonete</p>
                    <div class="client-value">R$ 2.000/m√™s</div>
                </div>
                <div class="client-card">
                    <div class="client-logo">üçï</div>
                    <h3 class="client-name">Fratellis Pizzaria</h3>
                    <p class="client-category">Outbound - Pizzaria</p>
                    <div class="client-value">R$ 2.500/m√™s</div>
                </div>
                <div class="client-card">
                    <div class="client-logo">üçï</div>
                    <h3 class="client-name">Saporitto Pizzaria</h3>
                    <p class="client-category">Outbound - Pizzaria</p>
                    <div class="client-value">R$ 1.500/m√™s</div>
                </div>`;

            // Clientes TCV (aparecem em todos os meses, mas status muda)
            if (mesChave === '2025-11') {
                // Novembro - todos TCV
                html += `
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Don Chevico</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">World Burger</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçù</div><h3 class="client-name">Oficina da Massa</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Bigu's Burger</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Madrid</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Cazza Pizzaria</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Maki Toro Sushi</h3><p class="client-category">Growth Hub - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Brazza Hamburgueria</h3><p class="client-category">Blumenau - Hamburgueria</p><div class="client-value">R$ 3.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçΩÔ∏è</div><h3 class="client-name">Fabinhus Restaurante</h3><p class="client-category">Growth Hub - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçñ</div><h3 class="client-name">Tempero Manero Grill</h3><p class="client-category">Growth Hub - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Super Dupe Hamburgueria</h3><p class="client-category">MRR - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Majo Sushi</h3><p class="client-category">MRR - TCV</p><div class="client-value">TCV</div></div>`;
            } else if (mesChave === '2025-12') {
                // Dezembro - TCV antigos + novos MRR + Matriz 1-4 TCV
                html += `
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Don Chevico</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">World Burger</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçù</div><h3 class="client-name">Oficina da Massa</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Bigu's Burger</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Madrid</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Cazza Pizzaria</h3><p class="client-category">Envio Matriz - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Maki Toro Sushi</h3><p class="client-category">Growth Hub - TCV</p><div class="client-value">TCV</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Brazza Hamburgueria</h3><p class="client-category">Blumenau - Hamburgueria</p><div class="client-value">R$ 3.000/m√™s</div></div>
                <div class="client-card new-client"><div class="client-logo">üçΩÔ∏è</div><h3 class="client-name">Fabinhus Restaurante</h3><p class="client-category">Growth Hub - In√≠cio 15/12</p><div class="client-value">R$ 1.000/m√™s</div></div>
                <div class="client-card new-client"><div class="client-logo">üçñ</div><h3 class="client-name">Tempero Manero Grill</h3><p class="client-category">Growth Hub - In√≠cio 15/12</p><div class="client-value">R$ 1.000/m√™s</div></div>
                <div class="client-card new-client"><div class="client-logo">üçî</div><h3 class="client-name">Super Dupe Hamburgueria</h3><p class="client-category">NOVO BC - In√≠cio 20/12</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card new-client" style="border: 2px solid #9C27B0; background: #f3e5f5;"><div class="client-logo">ü•©</div><h3 class="client-name">Churrascaria Paiaguas</h3><p class="client-category">Matriz TCV - 01/12</p><div class="client-value" style="color: #9C27B0;">R$ 3.149,75</div></div>`;
            } else if (mesChave === '2026-01') {
                // Janeiro - Renova√ß√µes + TCV aguardando + novos Matriz 5-7
                html += `
                <div class="client-card" style="border: 2px solid #4CAF50; background: #e8f5e9;"><div class="client-logo">üçî</div><h3 class="client-name">World Burger</h3><p class="client-category">Envio Matriz üîÑ</p><div class="client-value" style="color: #4CAF50;">R$ 2.000/m√™s</div></div>
                <div class="client-card" style="border: 2px solid #4CAF50; background: #e8f5e9;"><div class="client-logo">üçù</div><h3 class="client-name">Oficina da Massa</h3><p class="client-category">Envio Matriz üîÑ</p><div class="client-value" style="color: #4CAF50;">R$ 2.000/m√™s</div></div>
                <div class="client-card" style="border: 2px solid #4CAF50; background: #e8f5e9;"><div class="client-logo">üçî</div><h3 class="client-name">Bigu's Burger</h3><p class="client-category">Envio Matriz üîÑ</p><div class="client-value" style="color: #4CAF50;">R$ 2.000/m√™s</div></div>
                <div class="client-card" style="border: 2px solid #4CAF50; background: #e8f5e9;"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Madrid</h3><p class="client-category">Envio Matriz üîÑ</p><div class="client-value" style="color: #4CAF50;">R$ 2.000/m√™s</div></div>
                <div class="client-card" style="border: 2px solid #ccc; opacity: 0.7;"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Don Chevico</h3><p class="client-category">Envio Matriz</p><div class="client-value" style="color: #999;">Aguard. Fev</div></div>
                <div class="client-card" style="border: 2px solid #ccc; opacity: 0.7;"><div class="client-logo">üçï</div><h3 class="client-name">Cazza Pizzaria</h3><p class="client-category">Envio Matriz</p><div class="client-value" style="color: #999;">Aguard. Fev</div></div>
                <div class="client-card" style="border: 2px solid #ccc; opacity: 0.7;"><div class="client-logo">üç£</div><h3 class="client-name">Maki Toro Sushi</h3><p class="client-category">Growth Hub</p><div class="client-value" style="color: #999;">Aguard. Mar</div></div>
                <div class="client-card"><div class="client-logo">üçΩÔ∏è</div><h3 class="client-name">Fabinhus Restaurante</h3><p class="client-category">Growth Hub</p><div class="client-value">R$ 1.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçñ</div><h3 class="client-name">Tempero Manero Grill</h3><p class="client-category">Growth Hub</p><div class="client-value">R$ 1.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Super Dupe Hamburgueria</h3><p class="client-category">MRR</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Majo Sushi</h3><p class="client-category">MRR</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card new-client"><div class="client-logo">üç£</div><h3 class="client-name">Aseyori</h3><p class="client-category">NOVO - In√≠cio Jan</p><div class="client-value">R$ 2.500/m√™s</div></div>
                <div class="client-card new-client"><div class="client-logo">üç£</div><h3 class="client-name">Temakeria</h3><p class="client-category">NOVO - In√≠cio Jan</p><div class="client-value">R$ 1.500/m√™s</div></div>`;
            } else {
                // Fevereiro e Mar√ßo - usar mesma estrutura de Janeiro como base
                html += `
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">World Burger</h3><p class="client-category">Envio Matriz</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçù</div><h3 class="client-name">Oficina da Massa</h3><p class="client-category">Envio Matriz</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Bigu's Burger</h3><p class="client-category">Envio Matriz</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Madrid</h3><p class="client-category">Envio Matriz</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Pizzaria Don Chevico</h3><p class="client-category">Envio Matriz</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçï</div><h3 class="client-name">Cazza Pizzaria</h3><p class="client-category">Envio Matriz</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Maki Toro Sushi</h3><p class="client-category">Growth Hub</p><div class="client-value">R$ 1.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçΩÔ∏è</div><h3 class="client-name">Fabinhus Restaurante</h3><p class="client-category">Growth Hub</p><div class="client-value">R$ 1.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçñ</div><h3 class="client-name">Tempero Manero Grill</h3><p class="client-category">Growth Hub</p><div class="client-value">R$ 1.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üçî</div><h3 class="client-name">Super Dupe Hamburgueria</h3><p class="client-category">MRR</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Majo Sushi</h3><p class="client-category">MRR</p><div class="client-value">R$ 2.000/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Aseyori</h3><p class="client-category">MRR</p><div class="client-value">R$ 2.500/m√™s</div></div>
                <div class="client-card"><div class="client-logo">üç£</div><h3 class="client-name">Temakeria</h3><p class="client-category">MRR</p><div class="client-value">R$ 1.500/m√™s</div></div>`;
            }

            container.innerHTML = html;
            console.log('üé¥ Cards Alpha renderizados para:', mesChave, '| HTML length:', html.length);

            // For√ßar exibi√ß√£o se estava escondido
            if (document.querySelector('.client-tab:nth-child(2)').classList.contains('active')) {
                container.style.display = 'grid';
            }
        }

        // Utilit√°rios
        const Utils = {
            formatarReais: (valor) => {
                return 'R$ ' + Math.round(valor).toLocaleString('pt-BR');
            },

            calcularVariacao: (valorAtual, valorAnterior) => {
                return ((valorAtual - valorAnterior) / valorAnterior * 100).toFixed(1);
            }
        };

        // Helper para obter despesas totais (Dados Mensais + Custom)
        function getDespesasTotal(mes) {
            let total = 0;
            // 1. Dados Est√°ticos
            if (typeof dadosMensais !== 'undefined' && dadosMensais[mes] && dadosMensais[mes].despesas) {
                total += (dadosMensais[mes].despesas.total || 0);
            }
            // 2. Dados Customizados
            try {
                const customItems = JSON.parse(localStorage.getItem('starken_financeiro_custom_items') || '{}');
                if (customItems[mes] && customItems[mes].despesas) {
                    customItems[mes].despesas.forEach(d => total += parseFloat(d.valor || 0));
                }
            } catch (e) { console.error(e); }
            return total;
        }

        function getActiveClientCountsForMonth(mesChave) {
            const clientes = getManualClients();
            const deletedIds = getDeletedCards();
            let totalStarkenAtivos = 0;
            let totalAlphaAtivos = 0;

            clientes.forEach(c => {
                if (deletedIds.includes(c.id)) return;

                let isActive = false;

                if (c.isProjecao && !c.mesInicio) return;

                if (c.mesesPersonalizados && c.mesesPersonalizados.length > 0) {
                    isActive = c.mesesPersonalizados.includes(mesChave);
                } else if (c.statusRenovacao && c.mesRenovacao === mesChave) {
                    isActive = true;
                } else if (c.tipoValor === 'tcv') {
                    const mesPagamento = (c.dataPagamentoTCV || c.mesInicio || '').substring(0, 7);
                    isActive = mesPagamento === mesChave;
                } else if (c.tipoValor === 'mrr' || c.tipoValor === 'bonus') {
                    if (!c.mesInicio) return;

                    const [anoInicio, mesInicio] = c.mesInicio.split('-').map(Number);
                    const dataInicio = new Date(anoInicio, mesInicio - 1, 1);
                    const [anoAtual, mesAtualNum] = mesChave.split('-').map(Number);
                    const dataAtual = new Date(anoAtual, mesAtualNum - 1, 1);

                    if (c.isProjecao) {
                        const duracao = c.projecaoDuracao ? (parseInt(c.projecaoDuracao) || 12) : 12;
                        const dataFim = new Date(dataInicio);
                        dataFim.setMonth(dataFim.getMonth() + duracao);
                        isActive = dataAtual >= dataInicio && dataAtual < dataFim;
                    } else {
                        const dataFim = new Date(dataInicio);
                        dataFim.setMonth(dataFim.getMonth() + 60);
                        isActive = dataAtual >= dataInicio && dataAtual < dataFim;
                    }
                }

                if (!isActive) return;

                if (c.empresa === 'starken') {
                    totalStarkenAtivos += 1;
                } else if (c.empresa === 'alpha') {
                    totalAlphaAtivos += 1;
                }
            });

            return {
                totalStarkenAtivos,
                totalAlphaAtivos,
                totalClientes: totalStarkenAtivos + totalAlphaAtivos
            };
        }

        // Gerenciador de KPIs - Atualizado para Tempo Real e Multi-Opera√ß√£o
        const KPIManager = {
            init: function() {
                // Inicializa√ß√£o se necess√°rio
            },

            atualizar: function(mesChave) {
                console.log('=== Atualizando KPIs em Tempo Real para:', mesChave);
                
                // 1. Obter clientes e dados
                const clientes = getManualClients();
                const deletedIds = getDeletedCards();
                const { totalStarkenAtivos, totalAlphaAtivos } = getActiveClientCountsForMonth(mesChave);
                
                // 2. Filtrar ativos e calcular receitas
                let starkenRevenue = 0;
                let alphaRevenue = 0;
                let alphaRoyalties = 0; // 15% sobre Alpha

                clientes.forEach(c => {
                    // Ignorar deletados e proje√ß√µes
                    if (deletedIds.includes(c.id)) return;
                    if (c.isProjecao) return;

                    // Verificar se est√° ativo no m√™s
                    let isActive = false;
                    let revenue = 0;

                    // L√≥gica MRR / B√¥nus
                    if (c.tipoValor === 'mrr' || c.tipoValor === 'bonus') {
                        // Verificar ajuste mensal (prioridade)
                        if (c.ajustesMensais && c.ajustesMensais[mesChave]) {
                            revenue = parseFloat(c.ajustesMensais[mesChave].valor || 0);
                            isActive = true;
                        } else {
                            // Verificar data de in√≠cio/pagamento
                            const dataInicio = c.dataPagamentoMRR || c.mesInicio;
                            if (dataInicio) {
                                const mesInicio = dataInicio.substring(0, 7);
                                // Para MRR, consideramos ativo se mesChave >= mesInicio
                                if (mesChave >= mesInicio) {
                                    revenue = parseFloat(c.valor || 0);
                                    isActive = true;
                                }
                            }
                        }
                    }
                    // L√≥gica TCV
                    else if (c.tipoValor === 'tcv') {
                        // Verificar meses personalizados (prioridade)
                        if (c.tcvMesesReceita && c.tcvMesesReceita.length > 0) {
                            if (c.tcvMesesReceita.includes(mesChave)) {
                                revenue = parseFloat(c.tcvTotal || 0);
                                isActive = true;
                            }
                        } else {
                            // Fallback: Verificar data pagamento √∫nica
                            const mesPagamento = (c.dataPagamentoTCV || c.mesInicio || '').substring(0, 7);
                            if (mesPagamento === mesChave) {
                                revenue = parseFloat(c.tcvTotal || 0);
                                isActive = true;
                            }
                        }
                    }

                    if (isActive) {
                        if (c.empresa === 'starken') {
                            starkenRevenue += revenue;
                        } else if (c.empresa === 'alpha') {
                            alphaRevenue += revenue;
                            alphaRoyalties += (revenue * 0.15);
                        }
                    }
                });

                // 3. Calcular Despesas Operacionais (Starken)
                // Usando helper que soma dadosMensais + Custom
                const despesasTotaisBrutas = getDespesasTotal(mesChave);
                
                // Tentar identificar despesas Alpha fixas (repasse antigo) para remover se necess√°rio
                // Na l√≥gica antiga: const despesasSemAlpha = dados.despesas.total - 7500;
                // Vamos assumir que despesasTotaisBrutas s√£o TODAS operacionais da Starken, EXCETO o que for explicitamente Alpha
                // Mas como estamos calculando Royalties dinamicamente, vamos considerar:
                // Despesas Starken = despesasTotaisBrutas (que vem do JSON/Storage)
                // Despesas Alpha = alphaRoyalties (calculado agora)
                
                // Se houver "repasse alpha" fixo no JSON, dever√≠amos subtrair para n√£o duplicar?
                // O JSON tem 'alpha_franquia'. Vamos tentar subtrair se existir para usar o c√°lculo din√¢mico
                let repasseFixoAlpha = 0;
                if (typeof dadosMensais !== 'undefined' && dadosMensais[mesChave] && dadosMensais[mesChave].despesas && dadosMensais[mesChave].despesas.categorias && dadosMensais[mesChave].despesas.categorias.alpha_franquia) {
                     repasseFixoAlpha = dadosMensais[mesChave].despesas.categorias.alpha_franquia.total || 0;
                }
                
                const despesasOperacionaisStarken = despesasTotaisBrutas - repasseFixoAlpha;

                // 4. Calcular Totais e Resultados
                const totalRevenue = starkenRevenue + alphaRevenue;
                
                // Total Despesas = Operacional Starken + Royalties Alpha
                const totalDespesas = despesasOperacionaisStarken + alphaRoyalties;

                const starkenResultado = starkenRevenue - despesasOperacionaisStarken;
                const alphaResultado = alphaRevenue - alphaRoyalties;
                const totalResultado = totalRevenue - totalDespesas;

                // 5. Atualizar DOM com formata√ß√£o
                const fmt = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);
                const updateText = (id, text) => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = text;
                };

                // Starken
                updateText('kpi-starken-mrr', fmt(starkenRevenue));
                updateText('kpi-starken-clientes', totalStarkenAtivos);
                updateText('kpi-starken-despesas', fmt(despesasOperacionaisStarken));
                updateText('kpi-starken-resultado', fmt(starkenResultado));

                // Alpha
                updateText('kpi-alpha-mrr', fmt(alphaRevenue));
                updateText('kpi-alpha-clientes', totalAlphaAtivos);
                updateText('kpi-alpha-despesas', fmt(alphaRoyalties));
                updateText('kpi-alpha-resultado', fmt(alphaResultado));

                // Total
                updateText('kpi-total-mrr', fmt(totalRevenue));
                updateText('kpi-total-clientes', totalStarkenAtivos + totalAlphaAtivos);
                if (document.getElementById('kpi-total-clientes-breakdown')) {
                    document.getElementById('kpi-total-clientes-breakdown').textContent = `${totalStarkenAtivos} Starken + ${totalAlphaAtivos} Alpha`;
                }
                updateText('kpi-total-despesas', fmt(totalDespesas));
                updateText('kpi-total-resultado', fmt(totalResultado));
                
                const margem = totalRevenue > 0 ? ((totalResultado / totalRevenue) * 100).toFixed(1) : 0;
                updateText('kpi-total-margem', `${margem}% de margem`);
                
                console.log('KPIs Realtime Atualizados:', { starkenRevenue, alphaRevenue, totalRevenue });
            }
        };

        // Gerenciador de Gr√°ficos
        const ChartManager = {
            atualizarMRR: function(mesChave) {
                if (!DashboardState.charts.mrr) return;

                // Sempre mostrar evolu√ß√£o completa: Out -> Nov -> Dez -> Jan
                const labels = ['Outubro', 'Novembro', 'Dezembro', 'Janeiro/26'];
                const values = [
                    dadosMensais['2025-10'] ? dadosMensais['2025-10'].receitas.total : 46365,
                    dadosMensais['2025-11'] ? dadosMensais['2025-11'].receitas.total : 34768,
                    dadosMensais['2025-12'] ? dadosMensais['2025-12'].receitas.total : 29530,
                    dadosMensais['2026-01'] ? dadosMensais['2026-01'].receitas.total : 32536
                ];

                DashboardState.charts.mrr.data.labels = labels;
                DashboardState.charts.mrr.data.datasets[0].data = values;
                DashboardState.charts.mrr.update('none'); // Update sem anima√ß√£o para melhor performance
            },

            atualizarDespesas: function(mesChave) {
                if (!DashboardState.charts.despesas) return;

                const dados = dadosMensais[mesChave];
                if (!dados || !dados.despesas || !dados.despesas.categorias) {
                    // Para meses sem categorias detalhadas, usar valores padr√£o
                    const valoresPadrao = [14100, 7500, 7500, 4009, 2760];
                    DashboardState.charts.despesas.data.datasets[0].data = valoresPadrao;
                    DashboardState.charts.despesas.update('none');
                    return;
                }

                const cat = dados.despesas.categorias;

                const valores = [
                    cat.pessoal ? cat.pessoal.total : 14100,
                    7500, // Repasse Alpha (fixo)
                    cat.comercial ? cat.comercial.total : 7500,
                    cat.estrutura ? cat.estrutura.total - 7500 : 4009,
                    cat.ferramentas ? cat.ferramentas.total : 2760
                ];

                DashboardState.charts.despesas.data.datasets[0].data = valores;
                DashboardState.charts.despesas.update('none');
            },

            atualizarTodos: function(mesChave) {
                this.atualizarMRR(mesChave);
                this.atualizarDespesas(mesChave);
            }
        };

        // Fun√ß√£o para atualizar contadores de clientes nas tabs
        function atualizarContadoresClientes(mesChave) {
            // Delega para a nova fun√ß√£o que conta cards reais
            if (typeof updateClientCounters === 'function') {
                updateClientCounters();
                return;
            }

            // Fallback: c√≥digo antigo caso a nova fun√ß√£o n√£o exista
            const starkenPorMes = {
                '2025-10': 13,
                '2025-11': 13,
                '2025-12': 15,
                '2026-01': 16,
                '2026-02': 16,
                '2026-03': 15,
                '2026-04': 16,
                '2026-05': 16,
                '2026-06': 16,
                '2026-07': 16,
                '2026-08': 16,
                '2026-09': 16,
                '2026-10': 16,
                '2026-11': 16,
                '2026-12': 16
            };

            const alphaPorMes = {
                '2025-10': 12,
                '2025-11': 16,
                '2025-12': 18,
                '2026-01': 24,
                '2026-02': 27,
                '2026-03': 30,
                '2026-04': 33,
                '2026-05': 36,
                '2026-06': 39,
                '2026-07': 42,
                '2026-08': 45,
                '2026-09': 48,
                '2026-10': 51,
                '2026-11': 54,
                '2026-12': 57
            };

            const qtdStarken = starkenPorMes[mesChave] || 14;
            const qtdAlpha = alphaPorMes[mesChave] || 20;
            const totalClientes = qtdStarken + qtdAlpha;

            const starkenTab = document.getElementById('starken-tab-label');
            const alphaTab = document.getElementById('alpha-tab-label');
            if (starkenTab) starkenTab.textContent = `Starken (${qtdStarken})`;
            if (alphaTab) alphaTab.textContent = `Alpha (${qtdAlpha})`;

            const tituloCarteira = document.getElementById('carteira-clientes-titulo');
            if (tituloCarteira) {
                tituloCarteira.textContent = `Carteira de Clientes (${totalClientes} Ativos)`;
            }

            const subtitulo = document.querySelector('.section-subtitle-clients');
            if (subtitulo) {
                subtitulo.textContent = `Portf√≥lio atual de ${totalClientes} clientes da Starken e Alpha`;
            }

            console.log('üë• Contadores atualizados: Starken:', qtdStarken, '| Alpha:', qtdAlpha, '| Total:', totalClientes);
        }

        // Fun√ß√£o principal para mudar o m√™s
        function changeMes(mesChave) {
            console.log('');
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('üîÑ MUDAN√áA DE M√äS:', mesChave);
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');

            // Atualizar estado
            DashboardState.mesAtual = mesChave;

            // Atualizar todos os componentes
            console.log('üìä Atualizando KPIs...');
            KPIManager.atualizar(mesChave);

            console.log('üìà Atualizando gr√°ficos...');
            ChartManager.atualizarTodos(mesChave);

            console.log('üìÖ Atualizando per√≠odo...');
            atualizarPeriodoExibido(mesChave);

            // Atualizar tabelas dinamicamente
            console.log('üìã Atualizando tabela Starken...');
            if (typeof StarkenTableManager !== 'undefined') {
                StarkenTableManager.renderTabela(mesChave);
            }

            console.log('üìã Atualizando tabela Alpha e cards...');
            if (typeof AlphaTableManager !== 'undefined') {
                // For√ßar limpeza e re-renderiza√ß√£o
                const matrizContainer = document.getElementById('matriz-clients-container');
                if (matrizContainer) {
                    matrizContainer.innerHTML = ''; // Limpar primeiro
                }

                AlphaTableManager.renderTabela(mesChave);
                AlphaTableManager.renderMatrizCards(mesChave);

                // Atualizar dashboard de indicadores
                DashboardIndicatorsManager.render(mesChave);
            }

            // Atualizar cards visuais Alpha
            console.log('üé¥ Atualizando cards visuais Alpha...');
            renderAlphaCards(mesChave);

            console.log('üìä M√™s selecionado:', mesChave);

            // Atualizar t√≠tulo e contadores das tabs
            atualizarContadoresClientes(mesChave);

            console.log('‚úÖ Atualiza√ß√£o conclu√≠da para:', mesChave);
            console.log('');
        }

        // Mostrar menu Gest√£o apenas para CEO
        function showGestaoMenuForCEO() {
            if (typeof isCEO === 'function' && isCEO()) {
                const gestaoMenu = document.getElementById('menu-gestao-financeira');
                if (gestaoMenu) {
                    gestaoMenu.style.setProperty('display', 'flex', 'important');
                }
            }
        }

        // Fun√ß√£o para inicializar o seletor de meses dinamicamente
        function initMonthSelector() {
            const selector = document.getElementById('monthSelector');
            const mesReal = getMesAtualReal();

            // Limpar op√ß√µes existentes
            selector.innerHTML = '';

            // Obter todos os meses dispon√≠veis nos dados
            const mesesDisponiveis = Object.keys(dadosMensais).sort();

            // Adicionar cada m√™s como op√ß√£o
            mesesDisponiveis.forEach(mesChave => {
                const option = document.createElement('option');
                option.value = mesChave;

                const nomeMes = getNomeMes(mesChave);

                // Marcar se √© o m√™s atual real
                if (mesChave === mesReal) {
                    option.textContent = `${nomeMes} (Atual)`;
                    option.selected = true;
                } else if (mesChave > mesReal) {
                    option.textContent = `${nomeMes} (Proje√ß√£o)`;
                } else {
                    option.textContent = nomeMes;
                }

                selector.appendChild(option);
            });

            // Se o m√™s real n√£o existe nos dados, selecionar o mais recente
            if (!dadosMensais[mesReal]) {
                const ultimoMes = mesesDisponiveis[mesesDisponiveis.length - 1];
                selector.value = ultimoMes;
                DashboardState.mesAtual = ultimoMes;
            }

            console.log('üìÖ Seletor de meses inicializado');
        }

        // Fun√ß√£o para atualizar o per√≠odo exibido
        function atualizarPeriodoExibido(mesChave) {
            const periodoElement = document.getElementById('periodo-atual');
            if (periodoElement) {
                periodoElement.textContent = getNomeMes(mesChave);
            }
        }

        // ==========================================
        // TABELA STARKEN DIN√ÇMICA POR M√äS
        // ==========================================

        const StarkenTableManager = {
            // Busca dados dos clientes do localStorage
            getClientesStarken: function(mesChave) {
                const todosClientes = getManualClients();
                const deletedIds = getDeletedCards();

                // Filtrar apenas Starken, ativos no m√™s e n√£o deletados
                // IMPORTANTE: Excluir cards de renova√ß√£o e proje√ß√£o (n√£o contam na receita)
                const clientes = todosClientes
                    .filter(c => c.empresa === 'starken')
                    .filter(c => c.mesInicio <= mesChave)
                    .filter(c => !deletedIds.includes(c.id))
                    .filter(c => !c.statusRenovacao) // N√ÉO contar renova√ß√µes
                    .filter(c => !c.isProjecao) // N√ÉO contar proje√ß√µes
                    .filter(c => {
                        // TCV: apenas no m√™s de pagamento
                        if (c.tipoValor === 'tcv') {
                            return c.mesInicio === mesChave;
                        }
                        return true; // MRR sempre conta
                    })
                    .map(c => {
                        // üéØ Verificar se h√° ajuste mensal para este m√™s
                        const ajusteMensal = c.ajustesMensais && c.ajustesMensais[mesChave];

                        // üéØ Verificar se MRR j√° chegou no m√™s do primeiro vencimento
                        let mrrTemReceita = true;
                        if (c.tipoValor === 'mrr' && c.dataPagamentoMRR) {
                            const mesPrimeiroVencimento = c.dataPagamentoMRR.substring(0, 7); // YYYY-MM
                            mrrTemReceita = mesChave >= mesPrimeiroVencimento;
                        }

                        let valorAtual = ajusteMensal ? ajusteMensal.valor : c.valor;

                        // Se MRR ainda n√£o chegou no primeiro vencimento, zerar
                        if (!mrrTemReceita) {
                            valorAtual = 0;
                        }

                        return {
                            nome: c.nome,
                            cidade: c.categoria,
                            mrr: valorAtual,
                            valorBruto: valorAtual || 0,
                            valorLiquido: valorAtual || 0, // Starken n√£o tem desconto, bruto = l√≠quido
                            status: c.mesInicio === mesChave ? 'novo' : 'active',
                            ajusteMensal: ajusteMensal
                        };
                    });

                const totalMRR = clientes.reduce((sum, c) => sum + (c.mrr || 0), 0);
                const valorBrutoTotal = clientes.reduce((sum, c) => sum + (c.valorBruto || 0), 0);
                const valorLiquidoTotal = clientes.reduce((sum, c) => sum + (c.valorLiquido || 0), 0);
                const projecaoMRRAnual = totalMRR * 12;

                return {
                    clientes,
                    totalMRR,
                    totalClientes: clientes.length,
                    valorBrutoTotal,
                    valorLiquidoTotal,
                    projecaoMRRAnual
                };
            },

            renderTabela: function(mesChave) {
                const { clientes, totalMRR, totalClientes, valorBrutoTotal, valorLiquidoTotal, projecaoMRRAnual } = this.getClientesStarken(mesChave);
                const tbody = document.getElementById('starken-table-body');

                if (!tbody) return;

                let html = '';

                clientes.forEach(cliente => {
                    html += '<tr>';
                    html += `<td><strong>${cliente.nome}</strong></td>`;
                    html += `<td>${cliente.cidade}</td>`;

                    if (cliente.status === 'bonus') {
                        html += '<td><span class="badge-bonus">B√¥nus</span></td>';
                    } else if (cliente.mrrExtra) {
                        html += `<td>R$ ${cliente.mrr.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} ${cliente.mrrExtra}</td>`;
                    } else {
                        html += `<td>R$ ${cliente.mrr.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>`;
                    }

                    // Badge de status
                    if (cliente.status === 'projecao') {
                        html += '<td><span class="badge-projecao-status">Proje√ß√£o</span></td>';
                    } else if (cliente.status === 'novo') {
                        html += '<td><span class="badge-new">Novo</span></td>';
                    } else {
                        html += '<td><span class="badge-active">Ativo</span></td>';
                    }
                    html += '</tr>';
                });

                // Linha de totais
                html += `<tr style="background: #f0f4f1; font-weight: 700;">`;
                html += `<td colspan="2" style="text-align: right;">TOTAL MRR:</td>`;
                html += `<td style="color: #4A6B54;">R$ ${totalMRR.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>`;
                html += `<td></td>`;
                html += '</tr>';

                tbody.innerHTML = html;

                // Atualizar header
                document.getElementById('starken-clientes-label').textContent = `Empresa Matriz ¬∑ ${totalClientes} Clientes`;
                document.getElementById('starken-mrr-total').textContent = 'R$ ' + totalMRR.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                // Atualizar indicadores
                const valorBrutoEl = document.getElementById('starken-valor-bruto');
                const valorLiquidoEl = document.getElementById('starken-valor-liquido');
                const projecaoMRREl = document.getElementById('starken-projecao-mrr');

                if (valorBrutoEl) valorBrutoEl.textContent = 'R$ ' + valorBrutoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (valorLiquidoEl) valorLiquidoEl.textContent = 'R$ ' + valorLiquidoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (projecaoMRREl) projecaoMRREl.textContent = 'R$ ' + projecaoMRRAnual.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                console.log('‚úÖ Indicadores Starken atualizados: Bruto:', valorBrutoTotal, ', L√≠quido:', valorLiquidoTotal, ', Proje√ß√£o:', projecaoMRRAnual);
            }
        };

        // ==========================================
        // TABELA ALPHA DIN√ÇMICA POR M√äS
        // ==========================================

        const AlphaTableManager = {
            // Busca dados dos clientes do localStorage (mesma fonte dos cards)
            getClientesAlpha: function(mesChave) {
                const todosClientes = getManualClients();
                const deletedIds = getDeletedCards();

                // LOG: Todos os clientes Alpha
                const todosAlpha = todosClientes.filter(c => c.empresa === 'alpha');
                console.log('üìä TOTAL clientes Alpha no localStorage:', todosAlpha.length);
                console.log('   Nomes:', todosAlpha.map(c => c.nome));

                // LOG: Clientes deletados
                const alphaDeletados = todosAlpha.filter(c => deletedIds.includes(c.id));
                console.log('üóëÔ∏è Clientes Alpha DELETADOS:', alphaDeletados.length, alphaDeletados.map(c => c.nome));

                // LOG: Renova√ß√µes e Proje√ß√µes
                const renovacoes = todosAlpha.filter(c => c.statusRenovacao);
                const projecoes = todosAlpha.filter(c => c.isProjecao);
                console.log('üîÑ Renova√ß√µes (agora INCLU√çDAS na tabela):', renovacoes.length, renovacoes.map(c => c.nome));
                console.log('üìä Proje√ß√µes (agora INCLU√çDAS na tabela):', projecoes.length, projecoes.map(c => c.nome));

                // Filtrar apenas Alpha, ativos no m√™s e n√£o deletados
                // MUDAN√áA: Agora INCLUI renova√ß√µes e proje√ß√µes na tabela (para mostrar todos os 23 clientes)
                const clientes = todosClientes
                    .filter(c => c.empresa === 'alpha')
                    .filter(c => !deletedIds.includes(c.id))
                    // Removido filtro de renova√ß√µes e proje√ß√µes - todos aparecem agora!
                    .filter(c => {
                        // üéØ PRIORIDADE: Se tem MESES PERSONALIZADOS, usar eles!
                        if (c.mesesPersonalizados && c.mesesPersonalizados.length > 0) {
                            return c.mesesPersonalizados.includes(mesChave);
                        }

                        // Sen√£o, usar l√≥gica autom√°tica
                        // TCV: apenas no m√™s de pagamento
                        if (c.tipoValor === 'tcv') {
                            const mesPagamento = (c.dataPagamentoTCV || c.mesInicio || '').substring(0, 7);
                            return mesPagamento === mesChave;
                        }
                        // MRR: aparece de mesInicio at√© 12 meses depois
                        if (c.tipoValor === 'mrr') {
                            if (!c.mesInicio) return false;

                            const [anoInicio, mesInicio] = c.mesInicio.split('-').map(Number);
                            const dataInicio = new Date(anoInicio, mesInicio - 1, 1);
                            const dataFim = new Date(dataInicio);
                            dataFim.setMonth(dataFim.getMonth() + 12);

                            const [anoMes, mesMes] = mesChave.split('-').map(Number);
                            const dataMes = new Date(anoMes, mesMes - 1, 1);

                            return dataMes >= dataInicio && dataMes < dataFim;
                        }
                        return false;
                    })
                    .map(c => {
                        // üéØ Verificar se h√° ajuste mensal para este m√™s (APENAS MRR)
                        const ajusteMensal = c.tipoValor === 'mrr' && c.ajustesMensais && c.ajustesMensais[mesChave];

                        // üéØ Verificar se MRR j√° chegou no m√™s do primeiro vencimento
                        let mrrTemReceita = true;
                        if (c.tipoValor === 'mrr' && c.dataPagamentoMRR) {
                            const mesPrimeiroVencimento = c.dataPagamentoMRR.substring(0, 7); // YYYY-MM
                            mrrTemReceita = mesChave >= mesPrimeiroVencimento;
                        }

                        // Calcular valores bruto e l√≠quido (MESMA L√ìGICA DOS CARDS)
                        let valorBruto = ajusteMensal ? ajusteMensal.valor : c.valor;
                        let valorLiquido = c.valorLiquido || c.valor;

                        // ===== MRR =====
                        if (c.tipoValor === 'mrr') {
                            // Se MRR ainda n√£o chegou no primeiro vencimento, zerar
                            if (!mrrTemReceita) {
                                valorBruto = 0;
                                valorLiquido = 0;
                            } else if (ajusteMensal) {
                                // Se tem ajuste mensal, recalcular o l√≠quido
                                valorLiquido = valorBruto;
                                if (c.empresa === 'alpha') {
                                    valorLiquido = valorBruto * 0.85; // - 15% royalty
                                }
                                if (c.taxaJuros > 0) {
                                    valorLiquido = valorLiquido * (1 - c.taxaJuros / 100);
                                }
                            } else {
                                // Recalcular l√≠quido mesmo sem ajuste para garantir consist√™ncia
                                valorLiquido = valorBruto;
                                if (c.empresa === 'alpha') {
                                    valorLiquido = valorBruto * 0.85;
                                }
                                if (c.taxaJuros > 0) {
                                    valorLiquido = valorLiquido * (1 - c.taxaJuros / 100);
                                }
                            }
                        }

                        // ===== TCV =====
                        let valorTCVBruto = 0;
                        let valorTCVLiquido = 0;
                        if (c.tipoValor === 'tcv') {
                            // Usar tcvTotal se existir
                            valorBruto = c.tcvTotal || c.valor || 0;

                            // Verificar se tem receita neste m√™s
                            const temReceitaNestesMes = c.tcvMesesReceita && c.tcvMesesReceita.length > 0
                                ? c.tcvMesesReceita.includes(mesChave)
                                : true;

                            if (!temReceitaNestesMes) {
                                // Sem receita neste m√™s
                                valorTCVBruto = 0;
                                valorTCVLiquido = 0;
                            } else {
                                valorTCVBruto = valorBruto;

                                // Calcular l√≠quido (MESMA L√ìGICA DOS CARDS)
                                if (c.valorLiquidoManual) {
                                    // Usar valor l√≠quido manual se configurado
                                    valorTCVLiquido = c.valorLiquidoManual;
                                } else if (c.origem === 'repasse-matriz' && c.empresa === 'alpha') {
                                    // REPASSE MATRIZ: 50% do bruto
                                    valorTCVLiquido = valorBruto * 0.50;
                                } else {
                                    // OUTROS CASOS: Aplicar royalty + taxa
                                    valorTCVLiquido = valorBruto;
                                    if (c.empresa === 'alpha') {
                                        valorTCVLiquido = valorBruto * 0.85; // - 15% royalty
                                    }
                                    if (c.taxaJuros > 0) {
                                        valorTCVLiquido = valorTCVLiquido * (1 - c.taxaJuros / 100);
                                    }
                                }
                            }
                        }

                        return {
                            nome: c.nome,
                            modelo: c.origem || c.categoria,
                            tipoValor: c.tipoValor,
                            valorBruto: c.tipoValor === 'mrr' ? valorBruto : valorTCVBruto,
                            valorLiquido: c.tipoValor === 'mrr' ? valorLiquido : valorTCVLiquido,
                            mrr: c.tipoValor === 'mrr' ? valorLiquido : 0,
                            mrrBruto: c.tipoValor === 'mrr' ? valorBruto : 0,
                            tcv: valorTCVBruto,
                            tcvLiquido: valorTCVLiquido,
                            status: c.mesInicio === mesChave ? 'novo' : 'active',
                            isContratoFechado: c.isContratoFechado,
                            ajusteMensal: ajusteMensal
                        };
                    });

                return this.calcularTotais(clientes);
            },

            calcularTotais: function(clientes) {
                const totalMRR = clientes.reduce((sum, c) => sum + (c.mrr || 0), 0);
                const totalMRRBruto = clientes.reduce((sum, c) => sum + (c.mrrBruto || 0), 0);
                const totalTCVBruto = clientes.reduce((sum, c) => sum + (c.tcv || 0), 0);
                const totalTCVLiquido = clientes.reduce((sum, c) => sum + (c.tcvLiquido || 0), 0);
                const totalClientes = clientes.length;

                // Total da tabela: MRR L√≠quido + TCV L√≠quido
                const totalTabela = totalMRR + totalTCVLiquido;

                // Valor Bruto Total: MRR Bruto + TCV Bruto
                const valorBrutoTotal = totalMRRBruto + totalTCVBruto;

                // üëë Royalties Alpha: 15% sobre valor bruto
                const royaltiesAlpha = valorBrutoTotal * 0.15;

                // üí≥ Calcular Taxas de Cart√£o com base nos clientes
                let taxasCartaoTotal = 0;
                clientes.forEach(c => {
                    // Buscar dados completos do cliente no localStorage para pegar taxaJuros
                    const todosClientes = getManualClients();
                    const clienteCompleto = todosClientes.find(cli => cli.nome === c.nome && cli.empresa === 'alpha');

                    if (clienteCompleto && clienteCompleto.taxaJuros > 0) {
                        // Calcular taxa de cart√£o sobre o valor bruto
                        const valorBase = c.tipoValor === 'mrr' ? c.mrrBruto : c.tcv;
                        const taxaValor = valorBase * (clienteCompleto.taxaJuros / 100);
                        taxasCartaoTotal += taxaValor;
                    }
                });

                // üíº Calcular Comiss√£o de Repasse (apenas para TCV)
                // F√≥rmula: Comiss√£o = Valor do Contrato √∑ Dura√ß√£o (meses)
                let comissaoRepasseTotal = 0;
                const todosClientesComissao = getManualClients();

                console.log('üîç DEBUG Comiss√£o - Total de clientes na tabela:', clientes.length);
                console.log('üîç Clientes TCV nesta lista:', clientes.filter(c => c.tipoValor === 'tcv').map(c => c.nome));

                clientes.forEach((c, index) => {
                    // S√≥ calcular comiss√£o para TCV que N√ÉO s√£o proje√ß√µes ou renova√ß√µes
                    if (c.tipoValor === 'tcv' && c.tcv > 0 && !c.isProjecao && !c.statusRenovacao) {
                        console.log('üîç Cliente TCV encontrado:', c.nome, '| TCV:', c.tcv);

                        // Buscar dados completos para pegar dura√ß√£o
                        const clienteCompleto = todosClientesComissao.find(cli => cli.nome === c.nome && cli.empresa === 'alpha');

                        if (clienteCompleto) {
                            // Tentar m√∫ltiplos campos de dura√ß√£o com prioridade
                            // 1. duracao (campo novo espec√≠fico)
                            // 2. mesesTrabalho (campo antigo)
                            // 3. Calcular baseado nas datas se existirem
                            // 4. Padr√£o: 3 meses
                            let duracao = clienteCompleto.duracao || clienteCompleto.mesesTrabalho;

                            // Se ainda n√£o tem dura√ß√£o, tentar calcular pelas datas
                            if (!duracao && clienteCompleto.dataPagamentoTCV && clienteCompleto.mesInicio) {
                                const dataInicio = new Date(clienteCompleto.mesInicio + '-01');
                                const dataPagamento = new Date(clienteCompleto.dataPagamentoTCV);
                                const mesesDiff = (dataPagamento.getFullYear() - dataInicio.getFullYear()) * 12 +
                                                 (dataPagamento.getMonth() - dataInicio.getMonth());
                                duracao = Math.max(1, mesesDiff);
                                console.log('üìÖ Dura√ß√£o calculada por datas:', duracao, 'meses');
                            }

                            // Fallback final: 3 meses
                            duracao = duracao || 3;

                            const valorContrato = clienteCompleto.tcvTotal || clienteCompleto.valor || 0;

                            console.log('üîç Cliente:', clienteCompleto.nome, '| Dura√ß√£o:', duracao, 'meses | Valor:', valorContrato);

                            if (duracao > 0 && valorContrato > 0) {
                                const comissao = valorContrato / duracao;
                                console.log('‚úÖ Comiss√£o:', comissao.toFixed(2), '=', valorContrato, '√∑', duracao);
                                comissaoRepasseTotal += comissao;
                                console.log('üìä Total acumulado at√© agora:', comissaoRepasseTotal.toFixed(2));
                            } else {
                                console.log('‚ö†Ô∏è N√£o pode calcular - duracao:', duracao, 'valor:', valorContrato);
                            }
                        } else {
                            console.log('‚ùå Cliente completo n√£o encontrado para:', c.nome);
                        }
                    }
                });

                const totalClientesTCVProcessados = clientes.filter(c => c.tipoValor === 'tcv' && c.tcv > 0).length;
                console.log('üìä RESUMO COMISS√ÉO:');
                console.log('   - Clientes TCV processados:', totalClientesTCVProcessados);
                console.log('   - Total Comiss√£o Repasse:', comissaoRepasseTotal.toFixed(2));

                // Valor L√≠quido Total: MRR L√≠quido + TCV L√≠quido (mesmo que totalTabela)
                const valorLiquidoTotal = totalMRR + totalTCVLiquido;

                // üéØ Lucro Final Starken: Valor L√≠quido (que j√° desconta royalties e taxas)
                const lucroFinalStarken = valorLiquidoTotal;

                // Proje√ß√£o MRR Anual: MRR L√≠quido √ó 12
                const projecaoMRRAnual = totalMRR * 12;

                return {
                    clientes,
                    totalMRR,
                    totalTCVBruto,
                    totalTCVLiquido,
                    totalClientes,
                    totalTabela,
                    valorBrutoTotal,
                    royaltiesAlpha,
                    taxasCartaoTotal,
                    comissaoRepasseTotal,
                    valorLiquidoTotal,
                    lucroFinalStarken,
                    projecaoMRRAnual
                };
            },

            renderBadge: function(modelo) {
                const badges = {
                    // Origens de canal
                    'outbound': '<span class="badge-outbound">Outbound</span>',
                    'Outbound': '<span class="badge-outbound">Outbound</span>',
                    'growth-hub': '<span class="badge-growth">Growth Hub</span>',
                    'Growth Hub': '<span class="badge-growth">Growth Hub</span>',
                    'repasse-matriz': '<span class="badge-envio">Repasse Matriz</span>',
                    'Envio Matriz': '<span class="badge-envio">Envio Matriz</span>',
                    'Matriz TCV': '<span class="badge-envio">Matriz TCV</span>',
                    'inbound': '<span class="badge-growth">Inbound</span>',
                    'Inbound': '<span class="badge-growth">Inbound</span>',
                    'outros': '<span class="badge-active">Outros</span>',
                    'Outros': '<span class="badge-active">Outros</span>',
                    // Tipo de valor (legacy)
                    'MRR': '<span class="badge-outbound">MRR</span>',
                };
                return badges[modelo] || `<span class="badge-active">${modelo || 'N/A'}</span>`;
            },

            renderStatus: function(cliente) {
                if (cliente.status === 'active') {
                    return '<span class="badge-active">Ativo</span>';
                }
                if (cliente.status === 'tcv') {
                    return '<span class="badge-tcv">TCV Pago</span>';
                }
                if (cliente.status === 'novo') {
                    return `<span class="badge-new">Novo ${cliente.dataInicio || ''}</span>`;
                }
                if (cliente.status === 'projecao') {
                    return '<span class="badge-projecao-status">Proje√ß√£o</span>';
                }
                if (cliente.status === 'renovacao') {
                    return `<span class="badge-renovacao">${cliente.statusLabel || 'Renova√ß√£o'}</span>`;
                }
                if (cliente.status === 'aguardando') {
                    return `<span class="badge-pending">Aguard. ${cliente.aguardando}</span>`;
                }
                return '<span class="badge-active">Ativo</span>';
            },

            // Renderizar cards de clientes Matriz
            renderMatrizCards: function(mesChave) {
                console.log('üé¥ renderMatrizCards chamado para:', mesChave);
                const container = document.getElementById('matriz-clients-container');
                if (!container) {
                    console.error('‚ùå Container matriz-clients-container n√£o encontrado!');
                    return;
                }

                // N√ÉO GERAR MAIS CARDS AUTOM√ÅTICOS - apenas limpar
                container.innerHTML = '';
                console.log('‚úÖ Cards Matriz desabilitados - adicionar manualmente via "+ Novo Cliente"');
                return;

                // ===== C√ìDIGO ANTIGO DESABILITADO =====
                let html = '';

                // Helper para criar card
                const criarCard = (num, tipo, valor, info) => {
                    let classe = 'client-card';
                    let valorHtml = '';

                    if (tipo === 'projecao') {
                        classe += ' projecao-client';
                        valorHtml = `<div class="client-value">R$ ${valor.toLocaleString('pt-BR')} TCV</div>`;
                    } else if (tipo === 'aguardando') {
                        classe += ' aguardando-client';
                        valorHtml = `<div class="client-value">${info}</div>`;
                    } else if (tipo === 'renovacao') {
                        classe += ' renovacao-client';
                        valorHtml = `<div class="client-value">R$ ${valor.toLocaleString('pt-BR')}/m√™s</div>`;
                    } else if (tipo === 'mrr') {
                        valorHtml = `<div class="client-value">R$ ${valor.toLocaleString('pt-BR')}/m√™s</div>`;
                    }

                    return `
                        <div class="${classe}">
                            <div class="client-logo">üè¢</div>
                            <h3 class="client-name">Cliente Matriz ${num}</h3>
                            <p class="client-category">Envio Matriz${info && tipo !== 'aguardando' ? ' - ' + info : ''}</p>
                            ${valorHtml}
                        </div>`;
                };

                // Novembro - sem cards Matriz
                if (mesChave === '2025-11') {
                    container.innerHTML = '';
                    return;
                }

                // Dezembro - Matriz 1-4 com valor TCV
                if (mesChave === '2025-12') {
                    for (let i = 1; i <= 4; i++) {
                        html += criarCard(i, 'projecao', 3000, 'TCV');
                    }
                }

                // Janeiro - Matriz 1-4 aguardando + Matriz 5-7 TCV
                if (mesChave === '2026-01') {
                    for (let i = 1; i <= 4; i++) {
                        html += criarCard(i, 'aguardando', 0, 'Aguard. Mar');
                    }
                    for (let i = 5; i <= 7; i++) {
                        html += criarCard(i, 'projecao', 3000, 'TCV');
                    }
                }

                // Fevereiro - Matriz 1-4 aguardando Mar + Matriz 5-7 aguardando Abr + Matriz 8-10 TCV
                if (mesChave === '2026-02') {
                    for (let i = 1; i <= 4; i++) {
                        html += criarCard(i, 'aguardando', 0, 'Aguard. Mar');
                    }
                    for (let i = 5; i <= 7; i++) {
                        html += criarCard(i, 'aguardando', 0, 'Aguard. Abr');
                    }
                    for (let i = 8; i <= 10; i++) {
                        html += criarCard(i, 'projecao', 3000, 'TCV');
                    }
                }

                // Mar√ßo - Matriz 1-4 renovam + Matriz 5-7 aguardando + Matriz 8-10 aguardando + Matriz 11-13 TCV
                if (mesChave === '2026-03') {
                    for (let i = 1; i <= 4; i++) {
                        html += criarCard(i, 'renovacao', 2000, '');
                    }
                    for (let i = 5; i <= 7; i++) {
                        html += criarCard(i, 'aguardando', 0, 'Aguard. Abr');
                    }
                    for (let i = 8; i <= 10; i++) {
                        html += criarCard(i, 'aguardando', 0, 'Aguard. Mai');
                    }
                    for (let i = 11; i <= 13; i++) {
                        html += criarCard(i, 'projecao', 3000, 'TCV');
                    }
                }

                // Abril - Matriz 1-4 MRR + Matriz 5-7 renovam + Matriz 8-10 aguardando + Matriz 11-13 aguardando + Matriz 14-16 TCV
                if (mesChave === '2026-04') {
                    for (let i = 1; i <= 4; i++) {
                        html += criarCard(i, 'mrr', 2000, 'MRR');
                    }
                    for (let i = 5; i <= 7; i++) {
                        html += criarCard(i, 'renovacao', 2000, '');
                    }
                    for (let i = 8; i <= 10; i++) {
                        html += criarCard(i, 'aguardando', 0, 'Aguard. Mai');
                    }
                    for (let i = 11; i <= 13; i++) {
                        html += criarCard(i, 'aguardando', 0, 'Aguard. Jun');
                    }
                    for (let i = 14; i <= 16; i++) {
                        html += criarCard(i, 'projecao', 3000, 'TCV');
                    }
                }

                // Maio em diante - padr√£o din√¢mico
                const mesesFuturos = ['2026-05', '2026-06', '2026-07', '2026-08', '2026-09', '2026-10', '2026-11', '2026-12'];
                if (mesesFuturos.includes(mesChave)) {
                    // Todos MRR acumulados
                    const mesIndex = mesesFuturos.indexOf(mesChave);
                    const totalMatrizMRR = 4 + (mesIndex + 2) * 3; // Cresce 3 por m√™s a partir de Abril

                    for (let i = 1; i <= Math.min(totalMatrizMRR, 20); i++) {
                        html += criarCard(i, 'mrr', 2000, 'MRR');
                    }
                    // Novos TCV do m√™s
                    for (let i = totalMatrizMRR + 1; i <= totalMatrizMRR + 3; i++) {
                        html += criarCard(i, 'projecao', 3000, 'TCV');
                    }
                }

                container.innerHTML = html;
                console.log('üé¥ Cards Matriz atualizados. HTML length:', html.length, 'para m√™s:', mesChave);
            },

            renderTabela: function(mesChave) {
                console.log('üìã AlphaTableManager.renderTabela chamado para:', mesChave);
                const { clientes, totalMRR, totalTCVBruto, totalTCVLiquido, totalClientes, totalTabela, valorBrutoTotal, royaltiesAlpha, taxasCartaoTotal, comissaoRepasseTotal, valorLiquidoTotal, lucroFinalStarken, projecaoMRRAnual } = this.getClientesAlpha(mesChave);
                console.log('üìã Clientes Alpha:', totalClientes, '| MRR:', totalMRR, '| TCV Bruto:', totalTCVBruto, '| TCV L√≠quido:', totalTCVLiquido);
                console.log('üí∞ Financeiro Alpha - Bruto:', valorBrutoTotal, '| Royalties:', royaltiesAlpha, '| Taxas:', taxasCartaoTotal, '| Comiss√£o Repasse:', comissaoRepasseTotal, '| L√≠quido:', valorLiquidoTotal);

                const tbody = document.getElementById('alpha-table-body');

                if (!tbody) {
                    console.error('‚ùå alpha-table-body n√£o encontrado!');
                    return;
                }

                // Tamb√©m renderizar os cards Matriz
                this.renderMatrizCards(mesChave);

                let html = '';

                clientes.forEach(cliente => {
                    const isProjecao = cliente.status === 'projecao';
                    const isRenovacao = cliente.status === 'renovacao';
                    const isTCV = cliente.tipoValor === 'tcv';
                    const isMRR = cliente.tipoValor === 'mrr';
                    const rowStyle = isProjecao ? 'background: #fffde7;' : (isRenovacao ? 'background: #e8f5e9;' : '');

                    // Nome com badges de proje√ß√£o/renova√ß√£o e contrato fechado
                    let nomeHtml = `<strong>${cliente.nome}</strong>`;
                    if (isProjecao) nomeHtml += ' <span class="badge-projecao">üìä</span>';
                    if (isRenovacao) nomeHtml += ' <span style="color:#4CAF50">üîÑ</span>';
                    if (cliente.isContratoFechado) nomeHtml += ' <span style="color:#4CAF50;font-size:16px;" title="Contrato Fechado">‚úÖ</span>';

                    html += `<tr style="${rowStyle}">`;
                    html += `<td>${nomeHtml}</td>`;

                    // Badge de Tipo (TCV/MRR)
                    if (isTCV) {
                        html += `<td><span class="badge-tcv">TCV</span></td>`;
                    } else if (isMRR) {
                        html += `<td><span style="background:#4CAF50;color:white;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600;">MRR</span></td>`;
                    } else {
                        html += `<td>-</td>`;
                    }

                    // Badge de Origem
                    html += `<td>${this.renderBadge(cliente.modelo)}</td>`;

                    // Valores
                    html += `<td>${cliente.mrr > 0 ? 'R$ ' + cliente.mrr.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '-'}</td>`;
                    html += `<td style="${cliente.tcv > 0 ? 'color: #FFC107; font-weight: 700;' : ''}">${cliente.tcv > 0 ? 'R$ ' + cliente.tcv.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '-'}</td>`;
                    html += `<td style="${cliente.tcvLiquido > 0 ? 'color: #11998e; font-weight: 700;' : ''}">${cliente.tcvLiquido > 0 ? 'R$ ' + cliente.tcvLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '-'}</td>`;
                    html += `<td>${this.renderStatus(cliente)}</td>`;
                    html += '</tr>';
                });

                // Linha de totais
                html += `<tr style="background: #f0f4f1; font-weight: 700;">`;
                html += `<td colspan="3" style="text-align: right;">TOTAIS:</td>`;
                html += `<td style="color: #4A6B54;">R$ ${totalMRR.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>`;
                html += `<td style="color: #FFC107;">R$ ${totalTCVBruto.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>`;
                html += `<td style="color: #11998e;">R$ ${totalTCVLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>`;
                html += `<td style="color: #2c3e50;">R$ ${totalTabela.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>`;
                html += '</tr>';

                tbody.innerHTML = html;
                console.log('üìã Tabela Alpha atualizada com', clientes.length, 'linhas');

                // Atualizar header
                const labelEl = document.getElementById('alpha-clientes-label');
                const mrrEl = document.getElementById('alpha-mrr-total');
                const tcvEl = document.getElementById('alpha-tcv-total');
                const totalEl = document.getElementById('alpha-total-mes');

                if (labelEl) labelEl.textContent = `Projeto Nichado ¬∑ ${totalClientes} Clientes`;
                if (mrrEl) mrrEl.textContent = 'R$ ' + totalMRR.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (tcvEl) tcvEl.textContent = 'R$ ' + totalTCVBruto.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (totalEl) totalEl.textContent = 'R$ ' + totalTabela.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                // Atualizar indicadores
                const valorBrutoEl = document.getElementById('alpha-valor-bruto');
                const royaltiesEl = document.getElementById('alpha-royalties');
                const taxasCartaoEl = document.getElementById('alpha-taxas-cartao');
                const valorLiquidoEl = document.getElementById('alpha-valor-liquido');
                const lucroFinalEl = document.getElementById('alpha-lucro-final');
                const projecaoMRREl = document.getElementById('alpha-projecao-mrr');

                if (valorBrutoEl) valorBrutoEl.textContent = 'R$ ' + valorBrutoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (royaltiesEl) royaltiesEl.textContent = 'R$ ' + royaltiesAlpha.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (taxasCartaoEl) taxasCartaoEl.textContent = 'R$ ' + taxasCartaoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (valorLiquidoEl) valorLiquidoEl.textContent = 'R$ ' + valorLiquidoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (lucroFinalEl) lucroFinalEl.textContent = 'R$ ' + lucroFinalStarken.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (projecaoMRREl) projecaoMRREl.textContent = 'R$ ' + projecaoMRRAnual.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                console.log('‚úÖ Header Alpha atualizado: ', totalClientes, 'clientes, MRR:', totalMRR, ', TCV Bruto:', totalTCVBruto);
                console.log('‚úÖ Indicadores atualizados: Bruto:', valorBrutoTotal, ', Royalties:', royaltiesAlpha, ', Taxas:', taxasCartaoTotal, ', L√≠quido:', valorLiquidoTotal, ', Lucro Final:', lucroFinalStarken, ', Proje√ß√£o:', projecaoMRRAnual);
            }
        };

        // ==========================================
        // DASHBOARD DE INDICADORES - ENTRE CARDS E TABELAS
        // ==========================================

        const DashboardIndicatorsManager = {
            render: function(mesChave) {
                console.log('üìä DashboardIndicatorsManager.render chamado para:', mesChave);

                // Buscar dados das duas empresas
                const dadosStarken = StarkenTableManager.getClientesStarken(mesChave);
                const dadosAlpha = AlphaTableManager.getClientesAlpha(mesChave);

                // ===== INDICADORES STARKEN =====
                const dashStarkenMrr = document.getElementById('dash-starken-mrr');
                const dashStarkenBruto = document.getElementById('dash-starken-bruto');
                const dashStarkenLiquido = document.getElementById('dash-starken-liquido');
                const dashStarkenProjecao = document.getElementById('dash-starken-projecao');

                if (dashStarkenMrr) dashStarkenMrr.textContent = 'R$ ' + dadosStarken.totalMRR.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashStarkenBruto) dashStarkenBruto.textContent = 'R$ ' + dadosStarken.valorBrutoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashStarkenLiquido) dashStarkenLiquido.textContent = 'R$ ' + dadosStarken.valorLiquidoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashStarkenProjecao) dashStarkenProjecao.textContent = 'R$ ' + dadosStarken.projecaoMRRAnual.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                // ===== INDICADORES ALPHA =====
                const dashAlphaMrr = document.getElementById('dash-alpha-mrr');
                const dashAlphaTcvBruto = document.getElementById('dash-alpha-tcv-bruto');
                const dashAlphaTcvLiquido = document.getElementById('dash-alpha-tcv-liquido');
                const dashAlphaBruto = document.getElementById('dash-alpha-bruto');
                const dashAlphaRoyalties = document.getElementById('dash-alpha-royalties');
                const dashAlphaTaxas = document.getElementById('dash-alpha-taxas');
                const dashAlphaComissao = document.getElementById('dash-alpha-comissao');
                const dashAlphaLiquido = document.getElementById('dash-alpha-liquido');
                const dashAlphaProjecao = document.getElementById('dash-alpha-projecao');

                if (dashAlphaMrr) dashAlphaMrr.textContent = 'R$ ' + dadosAlpha.totalMRR.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaTcvBruto) dashAlphaTcvBruto.textContent = 'R$ ' + dadosAlpha.totalTCVBruto.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaTcvLiquido) dashAlphaTcvLiquido.textContent = 'R$ ' + dadosAlpha.totalTCVLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaBruto) dashAlphaBruto.textContent = 'R$ ' + dadosAlpha.valorBrutoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaRoyalties) dashAlphaRoyalties.textContent = 'R$ ' + dadosAlpha.royaltiesAlpha.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaTaxas) dashAlphaTaxas.textContent = 'R$ ' + dadosAlpha.taxasCartaoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaComissao) dashAlphaComissao.textContent = 'R$ ' + dadosAlpha.comissaoRepasseTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaLiquido) dashAlphaLiquido.textContent = 'R$ ' + dadosAlpha.valorLiquidoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (dashAlphaProjecao) dashAlphaProjecao.textContent = 'R$ ' + dadosAlpha.projecaoMRRAnual.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                console.log('‚úÖ Dashboard de Indicadores atualizado com sucesso!');
                console.log('üìä Starken - MRR:', dadosStarken.totalMRR, '| Bruto:', dadosStarken.valorBrutoTotal, '| L√≠quido:', dadosStarken.valorLiquidoTotal);
                console.log('üìä Alpha - MRR:', dadosAlpha.totalMRR, '| TCV Bruto:', dadosAlpha.totalTCVBruto, '| TCV L√≠quido:', dadosAlpha.totalTCVLiquido, '| Bruto:', dadosAlpha.valorBrutoTotal, '| Comiss√£o:', dadosAlpha.comissaoRepasseTotal, '| L√≠quido:', dadosAlpha.valorLiquidoTotal);
            }
        };

        // Inicializa√ß√£o do dashboard
        window.addEventListener('load', function() {
            console.log('Inicializando Dashboard Financeiro...');
            console.log('üìÖ Data atual:', new Date().toLocaleDateString('pt-BR'));

            // Inicializar seletor de meses
            initMonthSelector();

            // Inicializar gerenciadores
            KPIManager.init();

            // Carregar dados do m√™s atual (baseado na data real)
            KPIManager.atualizar(DashboardState.mesAtual);
            ChartManager.atualizarTodos(DashboardState.mesAtual);
            atualizarPeriodoExibido(DashboardState.mesAtual);

            // Renderizar tabelas
            StarkenTableManager.renderTabela(DashboardState.mesAtual);
            AlphaTableManager.renderTabela(DashboardState.mesAtual);
            AlphaTableManager.renderMatrizCards(DashboardState.mesAtual);

            // Renderizar dashboard de indicadores
            DashboardIndicatorsManager.render(DashboardState.mesAtual);

            // Atualizar contadores das tabs
            atualizarContadoresClientes(DashboardState.mesAtual);

            // Renderizar cards visuais Alpha
            renderAlphaCards(DashboardState.mesAtual);

            // Mostrar menu Gest√£o para CEO
            showGestaoMenuForCEO();

            console.log('‚úÖ Dashboard inicializado com sucesso!');
            console.log('üìÖ M√™s carregado:', DashboardState.mesAtual);

            // Carregar e renderizar clientes manuais
            renderManualClients();

            // ========================================
            // INTEGRA√á√ÉO COM STARK-CORE (Real-time)
            // ========================================

            // Escuta atualiza√ß√µes do STARK
            document.addEventListener('stark-sync', function(e) {
                console.log('üîÑ Dashboard recebendo dados do STARK:', e.detail);

                if (e.detail && e.detail.dados) {
                    const dados = e.detail.dados;
                    const mes = dados.mes || DashboardState.mesAtual;

                    // Mescla dados do banco com dados est√°ticos
                    if (!dadosMensais[mes]) {
                        dadosMensais[mes] = { receitas: { clientes: [] }, despesas: { categorias: {} } };
                    }

                    // Atualiza totais com dados do banco
                    const receitaTotal = dados.receitas.reduce((sum, r) => sum + (r.valor || 0), 0);
                    const despesaTotal = dados.despesas.reduce((sum, d) => sum + (d.valor || 0), 0);

                    dadosMensais[mes].receitas.total = receitaTotal;
                    dadosMensais[mes].despesas.total = despesaTotal;

                    // Adiciona novos clientes √† lista
                    const clientesExistentes = new Set(dadosMensais[mes].receitas.clientes.map(c => c.nome));
                    dados.receitas.forEach(r => {
                        if (r.isCustom && !clientesExistentes.has(r.nome)) {
                            dadosMensais[mes].receitas.clientes.push({
                                nome: r.nome,
                                valor: r.valor,
                                status: r.status,
                                empresa: r.categoria,
                                isCustom: true
                            });
                        }
                    });

                    console.log('üìä Dados mesclados para', mes, '- Receita:', receitaTotal, 'Despesa:', despesaTotal);

                    // Re-renderiza o dashboard se for o m√™s atual
                    if (mes === DashboardState.mesAtual) {
                        KPIManager.atualizar(mes);
                        ChartManager.atualizarTodos(mes);
                        StarkenTableManager.renderTabela(mes);
                        AlphaTableManager.renderTabela(mes);
                        DashboardIndicatorsManager.render(mes);
                        atualizarContadoresClientes(mes);

                        // Notifica visualmente
                        if (window.starkRealTime) {
                            window.starkRealTime.toast('Dashboard atualizado com novos dados!', {
                                tipo: 'success',
                                titulo: 'Dados Sincronizados',
                                icone: 'üìä',
                                duracao: 3000
                            });
                        }
                    }
                }
            });

            // For√ßa sync inicial se stark-core estiver dispon√≠vel
            setTimeout(() => {
                if (window.stark) {
                    console.log('üöÄ Solicitando sync inicial com banco...');
                    window.stark.sincronizar(true);
                }
            }, 2000);
        });

        // ========================================
        // GERENCIAMENTO DE CLIENTES MANUAIS
        // ========================================

        // Migra√ß√£o de cards est√°ticos para localStorage (executa apenas uma vez)
        function migrateStaticCardsToLocalStorage() {
            const migrationKey = 'starken_cards_migrated_v2';

            // Verificar se j√° foi migrado
            if (localStorage.getItem(migrationKey)) {
                console.log('‚úÖ Cards j√° foram migrados anteriormente');
                return;
            }

            console.log('üîÑ Iniciando migra√ß√£o de cards para localStorage...');

            // Definir todos os cards est√°ticos
            const staticCards = [
                // STARKEN (16 cards)
                { nome: 'Bengers - App Festival', categoria: 'Dev App Web (Dez-Fev) ‚Üí MRR Abr+', valor: 10000, empresa: 'starken', mesInicio: '2025-12', tipoValor: 'mrr' },
                { nome: 'The Garrison', categoria: 'Gest√£o de Tr√°fego', valor: 1500, empresa: 'starken', mesInicio: '2026-01', tipoValor: 'mrr' },
                { nome: 'Mortadella Blumenau', categoria: 'Gastronomia', valor: 2000, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Mortadella Tabajara', categoria: 'Gastronomia', valor: 0, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Hamburgueria Feio', categoria: 'Hamburgueria', valor: 2000, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Rosa Mexicano Blumenau', categoria: 'Mexicano', valor: 2000, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Rosa Mexicano Brusque', categoria: 'Mexicano', valor: 2000, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'JPR M√≥veis R√∫sticos', categoria: 'M√≥veis', valor: 2000, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Realizzati M√≥veis', categoria: 'M√≥veis', valor: 2500, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Suprema Pizza', categoria: 'Pizzaria', valor: 2000, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Shield Car Blumenau', categoria: 'Automotivo', valor: 297, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Estilo Tulipa', categoria: 'Decora√ß√£o', valor: 659, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Academia S√£o Pedro', categoria: 'Academia', valor: 1080, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Divino Tempero', categoria: 'Restaurante', valor: 1000, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Dommus Smart Home', categoria: 'Automa√ß√£o Residencial', valor: 297, empresa: 'starken', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Arena Gourmet', categoria: 'Gastronomia', valor: 1000, empresa: 'starken', mesInicio: '2026-01', tipoValor: 'mrr' },

                // ALPHA (19 cards)
                { nome: 'Oca Restaurante', categoria: 'Outbound - Restaurante', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Madrug√£o Lanches', categoria: 'Outbound - Lanchonete', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Fratellis Pizzaria', categoria: 'Outbound - Pizzaria', valor: 2500, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Saporitto Pizzaria', categoria: 'Outbound - Pizzaria', valor: 1500, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Pizzaria Don Chevico', categoria: 'Envio Matriz', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'World Burger', categoria: 'Envio Matriz', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Oficina da Massa', categoria: 'Envio Matriz', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: "Bigu's Burger", categoria: 'Envio Matriz', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Pizzaria Madrid', categoria: 'Envio Matriz', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Cazza Pizzaria', categoria: 'Envio Matriz', valor: 2000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Maki Toro Sushi', categoria: 'Growth Hub', valor: 1000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Brazza Hamburgueria', categoria: 'Blumenau - Hamburgueria', valor: 3000, empresa: 'alpha', mesInicio: '2025-10', tipoValor: 'mrr' },
                { nome: 'Fabinhus Restaurante', categoria: 'Growth Hub', valor: 1000, empresa: 'alpha', mesInicio: '2025-12', tipoValor: 'mrr' },
                { nome: 'Tempero Manero Grill', categoria: 'Growth Hub', valor: 1000, empresa: 'alpha', mesInicio: '2025-12', tipoValor: 'mrr' },
                { nome: 'Super Dupe Hamburgueria', categoria: 'MRR', valor: 2000, empresa: 'alpha', mesInicio: '2025-12', tipoValor: 'mrr' },
                { nome: 'Majo Sushi', categoria: 'MRR', valor: 2000, empresa: 'alpha', mesInicio: '2026-01', tipoValor: 'mrr' },
                { nome: 'Aseyori', categoria: 'MRR', valor: 2500, empresa: 'alpha', mesInicio: '2026-01', tipoValor: 'mrr' },
                { nome: 'Temakeria', categoria: 'MRR', valor: 1500, empresa: 'alpha', mesInicio: '2026-01', tipoValor: 'mrr' },
                { nome: 'Churrascaria Paiaguas', categoria: 'Matriz TCV', valor: 3149.75, empresa: 'alpha', mesInicio: '2025-12', tipoValor: 'tcv', tcvTotal: 3149.75, parcelas: 1 }
            ];

            // Converter para formato manual e adicionar IDs √∫nicos
            const manualCards = staticCards.map((card, index) => ({
                id: Date.now() + index,
                nome: card.nome,
                empresa: card.empresa,
                valor: card.valor,
                valorLiquido: card.empresa === 'alpha' ? card.valor * 0.85 : card.valor,
                categoria: card.categoria,
                mesInicio: card.mesInicio,
                tipoValor: card.tipoValor,
                tcvTotal: card.tcvTotal || null,
                parcelas: card.parcelas || null,
                criadoEm: new Date().toISOString(),
                migrado: true
            }));

            saveManualClients(manualCards);
            localStorage.setItem(migrationKey, 'true');

            console.log(`‚úÖ Migra√ß√£o conclu√≠da! ${manualCards.length} cards migrados para localStorage`);
        }

        // Armazenamento de clientes manuais
        function getManualClients() {
            const stored = localStorage.getItem('starken_manual_clients');
            return stored ? JSON.parse(stored) : [];
        }

        function getClientsSyncMeta() {
            const stored = localStorage.getItem('starken_clients_sync_meta');
            return stored ? JSON.parse(stored) : { updatedAt: null };
        }

        function setClientsSyncMeta(updatedAt) {
            localStorage.setItem('starken_clients_sync_meta', JSON.stringify({ updatedAt }));
        }

        function saveManualClients(clients, options = {}) {
            localStorage.setItem('starken_manual_clients', JSON.stringify(clients));
            if (!options.skipMeta) {
                setClientsSyncMeta(new Date().toISOString());
            }
        }

        // Gerenciar cards deletados (para persistir exclus√µes)
        function getDeletedCards() {
            const stored = localStorage.getItem('starken_deleted_cards');
            return stored ? JSON.parse(stored) : [];
        }

        function saveDeletedCards(ids, options = {}) {
            localStorage.setItem('starken_deleted_cards', JSON.stringify(ids));
            if (!options.skipMeta) {
                setClientsSyncMeta(new Date().toISOString());
            }
        }

        function markCardAsDeleted(clientId) {
            const deleted = getDeletedCards();
            if (!deleted.includes(clientId)) {
                deleted.push(clientId);
                saveDeletedCards(deleted);
            }
        }

        let clientsSyncInProgress = false;

        async function syncClientsWithServer(forcePush = false) {
            if (clientsSyncInProgress) {
                return { action: 'busy' };
            }
            clientsSyncInProgress = true;
            const apiBase = (window.GestaoFinanceira && GestaoFinanceira.RAILWAY_API_URL)
                ? GestaoFinanceira.RAILWAY_API_URL
                : 'https://starken-financeiro-production.up.railway.app';
            try {
                let serverPayload = null;
                try {
                    const response = await fetch(`${apiBase}/api/clientes`);
                    if (response.ok) {
                        const result = await response.json();
                        if (result && result.success) {
                            serverPayload = result.data || null;
                        }
                    }
                } catch (error) {}

                const localClients = getManualClients();
                const localDeleted = getDeletedCards();
                const localMeta = getClientsSyncMeta();
                const localUpdatedAt = localMeta && localMeta.updatedAt ? new Date(localMeta.updatedAt) : null;

                const serverClients = serverPayload && Array.isArray(serverPayload.clients) ? serverPayload.clients : [];
                const serverDeleted = serverPayload && Array.isArray(serverPayload.deleted) ? serverPayload.deleted : [];
                const serverUpdatedAt = serverPayload && serverPayload.updatedAt ? new Date(serverPayload.updatedAt) : null;

                let shouldPull = false;
                let shouldPush = false;

                if (forcePush) {
                    shouldPush = true;
                } else if (serverUpdatedAt && (!localUpdatedAt || serverUpdatedAt > localUpdatedAt)) {
                    shouldPull = true;
                } else if (localUpdatedAt && (!serverUpdatedAt || localUpdatedAt > serverUpdatedAt)) {
                    shouldPush = true;
                } else if (serverClients.length > 0 && localClients.length === 0) {
                    shouldPull = true;
                } else if (serverClients.length === 0 && localClients.length > 0) {
                    shouldPush = true;
                }

                if (shouldPull && serverClients.length > 0) {
                    saveManualClients(serverClients, { skipMeta: true });
                    saveDeletedCards(serverDeleted, { skipMeta: true });
                    const nextUpdatedAt = serverPayload.updatedAt || new Date().toISOString();
                    setClientsSyncMeta(nextUpdatedAt);
                    localStorage.setItem('starken_cards_migrated_v2', 'true');
                    return { action: 'pull' };
                }

                if (shouldPush) {
                    const payload = {
                        clients: localClients,
                        deleted: localDeleted,
                        updatedAt: localUpdatedAt ? localUpdatedAt.toISOString() : new Date().toISOString()
                    };
                    try {
                        await fetch(`${apiBase}/api/clientes`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        return { action: 'push' };
                    } catch (error) {}
                }

                return { action: 'none' };
            } finally {
                clientsSyncInProgress = false;
            }
        }

        async function syncClientsNow() {
            const btn = document.getElementById('btnSyncClients');
            const originalText = btn ? btn.textContent : null;
            if (btn) {
                btn.textContent = 'üîÑ Sincronizando...';
                btn.disabled = true;
                btn.style.opacity = '0.7';
                btn.style.cursor = 'not-allowed';
            }
            await syncClientsWithServer(true);
            await syncClientsWithServer();
            if (btn) {
                btn.textContent = originalText || 'üîÑ Sincronizar agora';
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            }
        }

        // Abrir modal
        function openClientModal() {
            const modal = document.getElementById('clientModal');
            modal.style.display = 'flex';
            modal.classList.add('active');

            // Resetar scroll do modal para o topo
            const modalBody = modal.querySelector('.client-modal');
            if (modalBody) {
                modalBody.scrollTop = 0;
            }

            document.getElementById('clientForm').reset();
            document.getElementById('clientForm').removeAttribute('data-editing-id');
            document.getElementById('clientMesInicio').value = DashboardState.mesAtual;
            document.getElementById('clientMesInicioTCV').value = DashboardState.mesAtual;

            // Resetar t√≠tulo para modo cria√ß√£o
            document.querySelector('#clientModal .modal-header h3').textContent = '‚ûï Adicionar Novo Cliente';

            toggleTCVFields();
            updateOrigemOptions();
            atualizarPreviewContrato();

            console.log('‚úÖ Modal aberto');
        }

        // Fechar modal
        function closeClientModal() {
            const modal = document.getElementById('clientModal');
            modal.style.display = 'none';
            modal.classList.remove('active');

            document.getElementById('clientForm').removeAttribute('data-editing-id');
            document.getElementById('clientForm').reset();

            console.log('‚úÖ Modal fechado');
        }

        // Toggle campos MRR/TCV
        function toggleTCVFields() {
            const tipo = document.getElementById('clientTipoValor').value;
            const camposMRR = document.getElementById('camposMRR');
            const camposTCV = document.getElementById('camposTCV');
            const campoDataPagamentoTCV = document.getElementById('campoDataPagamentoTCV');
            const campoDataVencimentoMRR = document.getElementById('campoDataVencimentoMRR');
            const valorInput = document.getElementById('clientValor');
            const tcvTipoVisibilidade = document.getElementById('tcvTipoVisibilidade');

            if (tipo === 'tcv') {
                camposMRR.style.display = 'none';
                camposTCV.style.display = 'block';
                campoDataPagamentoTCV.style.display = 'block';
                campoDataVencimentoMRR.style.display = 'none';
                valorInput.removeAttribute('required');

                // Mostrar op√ß√£o TCV se personaliza√ß√£o estiver ativa
                const mesesPersonalizados = document.getElementById('mesesPersonalizados');
                if (mesesPersonalizados.style.display !== 'none') {
                    tcvTipoVisibilidade.style.display = 'block';
                }
            } else {
                camposMRR.style.display = 'block';
                camposTCV.style.display = 'none';
                campoDataPagamentoTCV.style.display = 'none';
                campoDataVencimentoMRR.style.display = 'block';
                valorInput.setAttribute('required', 'required');
                tcvTipoVisibilidade.style.display = 'none';
            }
        }

        // Toggle personaliza√ß√£o de meses
        function toggleMesesPersonalizados() {
            const painel = document.getElementById('mesesPersonalizados');
            const btn = document.getElementById('btnToggleMeses');
            const tipo = document.getElementById('clientTipoValor').value;

            if (painel.style.display === 'none') {
                painel.style.display = 'block';
                btn.textContent = 'Usar Autom√°tico';
                btn.style.background = '#dc2626';

                // Se for TCV, mostrar se√ß√£o de tipo
                if (tipo === 'tcv') {
                    document.getElementById('tcvTipoVisibilidade').style.display = 'block';
                }
            } else {
                painel.style.display = 'none';
                btn.textContent = 'Personalizar';
                btn.style.background = '#4A6B54';
                document.getElementById('tcvTipoVisibilidade').style.display = 'none';

                // Limpar checkboxes
                document.querySelectorAll('.mes-checkbox').forEach(cb => cb.checked = false);
            }
        }

        // Quando marca/desmarca um m√™s (para TCV)
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('mes-checkbox')) {
                const tipo = document.getElementById('clientTipoValor').value;
                if (tipo === 'tcv') {
                    atualizarTCVMesesConfig();
                }
            }
        });

        // Atualizar configura√ß√£o de meses TCV
        function atualizarTCVMesesConfig() {
            const mesesMarcados = [];
            document.querySelectorAll('.mes-checkbox:checked').forEach(cb => {
                mesesMarcados.push(cb.getAttribute('data-mes'));
            });

            const container = document.getElementById('tcvMesesConfig');

            if (mesesMarcados.length === 0) {
                container.innerHTML = '';
                return;
            }

            const mesesNomes = {
                '2025-10': 'Out/2025', '2025-11': 'Nov/2025', '2025-12': 'Dez/2025',
                '2026-01': 'Jan/2026', '2026-02': 'Fev/2026', '2026-03': 'Mar/2026',
                '2026-04': 'Abr/2026', '2026-05': 'Mai/2026', '2026-06': 'Jun/2026',
                '2026-07': 'Jul/2026', '2026-08': 'Ago/2026', '2026-09': 'Set/2026',
                '2026-10': 'Out/2026', '2026-11': 'Nov/2026', '2026-12': 'Dez/2026'
            };

            let html = '';
            mesesMarcados.forEach(mes => {
                const nome = mesesNomes[mes] || mes;
                html += `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px; background: white; border-radius: 6px; margin-bottom: 6px;">
                        <span style="font-size: 12px; font-weight: 600; color: #374151;">${nome}</span>
                        <select class="tcv-mes-tipo" data-mes="${mes}" style="padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 11px;">
                            <option value="trabalho">‚öôÔ∏è Trabalho (sem receita)</option>
                            <option value="receita">üí∞ Receita (com valor)</option>
                        </select>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Toggle campos de pagamento conforme forma selecionada
        function toggleCamposPagamento() {
            const formaPagamento = document.getElementById('clientFormaPagamento')?.value;
            const camposCartao = document.getElementById('camposCartao');

            if (formaPagamento === 'cartao') {
                // Mostrar campos de cart√£o
                camposCartao.style.display = 'block';
            } else {
                // Esconder campos de cart√£o
                camposCartao.style.display = 'none';
            }

            atualizarPreviewContrato();
        }

        // Toggle proje√ß√£o MRR
        function toggleProjecaoMRR() {
            const checkbox = document.getElementById('clientProjetarMRR');
            const campos = document.getElementById('camposProjecaoMRR');

            if (checkbox.checked) {
                campos.style.display = 'block';
                calcularTerminoProjecao();
            } else {
                campos.style.display = 'none';
            }
        }

        // Calcular t√©rmino da proje√ß√£o
        function calcularTerminoProjecao() {
            const inicio = document.getElementById('clientProjecaoInicio')?.value;
            const duracao = parseInt(document.getElementById('clientProjecaoDuracao')?.value) || 12;

            if (!inicio) return;

            const [ano, mes] = inicio.split('-').map(Number);
            const dataInicio = new Date(ano, mes - 1, 1);
            const dataFim = new Date(dataInicio);
            dataFim.setMonth(dataFim.getMonth() + duracao - 1);

            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
            const mesNome = meses[dataFim.getMonth()];
            const anoFim = dataFim.getFullYear();

            document.getElementById('projecaoTerminoCalc').textContent = `${mesNome}/${anoFim}`;
        }

        // Event listeners para proje√ß√£o
        document.addEventListener('change', function(e) {
            if (e.target.id === 'clientProjecaoInicio' || e.target.id === 'clientProjecaoDuracao') {
                calcularTerminoProjecao();
            }
        });

        // Atualizar preview do contrato
        function atualizarPreviewContrato() {
            const tipo = document.getElementById('clientTipoValor').value;
            const empresa = document.getElementById('clientEmpresa').value;
            const origem = document.getElementById('clientOrigem')?.value || 'outros';
            const royaltyRow = document.getElementById('previewRoyaltyRow');

            let valorBruto = 0;
            let tcvTotal = 0;
            let mesesTrabalho = parseInt(document.getElementById('clientMesesTrabalho')?.value) || 3;

            if (tipo === 'mrr') {
                valorBruto = parseFloat(document.getElementById('clientValor').value) || 0;
            } else {
                tcvTotal = parseFloat(document.getElementById('clientTCVTotal').value) || 0;
                const parcelas = parseInt(document.getElementById('clientTCVParcelas').value) || 1;
                valorBruto = tcvTotal; // Usar TCV total para c√°lculos
            }

            // C√°lculo de valores
            let royalty = 0;
            let custoComercial = 0;
            let taxaCartao = 0;
            let liquido = valorBruto;

            // REPASSE MATRIZ: C√°lculo especial (50% do valor)
            if (tipo === 'tcv' && origem === 'repasse-matriz' && empresa === 'alpha') {
                // Para Repasse Matriz: 15% royalty + 35% custo comercial = 50% total
                royalty = valorBruto * 0.15;
                custoComercial = valorBruto * 0.35;
                
                // L√≠quido √© 50% do bruto, mas a taxa incide sobre esse l√≠quido
                // Se a taxa √© aplicada no pagamento, e a Starken repassa, a taxa j√° foi descontada?
                // Se o cliente paga 100%, desconta taxa X%, sobra Y. Starken repassa 50% de Y?
                // Ou a taxa incide sobre a parte da Alpha?
                // Vamos seguir a l√≥gica inversa: 
                // Valor Bruto - (Royalty + Custo) = Valor Base
                // Valor Base - Taxa = L√≠quido
                
                const valorBase = valorBruto * 0.50; // 50% restante
                liquido = valorBase; // A taxa ser√° descontada deste valor
                
                royaltyRow.style.display = 'block';
                document.getElementById('previewRoyalty').innerHTML = `<span style="color: #ef4444;">- ${formatarMoeda(royalty)} (royalty)</span> <br> <span style="color: #ef4444;">- ${formatarMoeda(custoComercial)} (custo comercial)</span>`;
            }
            // Royalty 15% para Alpha (outros casos)
            else if (empresa === 'alpha') {
                royalty = valorBruto * 0.15;
                liquido = valorBruto - royalty;
                royaltyRow.style.display = 'block';
                document.getElementById('previewRoyalty').textContent = '- ' + formatarMoeda(royalty) + ' (royalty)';
            } else {
                royaltyRow.style.display = 'none';
            }

            // Taxa de cart√£o/boleto (aplicada AP√ìS royalty ou sobre o l√≠quido da Alpha)
            const taxaJurosPercentual = parseFloat(document.getElementById('clientTaxaJuros')?.value) || 0;
            if (taxaJurosPercentual > 0) {
                // Se for Repasse Matriz, a taxa incide sobre a parte da Alpha (o l√≠quido calculado acima)
                // 2992.93 = 3250 * (1 - 0.0791)
                taxaCartao = liquido * (taxaJurosPercentual / 100);
                liquido = liquido - taxaCartao;
            }

            // üéØ Verificar se h√° valor l√≠quido MANUAL (TCV apenas)
            const valorLiquidoManual = tipo === 'tcv' ? (parseFloat(document.getElementById('clientValorLiquidoManual')?.value) || null) : null;

            // C√°lculo espec√≠fico APENAS para Repasse Matriz TCV
            let liquidoFinal = liquido;
            let explicacao = '';

            if (tipo === 'tcv' && origem === 'repasse-matriz') {
                // REPASSE MATRIZ: Valor l√≠quido (50%) recebido integralmente no m√™s
                liquidoFinal = liquido;
                explicacao = ` (projeto de ${mesesTrabalho} meses - recebido integralmente)`;
            } else if (tipo === 'tcv') {
                // OUTROS TCV: Usar manual se fornecido, sen√£o usar calculado
                liquidoFinal = valorLiquidoManual || liquido;
                explicacao = valorLiquidoManual ? ' (valor manual)' : ' (pagamento √∫nico)';
            }

            // Atualizar preview
            document.getElementById('previewTipo').textContent = tipo.toUpperCase();
            document.getElementById('previewEmpresa').textContent = empresa === 'alpha' ? 'Alpha' : 'Starken';

            // Valor bruto
            let brutotexto = formatarMoeda(valorBruto);
            if (tipo === 'tcv') {
                brutotexto += ' total';
            } else {
                brutotexto += '/m√™s';
            }
            document.getElementById('previewBruto').textContent = brutotexto;

            // Texto do valor l√≠quido
            let liquidoTexto = formatarMoeda(liquidoFinal);

            if (tipo === 'tcv' && origem === 'repasse-matriz') {
                liquidoTexto += explicacao;
            } else if (tipo === 'tcv') {
                liquidoTexto += explicacao;
            } else {
                liquidoTexto += '/m√™s';
            }

            if (taxaJurosPercentual > 0) {
                liquidoTexto += ` (taxa ${taxaJurosPercentual}%)`;
            }

            document.getElementById('previewLiquido').textContent = liquidoTexto;

            // Atualizar preview de comiss√£o (apenas para TCV)
            if (tipo === 'tcv') {
                const duracao = parseInt(document.getElementById('clientDuracao')?.value) || 3;
                const comissao = tcvTotal / duracao;
                const comissaoPreview = document.getElementById('comissaoPreview');
                if (comissaoPreview) {
                    comissaoPreview.textContent = formatarMoeda(comissao);
                }
            }

            // Log para debug
            console.log('üìä C√°lculo:', {
                tipo,
                origem,
                valorBruto,
                royalty,
                custoComercial: origem === 'repasse-matriz' ? custoComercial : 0,
                taxaCartao: `${taxaJurosPercentual}% = R$ ${taxaCartao.toFixed(2)}`,
                liquidoFinal,
                mesesTrabalho,
                formula: origem === 'repasse-matriz' ? 'Valor √ó 50% (integral)' : 'Valor - Royalty - Taxa'
            });
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor || 0);
        }

        // Atualizar op√ß√µes de origem baseado na empresa
        function updateOrigemOptions() {
            const empresa = document.getElementById('clientEmpresa').value;
            const origemSelect = document.getElementById('clientOrigem');
            const valorAtual = origemSelect.value;
            
            // Controle de visibilidade do campo "Meses de Trabalho"
            const groupMesesTrabalho = document.getElementById('groupMesesTrabalho');
            if (groupMesesTrabalho) {
                if (empresa === 'starken') {
                    groupMesesTrabalho.style.display = 'none';
                } else {
                    groupMesesTrabalho.style.display = 'block';
                }
            }

            // Limpar op√ß√µes
            origemSelect.innerHTML = '';

            // Op√ß√µes comuns para todas as empresas
            const opcoesComuns = [
                { value: 'growth-hub', text: 'üå± Growth Hub' },
                { value: 'outbound', text: 'üìû Outbound' },
                { value: 'inbound', text: 'üéÅ Inbound' },
                { value: 'outros', text: 'üìã Outros' }
            ];

            // Adicionar "Repasse Matriz" APENAS para Alpha
            if (empresa === 'alpha') {
                const option = document.createElement('option');
                option.value = 'repasse-matriz';
                option.text = 'üì¶ Repasse Matriz';
                origemSelect.add(option);
            }

            // Adicionar op√ß√µes comuns
            opcoesComuns.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.text = opt.text;
                origemSelect.add(option);
            });

            // Restaurar valor se ainda existir nas op√ß√µes
            if (valorAtual && Array.from(origemSelect.options).some(opt => opt.value === valorAtual)) {
                origemSelect.value = valorAtual;
            } else {
                // Se valor anterior era "repasse-matriz" e mudou para Starken, selecionar "outros"
                if (valorAtual === 'repasse-matriz' && empresa === 'starken') {
                    origemSelect.value = 'outros';
                }
            }

            // Atualizar preview
            atualizarPreviewContrato();
        }

        // Fechar ao clicar fora do modal (DESATIVADO)
        /* document.addEventListener('click', function(e) {
            const modal = document.getElementById('clientModal');
            if (e.target === modal && modal.style.display === 'flex') {
                console.log('üñ±Ô∏è Clique fora do modal - fechando');
                closeClientModal();
            }
        }); */

        // Fechar com tecla ESC
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('clientModal');
            if (e.key === 'Escape' && modal.style.display === 'flex') {
                console.log('‚å®Ô∏è Tecla ESC pressionada - fechando modal');
                closeClientModal();
            }
        });

        // Salvar novo cliente
        async function saveClient(event) {
            event.preventDefault();

            const nome = document.getElementById('clientNome').value.trim();
            const empresa = document.getElementById('clientEmpresa').value;
            const categoria = document.getElementById('clientCategoria').value.trim();
            const tipoValor = document.getElementById('clientTipoValor').value;
            const origem = document.getElementById('clientOrigem')?.value || 'outros';
            const mesesTrabalho = parseInt(document.getElementById('clientMesesTrabalho')?.value) || 3;
            const isProjecao = document.getElementById('clientIsProjecao')?.checked || false;

            let valor = 0;
            let mesInicio = '';
            let tcvTotal = 0;
            let parcelas = 1;
            let valorLiquido = 0;

            if (tipoValor === 'mrr' || tipoValor === 'bonus') {
                valor = parseFloat(document.getElementById('clientValor').value) || 0;
                mesInicio = document.getElementById('clientMesInicio').value;

                if (!valor && tipoValor !== 'bonus') {
                    alert('Por favor, informe o valor mensal.');
                    return;
                }
            } else {
                tcvTotal = parseFloat(document.getElementById('clientTCVTotal').value) || 0;
                parcelas = parseInt(document.getElementById('clientTCVParcelas').value) || 1;
                mesInicio = document.getElementById('clientMesInicioTCV').value;
                valor = tcvTotal / parcelas;

                if (!tcvTotal) {
                    alert('Por favor, informe o valor total do contrato.');
                    return;
                }
            }

            if (!nome || !categoria || !mesInicio) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }

            // Taxa de juros do cart√£o (opcional)
            const taxaJuros = parseFloat(document.getElementById('clientTaxaJuros')?.value) || 0;

            // Novos campos adicionados
            const dataFechamento = document.getElementById('clientDataFechamento')?.value || null;
            const dataPagamentoTCV = document.getElementById('clientDataPagamentoTCV')?.value || null;
            const dataPagamentoMRR = document.getElementById('clientDataPagamentoMRR')?.value || null;
            const formaPagamento = document.getElementById('clientFormaPagamento')?.value || null;
            const gateway = document.getElementById('clientGateway')?.value || null;
            const parcelasCartao = document.getElementById('clientParcelasCartao')?.value || null;
            const isContratoFechado = document.getElementById('clientIsContratoFechado')?.checked || false;

            // Capturar closers selecionados
            const closers = [];
            document.querySelectorAll('.closer-checkbox:checked').forEach(cb => {
                closers.push(cb.value);
            });

            // Calcular l√≠quido (15% royalty para Alpha - taxa de juros do cart√£o/boleto)
            valorLiquido = empresa === 'alpha' ? valor * 0.85 : valor;
            if (taxaJuros > 0) {
                valorLiquido = valorLiquido * (1 - taxaJuros / 100);
            }

            // Verificar se est√° editando ou criando novo
            const editingId = document.getElementById('clientForm').getAttribute('data-editing-id');
            const isEditing = !!editingId;

            console.log('üíæ Salvando cliente...', { nome, valor, isEditing, editingId });

            // Capturar meses personalizados (se configurado)
            let mesesPersonalizados = null;
            let tcvMesesReceita = null;

            const painelMeses = document.getElementById('mesesPersonalizados');
            if (painelMeses && painelMeses.style.display !== 'none') {
                // Usu√°rio personalizou os meses
                mesesPersonalizados = [];
                document.querySelectorAll('.mes-checkbox:checked').forEach(cb => {
                    mesesPersonalizados.push(cb.getAttribute('data-mes'));
                });

                // Para TCV, capturar quais meses t√™m receita
                if (tipoValor === 'tcv') {
                    tcvMesesReceita = [];
                    document.querySelectorAll('.tcv-mes-tipo').forEach(select => {
                        if (select.value === 'receita') {
                            tcvMesesReceita.push(select.getAttribute('data-mes'));
                        }
                    });
                }
            }

            // Capturar valor l√≠quido manual (TCV apenas)
            const valorLiquidoManual = tipoValor === 'tcv' ? (parseFloat(document.getElementById('clientValorLiquidoManual')?.value) || null) : null;

            // Capturar dura√ß√£o do contrato (campo espec√≠fico para TCV)
            const duracao = tipoValor === 'tcv' ? (parseInt(document.getElementById('clientDuracao')?.value) || 3) : null;

            // Ajuste para B√¥nus: valor mensal pode ser 0
            if (tipoValor === 'bonus' && isNaN(valor)) {
                valor = 0;
                valorLiquido = 0;
            }

            let clienteData = {
                nome,
                empresa,
                valor,
                valorLiquido,
                categoria,
                mesInicio,
                tipoValor,
                tcvTotal: tipoValor === 'tcv' ? tcvTotal : null,
                parcelas: tipoValor === 'tcv' ? parcelas : null,
                taxaJuros: taxaJuros || 0,
                origem: origem,
                mesesTrabalho: tipoValor === 'tcv' ? mesesTrabalho : null,
                duracao: duracao, // Campo de dura√ß√£o para c√°lculo de comiss√£o
                isProjecao: isProjecao,
                // Novos campos
                dataFechamento: dataFechamento,
                dataPagamentoTCV: dataPagamentoTCV,
                dataPagamentoMRR: dataPagamentoMRR,
                formaPagamento: formaPagamento,
                valorLiquidoManual: valorLiquidoManual,
                gateway: gateway,
                parcelasCartao: parcelasCartao,
                isContratoFechado: isContratoFechado,
                // Closers respons√°veis
                closers: closers,
                // Meses personalizados
                mesesPersonalizados: mesesPersonalizados,
                tcvMesesReceita: tcvMesesReceita,
                // Proje√ß√£o MRR
                projetarMRR: document.getElementById('clientProjetarMRR')?.checked || false,
                projecaoValorMRR: parseFloat(document.getElementById('clientProjecaoValorMRR')?.value) || null,
                projecaoDuracao: parseInt(document.getElementById('clientProjecaoDuracao')?.value) || null,
                projecaoInicio: document.getElementById('clientProjecaoInicio')?.value || null,
                projecaoDiaVencimento: parseInt(document.getElementById('clientProjecaoDiaVencimento')?.value) || null,
                // Status de Renova√ß√£o TCV
                statusRenovacaoTCV: document.getElementById('clientStatusRenovacaoTCV')?.value || null
            };

            if (isEditing) {
                // Modo edi√ß√£o: atualizar cliente existente
                const clientes = getManualClients();
                const clienteIndex = clientes.findIndex(c => c.id == editingId);

                if (clienteIndex !== -1) {
                    // Manter ID e data de cria√ß√£o originais
                    clienteData.id = clientes[clienteIndex].id;
                    clienteData.criadoEm = clientes[clienteIndex].criadoEm;
                    clienteData.atualizadoEm = new Date().toISOString();

                    clientes[clienteIndex] = clienteData;
                    saveManualClients(clientes);

                    console.log('‚úÖ Cliente atualizado:', clienteData);
                } else {
                    alert('Erro: Cliente n√£o encontrado.');
                    return;
                }
            } else {
                // Modo cria√ß√£o: adicionar novo cliente
                clienteData.id = Date.now();
                clienteData.criadoEm = new Date().toISOString();

                const clientes = getManualClients();
                clientes.push(clienteData);
                saveManualClients(clientes);

                console.log('‚úÖ Cliente adicionado:', clienteData);
            }

            try {
                const apiBase = (window.GestaoFinanceira && GestaoFinanceira.RAILWAY_API_URL)
                    ? GestaoFinanceira.RAILWAY_API_URL
                    : 'https://starken-financeiro-production.up.railway.app';
                if (tipoValor === 'mrr' || tipoValor === 'bonus') {
                    await fetch(`${apiBase}/api/acao`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            acao: 'adicionar-receita',
                            dados: {
                                nome: nome,
                                valor: valor,
                                categoria: empresa,
                                tipo: tipoValor.toUpperCase(),
                                empresa: empresa,
                                mes: mesInicio,
                                status: 'A Receber',
                                vencimento: dataPagamentoMRR || null
                            }
                        })
                    });
                } else {
                    const mesesParcelas = gerarMesesConsecutivos(mesInicio, parcelas);
                    for (let i = 0; i < parcelas; i++) {
                        await fetch(`${apiBase}/api/acao`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                acao: 'adicionar-receita',
                                dados: {
                                    nome: `${nome} (${i + 1}/${parcelas})`,
                                    valor: valor,
                                    categoria: empresa,
                                    tipo: 'TCV',
                                    empresa: empresa,
                                    mes: mesesParcelas[i],
                                    status: 'A Receber',
                                    vencimento: dataPagamentoTCV || null
                                }
                            })
                        });
                    }
                }
                console.log('‚úÖ Cliente salvo no banco');
            } catch (error) {
                console.error('Erro ao salvar no banco:', error);
            }
            console.log('‚úÖ Cliente salvo no localStorage');

            // Fechar modal
            closeClientModal();

            // Atualizar interface SEM reload (mais r√°pido e profissional)
            console.log('üîÑ Atualizando visualiza√ß√£o...');

            // 1. Renderizar cards
            renderManualClients();

            // 2. Atualizar contadores
            updateClientCounters();

            // 3. Atualizar tabelas
            if (typeof StarkenTableManager !== 'undefined') {
                StarkenTableManager.renderTabela(DashboardState.mesAtual);
            }
            if (typeof AlphaTableManager !== 'undefined') {
                AlphaTableManager.renderTabela(DashboardState.mesAtual);
            }

            // 4. Atualizar dashboard de indicadores
            if (typeof DashboardIndicatorsManager !== 'undefined') {
                DashboardIndicatorsManager.render(DashboardState.mesAtual);
            }

            // Toast de sucesso
            const acao = isEditing ? 'atualizado' : 'adicionado';
            console.log(`‚úÖ Cliente ${acao} com sucesso:`, nome);

            // ---------------------------------------------------------
            // L√ìGICA DE PROJE√á√ÉO AUTOM√ÅTICA (Gerar Card Filho)
            // ---------------------------------------------------------
            if (clienteData.projetarMRR && clienteData.projecaoValorMRR && clienteData.projecaoInicio) {
                console.log('üîÆ Processando proje√ß√£o autom√°tica...');
                
                // Recarregar lista atualizada
                const clientesAtualizados = getManualClients();
                
                // Verificar se j√° existe proje√ß√£o vinculada a este cliente
                // Busca por parentClientId igual ao ID do cliente atual
                // E garante que a proje√ß√£o N√ÉO seja o pr√≥prio cliente sendo editado
                let projecaoIndex = clientesAtualizados.findIndex(c => c.parentClientId == clienteData.id && c.isProjecao && c.id !== clienteData.id);
                
                // Calcular data de vencimento completa (YYYY-MM-DD)
                let dataVencimentoProjecao = null;
                if (clienteData.projecaoDiaVencimento) {
                    const dia = String(clienteData.projecaoDiaVencimento).padStart(2, '0');
                    dataVencimentoProjecao = `${clienteData.projecaoInicio}-${dia}`;
                } else {
                    // Default dia 05 se n√£o informado
                    dataVencimentoProjecao = `${clienteData.projecaoInicio}-05`;
                }

                // Objeto da Proje√ß√£o
                const cardProjecao = {
                    // Se j√° existe, mant√©m o ID. Se n√£o, gera um novo (com offset para n√£o colidir)
                    id: projecaoIndex !== -1 ? clientesAtualizados[projecaoIndex].id : (Date.now() + 500),
                    criadoEm: new Date().toISOString(),
                    atualizadoEm: new Date().toISOString(),
                    
                    // Heran√ßa de dados
                    nome: clienteData.nome,
                    empresa: clienteData.empresa,
                    categoria: clienteData.categoria,
                    closers: clienteData.closers,
                    
                    // Configura√ß√£o Espec√≠fica da Proje√ß√£o
                    tipoValor: 'mrr', // Renova√ß√£o vira MRR
                    valor: clienteData.projecaoValorMRR,
                    mesInicio: clienteData.projecaoInicio, // M√™s que come√ßa a aparecer
                    dataPagamentoMRR: dataVencimentoProjecao, // Data do vencimento
                    
                    // Dados para controle de visibilidade da proje√ß√£o
                    projecaoDuracao: clienteData.projecaoDuracao, // Salvar dura√ß√£o para controle de exibi√ß√£o
                    
                    // Identificadores
                    isProjecao: true, // √â uma proje√ß√£o
                    origem: 'renovacao', // Origem for√ßada
                    parentClientId: clienteData.id, // Link com o pai
                    
                    // Limpeza de campos TCV antigos
                    tcvTotal: null,
                    parcelas: null,
                    mesesTrabalho: null,
                    isContratoFechado: false, // Proje√ß√£o ainda n√£o foi fechada
                    
                    // Manter dados de proje√ß√£o vazios no filho para evitar recurs√£o infinita
                    projetarMRR: false,
                    mesesPersonalizados: null // Garantir que n√£o herde restri√ß√µes de meses
                };

                // Garantir que a proje√ß√£o n√£o esteja na lista de exclu√≠dos (undelete)
                const deletedIds = getDeletedCards();
                let wasDeleted = false;
                
                if (projecaoIndex !== -1) {
                    const projId = clientesAtualizados[projecaoIndex].id;
                    if (deletedIds.includes(projId)) {
                        const newDeletedIds = deletedIds.filter(id => id != projId);
                        saveDeletedCards(newDeletedIds);
                        wasDeleted = true;
                        console.log('‚ôªÔ∏è Proje√ß√£o recuperada da lixeira:', projId);
                    }
                    
                    // Atualizar proje√ß√£o existente
                    clientesAtualizados[projecaoIndex] = { ...clientesAtualizados[projecaoIndex], ...cardProjecao };
                    console.log('üîÑ Card de proje√ß√£o atualizado:', cardProjecao);
                } else {
                    // Criar nova proje√ß√£o
                    clientesAtualizados.push(cardProjecao);
                    console.log('‚ú® Novo card de proje√ß√£o criado:', cardProjecao);
                }

                // Salvar novamente com a proje√ß√£o inclu√≠da
                saveManualClients(clientesAtualizados);
            }

            await syncClientsWithServer(true);

            // Sincronizar dados (se dispon√≠vel)
            if (window.stark) {
                window.stark.sincronizar(true);
            }
        }

        // Gerar array de meses consecutivos
        function gerarMesesConsecutivos(mesInicio, quantidade) {
            const meses = [];
            const [ano, mes] = mesInicio.split('-').map(Number);

            for (let i = 0; i < quantidade; i++) {
                const novoMes = mes + i;
                const novoAno = ano + Math.floor((novoMes - 1) / 12);
                const mesAjustado = ((novoMes - 1) % 12) + 1;
                meses.push(`${novoAno}-${String(mesAjustado).padStart(2, '0')}`);
            }

            return meses;
        }

        // Excluir cliente manual
        function deleteManualClient(id) {
            if (!confirm('Tem certeza que deseja excluir este cliente?')) return;

            // Marcar como deletado (persiste ap√≥s refresh)
            markCardAsDeleted(id);

            // Remover do localStorage tamb√©m
            const clientes = getManualClients().filter(c => c.id != id);
            saveManualClients(clientes);

            renderManualClients();

            // Atualizar contadores
            updateClientCounters();

            // Atualizar tabelas
            if (typeof StarkenTableManager !== 'undefined') {
                StarkenTableManager.renderTabela(DashboardState.mesAtual);
            }
            if (typeof AlphaTableManager !== 'undefined') {
                AlphaTableManager.renderTabela(DashboardState.mesAtual);
            }

            // Atualizar dashboard de indicadores
            if (typeof DashboardIndicatorsManager !== 'undefined') {
                DashboardIndicatorsManager.render(DashboardState.mesAtual);
            }

            syncClientsWithServer(true);

            console.log('üóëÔ∏è Cliente exclu√≠do - cards e tabelas atualizados:', id);
        }

        // Ajustar valor mensal de um cliente MRR
        function ajustarValorMensal(clienteId, mes) {
            const clientes = getManualClients();
            const cliente = clientes.find(c => c.id === clienteId);

            if (!cliente || cliente.tipoValor !== 'mrr') {
                alert('Apenas clientes MRR podem ter valores ajustados mensalmente.');
                return;
            }

            const valorAtual = cliente.valor || 0;
            const ajusteExistente = cliente.ajustesMensais && cliente.ajustesMensais[mes];

            // Formatar m√™s para exibi√ß√£o
            const [ano, mesNum] = mes.split('-');
            const meses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const mesFormatado = `${meses[parseInt(mesNum)-1]}/${ano}`;

            let mensagem = `üìä Ajustar valor de ${cliente.nome} em ${mesFormatado}\n\n`;
            mensagem += `Valor padr√£o: R$ ${valorAtual.toFixed(2)}\n`;

            if (ajusteExistente) {
                mensagem += `Valor atual ajustado: R$ ${ajusteExistente.valor.toFixed(2)}\n`;
                mensagem += `Motivo: ${ajusteExistente.motivo}\n\n`;
                mensagem += `Digite o novo valor (ou deixe vazio para remover o ajuste):`;
            } else {
                mensagem += `\nDigite o novo valor para este m√™s:`;
            }

            const novoValorStr = prompt(mensagem, ajusteExistente ? ajusteExistente.valor : valorAtual);

            // Cancelou ou deixou vazio para remover ajuste
            if (novoValorStr === null) return;

            // Remover ajuste se deixou vazio
            if (novoValorStr.trim() === '') {
                if (confirm('Deseja remover o ajuste e voltar ao valor padr√£o?')) {
                    if (!cliente.ajustesMensais) cliente.ajustesMensais = {};
                    delete cliente.ajustesMensais[mes];

                    // Salvar
                    const index = clientes.findIndex(c => c.id === clienteId);
                    clientes[index] = cliente;
                    saveManualClients(clientes);

                    renderManualClients();
                    alert(`‚úÖ Ajuste removido! Voltou ao valor padr√£o: R$ ${valorAtual.toFixed(2)}`);
                }
                return;
            }

            const novoValor = parseFloat(novoValorStr.replace(',', '.'));

            if (isNaN(novoValor) || novoValor < 0) {
                alert('‚ùå Valor inv√°lido! Digite um n√∫mero v√°lido.');
                return;
            }

            // Pedir motivo
            const motivo = prompt('üìù Motivo do ajuste:\n\n(Ex: Desconto 50% - fim de ano sem tr√°fego pago)', ajusteExistente ? ajusteExistente.motivo : '');

            if (!motivo || motivo.trim() === '') {
                alert('‚ùå Voc√™ precisa informar o motivo do ajuste.');
                return;
            }

            // Salvar ajuste
            if (!cliente.ajustesMensais) {
                cliente.ajustesMensais = {};
            }

            cliente.ajustesMensais[mes] = {
                valor: novoValor,
                motivo: motivo.trim(),
                dataAjuste: new Date().toISOString()
            };

            // Atualizar cliente no array
            const index = clientes.findIndex(c => c.id === clienteId);
            clientes[index] = cliente;
            saveManualClients(clientes);

            renderManualClients();

            const diferenca = novoValor - valorAtual;
            const diferencaTexto = diferenca >= 0 ? `+R$ ${diferenca.toFixed(2)}` : `-R$ ${Math.abs(diferenca).toFixed(2)}`;

            alert(`‚úÖ Valor ajustado com sucesso!\n\nValor padr√£o: R$ ${valorAtual.toFixed(2)}\nNovo valor (${mesFormatado}): R$ ${novoValor.toFixed(2)}\nDiferen√ßa: ${diferencaTexto}\n\nMotivo: ${motivo}`);
        }

        // Fun√ß√£o gen√©rica para excluir qualquer card de cliente
        function deleteClientCard(cardElement) {
            if (!confirm('Tem certeza que deseja excluir este cliente?')) return;

            // Adiciona classe de anima√ß√£o
            cardElement.classList.add('deleting');

            // Remove o card ap√≥s a anima√ß√£o
            setTimeout(() => {
                cardElement.remove();
                // Atualiza os contadores em tempo real
                updateClientCounters();
                console.log('üóëÔ∏è Card de cliente exclu√≠do');
            }, 300); // Tempo da anima√ß√£o
        }

        // Atualizar contadores de clientes em tempo real
        function updateClientCounters() {
            const starkenGrid = document.getElementById('starken-clients');
            const alphaGrid = document.getElementById('alpha-clients');

            if (!starkenGrid || !alphaGrid) return;

            const mesChave = (DashboardState && DashboardState.mesAtual) ? DashboardState.mesAtual : new Date().toISOString().substring(0, 7);
            const { totalStarkenAtivos, totalAlphaAtivos, totalClientes } = getActiveClientCountsForMonth(mesChave);

            // Atualizar tabs
            const starkenTab = document.getElementById('starken-tab-label');
            const alphaTab = document.getElementById('alpha-tab-label');
            if (starkenTab) starkenTab.textContent = `Starken (${totalStarkenAtivos})`;
            if (alphaTab) alphaTab.textContent = `Alpha (${totalAlphaAtivos})`;

            // Atualizar t√≠tulo da carteira
            const tituloCarteira = document.getElementById('carteira-clientes-titulo');
            if (tituloCarteira) {
                tituloCarteira.textContent = `Carteira de Clientes (${totalClientes} Ativos)`;
            }

            // Atualizar subt√≠tulo
            const subtitulo = document.querySelector('.section-subtitle-clients');
            if (subtitulo) {
                subtitulo.textContent = `Portf√≥lio atual de ${totalClientes} clientes da Starken e Alpha`;
            }

            // Atualizar KPI de clientes ativos
            const kpiClientesAtivos = document.querySelector('.kpi-card:nth-child(2) .kpi-value');
            if (kpiClientesAtivos) {
                kpiClientesAtivos.textContent = totalClientes;
            }

            const kpiTotalBreakdown = document.getElementById('kpi-total-clientes-breakdown');
            if (kpiTotalBreakdown) {
                kpiTotalBreakdown.textContent = `${totalStarkenAtivos} Starken + ${totalAlphaAtivos} Alpha`;
            }

            const starkenLabel = document.getElementById('starken-clientes-label');
            if (starkenLabel) {
                starkenLabel.textContent = `Empresa Matriz ¬∑ ${totalStarkenAtivos} Clientes`;
            }

            const alphaLabel = document.getElementById('alpha-clientes-label');
            if (alphaLabel) {
                alphaLabel.textContent = `Projeto Nichado ¬∑ ${totalAlphaAtivos} Clientes`;
            }

            const kpiStarkenClientes = document.getElementById('kpi-starken-clientes');
            if (kpiStarkenClientes) {
                kpiStarkenClientes.textContent = totalStarkenAtivos;
            }

            const kpiAlphaClientes = document.getElementById('kpi-alpha-clientes');
            if (kpiAlphaClientes) {
                kpiAlphaClientes.textContent = totalAlphaAtivos;
            }

            console.log('‚úÖ Contadores atualizados: Starken:', totalStarkenAtivos, '| Alpha:', totalAlphaAtivos, '| Total:', totalClientes);
        }

        // Adicionar bot√µes de delete em todos os cards existentes
        function addDeleteButtonsToAllCards() {
            // Agora TODOS os cards s√£o manuais e edit√°veis
            document.querySelectorAll('.client-card').forEach(card => {
                // Verifica se j√° tem bot√£o de delete
                if (card.querySelector('.btn-delete-client')) return;

                const clientId = card.getAttribute('data-client-id');
                if (!clientId) return; // Seguran√ßa

                // Cria o bot√£o de delete
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-delete-client';
                deleteBtn.innerHTML = '‚úï';
                deleteBtn.title = 'Excluir cliente';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteManualClient(clientId);
                };

                // Adiciona o bot√£o no in√≠cio do card
                card.style.position = 'relative';
                card.insertBefore(deleteBtn, card.firstChild);
            });

            console.log('‚úÖ Bot√µes de delete adicionados a todos os cards');
        }

        // Adicionar evento de clique para editar cards
        function addEditClickToCards() {
            document.querySelectorAll('.client-card').forEach(card => {
                // Remove listener anterior se existir
                card.style.cursor = 'pointer';

                card.onclick = (e) => {
                    // N√£o abrir modal se clicou no bot√£o de delete
                    if (e.target.classList.contains('btn-delete-client')) return;

                    openEditClientModal(card);
                };
            });
        }

        // Abrir modal de edi√ß√£o com dados do cliente
        function openEditClientModal(cardElement) {
            const clientId = cardElement.getAttribute('data-client-id');

            // Agora TODOS os cards t√™m ID (foram migrados)
            if (!clientId) {
                console.error('‚ö†Ô∏è Card sem ID encontrado - isso n√£o deveria acontecer ap√≥s migra√ß√£o');
                return;
            }

            // Buscar dados completos do cliente no localStorage
            const clientes = getManualClients();
            const cliente = clientes.find(c => c.id == clientId);

            if (!cliente) {
                console.error('‚ö†Ô∏è Cliente n√£o encontrado no localStorage:', clientId);
                return;
            }

            console.log('‚úèÔ∏è Abrindo edi√ß√£o do cliente:', cliente);

            // Preencher o modal com dados completos
            document.getElementById('clientNome').value = cliente.nome;
            document.getElementById('clientCategoria').value = cliente.categoria;
            document.getElementById('clientEmpresa').value = cliente.empresa;
            document.getElementById('clientTipoValor').value = cliente.tipoValor;

            // Origem e meses de trabalho
            if (cliente.origem) {
                document.getElementById('clientOrigem').value = cliente.origem;
            }
            if (cliente.mesesTrabalho) {
                document.getElementById('clientMesesTrabalho').value = cliente.mesesTrabalho;
            }

            if (cliente.tipoValor === 'mrr') {
                document.getElementById('clientValor').value = cliente.valor;
            } else {
                document.getElementById('clientTCVTotal').value = cliente.tcvTotal || cliente.valor;
                document.getElementById('clientTCVParcelas').value = cliente.parcelas || 1;
            }

            // Preencher taxa de juros se existir
            if (cliente.taxaJuros) {
                document.getElementById('clientTaxaJuros').value = cliente.taxaJuros;
            }

            // Preencher valor l√≠quido manual se existir (TCV)
            if (cliente.tipoValor === 'tcv' && cliente.valorLiquidoManual) {
                document.getElementById('clientValorLiquidoManual').value = cliente.valorLiquidoManual;
            }

            // Preencher checkbox de proje√ß√£o se existir
            const checkboxProjecao = document.getElementById('clientIsProjecao');
            if (checkboxProjecao) {
                checkboxProjecao.checked = cliente.isProjecao || false;
            }

            // Preencher novos campos adicionados (Datas com Flatpickr)
            const setFlatpickrDate = (id, dateValue) => {
                const input = document.getElementById(id);
                if (input && input._flatpickr) {
                    input._flatpickr.setDate(dateValue || '', true); // true = trigger change events
                } else if (input) {
                    input.value = dateValue || '';
                }
            };

            if (cliente.dataFechamento) {
                setFlatpickrDate('clientDataFechamento', cliente.dataFechamento);
            }
            if (cliente.dataPagamentoTCV) {
                setFlatpickrDate('clientDataPagamentoTCV', cliente.dataPagamentoTCV);
            }
            if (cliente.dataPagamentoMRR) {
                setFlatpickrDate('clientDataPagamentoMRR', cliente.dataPagamentoMRR);
            }

            if (cliente.formaPagamento) {
                document.getElementById('clientFormaPagamento').value = cliente.formaPagamento;
                // Chamar toggle para mostrar/esconder campos de cart√£o
                toggleCamposPagamento();
            }
            if (cliente.gateway) {
                document.getElementById('clientGateway').value = cliente.gateway;
            }
            if (cliente.parcelasCartao) {
                document.getElementById('clientParcelasCartao').value = cliente.parcelasCartao;
            }
            const checkboxContratoFechado = document.getElementById('clientIsContratoFechado');
            if (checkboxContratoFechado) {
                checkboxContratoFechado.checked = cliente.isContratoFechado || false;
            }

            // Carregar closers
            document.querySelectorAll('.closer-checkbox').forEach(cb => cb.checked = false); // Desmarcar todos
            if (cliente.closers && cliente.closers.length > 0) {
                cliente.closers.forEach(closer => {
                    const checkbox = document.querySelector(`.closer-checkbox[value="${closer}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });
            }

            // Carregar meses personalizados se existirem
            if (cliente.mesesPersonalizados && cliente.mesesPersonalizados.length > 0) {
                // Primeiro, mostra o painel de personaliza√ß√£o
                const painelMeses = document.getElementById('mesesPersonalizados');
                const btnToggle = document.getElementById('btnToggleMeses');
                if (painelMeses && btnToggle) {
                    painelMeses.style.display = 'block';
                    btnToggle.textContent = 'Usar Autom√°tico';
                    btnToggle.style.background = '#dc2626';
                }

                // Marca os checkboxes dos meses selecionados
                cliente.mesesPersonalizados.forEach(mes => {
                    const checkbox = document.querySelector(`.mes-checkbox[data-mes="${mes}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });

                // Se for TCV e tiver meses de receita, configurar os dropdowns
                if (cliente.tipoValor === 'tcv' && cliente.tcvMesesReceita) {
                    // Atualizar a config TCV
                    atualizarTCVMesesConfig();

                    // Aguardar DOM atualizar e ent√£o setar os valores
                    setTimeout(() => {
                        cliente.tcvMesesReceita.forEach(mes => {
                            const select = document.querySelector(`.tcv-mes-tipo[data-mes="${mes}"]`);
                            if (select) {
                                select.value = 'receita';
                            }
                        });
                    }, 100);
                }
            }

            // Carregar proje√ß√£o MRR se existir
            if (cliente.projetarMRR) {
                const checkboxProjetar = document.getElementById('clientProjetarMRR');
                if (checkboxProjetar) {
                    checkboxProjetar.checked = true;
                    toggleProjecaoMRR(); // Mostrar campos
                }

                if (cliente.projecaoValorMRR) {
                    document.getElementById('clientProjecaoValorMRR').value = cliente.projecaoValorMRR;
                }
                if (cliente.projecaoDuracao) {
                    document.getElementById('clientProjecaoDuracao').value = cliente.projecaoDuracao;
                }
                if (cliente.projecaoInicio) {
                    document.getElementById('clientProjecaoInicio').value = cliente.projecaoInicio;
                    calcularTerminoProjecao(); // Calcular t√©rmino
                }
                if (cliente.projecaoDiaVencimento) {
                    document.getElementById('clientProjecaoDiaVencimento').value = cliente.projecaoDiaVencimento;
                }
                if (cliente.projecaoDiaVencimento) {
                    document.getElementById('clientProjecaoDiaVencimento').value = cliente.projecaoDiaVencimento;
                }
            }

            // Armazena ID do cliente para edi√ß√£o
            document.getElementById('clientForm').setAttribute('data-editing-id', clientId);

            // Atualiza t√≠tulo do modal
            document.querySelector('#clientModal .modal-header h3').textContent = '‚úèÔ∏è Editar Cliente';

            // Mostra campos corretos
            toggleTCVFields();
            updateOrigemOptions();
            atualizarPreviewContrato();

            // Abre o modal
            document.getElementById('clientModal').style.display = 'flex';
        }

        // Duplicar cliente
        function duplicateClient(clientId) {
            // Buscar dados completos do cliente no localStorage
            const clientes = getManualClients();
            const cliente = clientes.find(c => c.id == clientId);

            if (!cliente) {
                console.error('‚ö†Ô∏è Cliente n√£o encontrado no localStorage:', clientId);
                return;
            }

            console.log('üìã Duplicando cliente:', cliente);

            // Limpar o modal primeiro
            document.getElementById('clientForm').reset();
            document.getElementById('clientForm').removeAttribute('data-editing-id');

            // Preencher o modal com dados completos do cliente original
            document.getElementById('clientNome').value = cliente.nome + ' (C√≥pia)';
            document.getElementById('clientCategoria').value = cliente.categoria;
            document.getElementById('clientEmpresa').value = cliente.empresa;
            document.getElementById('clientTipoValor').value = cliente.tipoValor;

            // Origem e meses de trabalho
            if (cliente.origem) {
                document.getElementById('clientOrigem').value = cliente.origem;
            }
            if (cliente.mesesTrabalho) {
                document.getElementById('clientMesesTrabalho').value = cliente.mesesTrabalho;
            }

            if (cliente.tipoValor === 'mrr') {
                document.getElementById('clientValor').value = cliente.valor;
            } else {
                document.getElementById('clientTCVTotal').value = cliente.tcvTotal || cliente.valor;
                document.getElementById('clientTCVParcelas').value = cliente.parcelas || 1;
            }

            // Preencher taxa de juros se existir
            if (cliente.taxaJuros) {
                document.getElementById('clientTaxaJuros').value = cliente.taxaJuros;
            }

            // Preencher valor l√≠quido manual se existir (TCV)
            if (cliente.tipoValor === 'tcv' && cliente.valorLiquidoManual) {
                document.getElementById('clientValorLiquidoManual').value = cliente.valorLiquidoManual;
            }

            // Preencher checkbox de proje√ß√£o se existir
            const checkboxProjecao = document.getElementById('clientIsProjecao');
            if (checkboxProjecao) {
                checkboxProjecao.checked = cliente.isProjecao || false;
            }

            // Preencher campos de data (DEIXAR VAZIOS - usu√°rio vai definir novas datas)
            // N√£o copiar: dataFechamento, dataPagamentoTCV, dataPagamentoMRR

            // Copiar forma de pagamento
            if (cliente.formaPagamento) {
                document.getElementById('clientFormaPagamento').value = cliente.formaPagamento;
                toggleCamposPagamento();
            }
            if (cliente.gateway) {
                document.getElementById('clientGateway').value = cliente.gateway;
            }
            if (cliente.parcelasCartao) {
                document.getElementById('clientParcelasCartao').value = cliente.parcelasCartao;
            }
            const checkboxContratoFechado = document.getElementById('clientIsContratoFechado');
            if (checkboxContratoFechado) {
                checkboxContratoFechado.checked = false; // Resetar para n√£o fechado
            }

            // Carregar meses personalizados se existirem
            if (cliente.mesesPersonalizados && cliente.mesesPersonalizados.length > 0) {
                // Primeiro, mostra o painel de personaliza√ß√£o
                const painelMeses = document.getElementById('mesesPersonalizados');
                const btnToggle = document.getElementById('btnToggleMeses');
                if (painelMeses && btnToggle) {
                    painelMeses.style.display = 'block';
                    btnToggle.textContent = 'Usar Autom√°tico';
                    btnToggle.style.background = '#dc2626';
                }

                // Marca os checkboxes dos meses selecionados
                cliente.mesesPersonalizados.forEach(mes => {
                    const checkbox = document.querySelector(`.mes-checkbox[data-mes="${mes}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                    }
                });

                // Se for TCV e tiver meses de receita, configurar os dropdowns
                if (cliente.tipoValor === 'tcv' && cliente.tcvMesesReceita) {
                    // Atualizar a config TCV
                    atualizarTCVMesesConfig();

                    // Aguardar DOM atualizar e ent√£o setar os valores
                    setTimeout(() => {
                        cliente.tcvMesesReceita.forEach(mes => {
                            const select = document.querySelector(`.tcv-mes-tipo[data-mes="${mes}"]`);
                            if (select) {
                                select.value = 'receita';
                            }
                        });
                    }, 100);
                }
            }

            // Carregar proje√ß√£o MRR se existir
            if (cliente.projetarMRR) {
                const checkboxProjetar = document.getElementById('clientProjetarMRR');
                if (checkboxProjetar) {
                    checkboxProjetar.checked = true;
                    toggleProjecaoMRR(); // Mostrar campos
                }

                if (cliente.projecaoValorMRR) {
                    document.getElementById('clientProjecaoValorMRR').value = cliente.projecaoValorMRR;
                }
                if (cliente.projecaoDuracao) {
                    document.getElementById('clientProjecaoDuracao').value = cliente.projecaoDuracao;
                }
                if (cliente.projecaoInicio) {
                    document.getElementById('clientProjecaoInicio').value = cliente.projecaoInicio;
                    calcularTerminoProjecao(); // Calcular t√©rmino
                }
                if (cliente.projecaoDiaVencimento) {
                    document.getElementById('clientProjecaoDiaVencimento').value = cliente.projecaoDiaVencimento;
                }
            }

            // N√ÉO armazena ID - vai criar um novo cliente
            // Atualiza t√≠tulo do modal
            document.querySelector('#clientModal .modal-header h3').textContent = 'üìã Duplicar Cliente';

            // Mostra campos corretos
            toggleTCVFields();
            updateOrigemOptions();
            atualizarPreviewContrato();

            // Abre o modal
            document.getElementById('clientModal').style.display = 'flex';
        }

        // Marcar clientes espec√≠ficos como renova√ß√£o em Janeiro
        function marcarRenovacoesJaneiro() {
            const clientes = getManualClients();
            const clientesParaRenovar = ['Oficina da Massa', 'Bigu\'s Burger', 'Pizzaria Madrid'];

            let alterado = false;

            clientes.forEach(cliente => {
                if (clientesParaRenovar.includes(cliente.nome) && !cliente.statusRenovacao) {
                    cliente.statusRenovacao = true;
                    cliente.mesRenovacao = '2026-01'; // Janeiro 2026
                    cliente.valorRenovacao = '2.000'; // R$ 2k/m√™s
                    alterado = true;
                    console.log(`üîÑ Marcado para renova√ß√£o: ${cliente.nome}`);
                }
            });

            if (alterado) {
                saveManualClients(clientes);
                console.log('‚úÖ Renova√ß√µes de Janeiro configuradas');
            }
        }

        // Fun√ß√£o para limpar clientes de proje√ß√£o (executar uma vez)
        function limparClientesProjecao() {
            const clientes = getManualClients();
            const clientesSemProjecao = clientes.filter(c => !c.isProjecao);

            if (clientesSemProjecao.length < clientes.length) {
                saveManualClients(clientesSemProjecao);
                console.log(`‚úÖ Removidos ${clientes.length - clientesSemProjecao.length} clientes de proje√ß√£o`);
            }
        }

        // Executar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            (async () => {
                const params = new URLSearchParams(window.location.search);
                const forcePushParam = params.get('syncClients') === 'push';
                const forcePushFlag = localStorage.getItem('starken_force_clients_push') === 'true';

                await syncClientsWithServer(forcePushParam || forcePushFlag);

                if (getManualClients().length === 0) {
                    migrateStaticCardsToLocalStorage();
                }

                marcarRenovacoesJaneiro();
                limparClientesProjecao();

                renderManualClients();
                updateClientCounters();

                const abaGuardada = localStorage.getItem('starken_aba_ativa');
                if (abaGuardada && abaGuardada !== 'starken') {
                    showClientTab(abaGuardada);
                    localStorage.removeItem('starken_aba_ativa');
                    console.log('‚úÖ Aba restaurada:', abaGuardada);
                }

                syncClientsWithServer();

                if (forcePushParam) {
                    localStorage.setItem('starken_force_clients_push', 'true');
                }

                setInterval(() => {
                    syncClientsWithServer();
                }, 10000);

                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden) {
                        syncClientsWithServer();
                    }
                });
            })();
        });

        // Re-adicionar bot√µes quando mudar de aba
        const originalShowClientTab = window.showClientTab;
        window.showClientTab = function(tabName) {
            if (typeof originalShowClientTab === 'function') {
                originalShowClientTab(tabName);
            }
            setTimeout(() => {
                addDeleteButtonsToAllCards();
                addEditClickToCards();
            }, 100);
        };

        // Renderizar clientes manuais nos cards
        function renderManualClients() {
            const clientes = getManualClients();
            const deletedIds = getDeletedCards();
            const mesAtual = DashboardState.mesAtual;

            // Filtrar clientes que j√° come√ßaram no m√™s atual E que n√£o foram deletados
            const clientesAtivos = clientes.filter(c => {
                const isDeleted = deletedIds.includes(c.id);

                // N√ÉO mostrar cards de proje√ß√£o SE n√£o tiver data de in√≠cio definida (antigos)
                // Se tiver data de in√≠cio (novo modelo), deve passar pela l√≥gica de MRR
                if (c.isProjecao && !c.mesInicio) {
                    return false;
                }

                // üéØ PRIORIDADE: Se tem MESES PERSONALIZADOS configurados, usar eles!
                if (c.mesesPersonalizados && c.mesesPersonalizados.length > 0) {
                    return c.mesesPersonalizados.includes(mesAtual) && !isDeleted;
                }

                // Cards de renova√ß√£o: aparecer apenas no m√™s de renova√ß√£o
                if (c.statusRenovacao && c.mesRenovacao === mesAtual) {
                    return !isDeleted;
                }

                // Para TCV: aparecer APENAS no m√™s de pagamento
                if (c.tipoValor === 'tcv') {
                    const mesPagamento = (c.dataPagamentoTCV || c.mesInicio || '').substring(0, 7);
                    return mesPagamento === mesAtual && !isDeleted;
                }

                // Para MRR: aparecer de mesInicio at√© fim
                if (c.tipoValor === 'mrr') {
                    if (!c.mesInicio) return false;

                    const [anoInicio, mesInicio] = c.mesInicio.split('-').map(Number);
                    const dataInicio = new Date(anoInicio, mesInicio - 1, 1);
                    
                    const [anoAtual, mesAtualNum] = mesAtual.split('-').map(Number);
                    const dataAtual = new Date(anoAtual, mesAtualNum - 1, 1);

                    // Se for proje√ß√£o, verificar se tem dura√ß√£o definida
                    if (c.isProjecao) {
                         const duracao = c.projecaoDuracao ? (parseInt(c.projecaoDuracao) || 12) : 12;
                         const dataFim = new Date(dataInicio);
                         dataFim.setMonth(dataFim.getMonth() + duracao);
                         
                         const isActive = dataAtual >= dataInicio && dataAtual < dataFim;
                         return isActive && !isDeleted;
                    }

                    // MRR padr√£o (sem fim definido ou 12 meses default)
                    const dataFim = new Date(dataInicio);
                    // MRR padr√£o: 5 anos de visibilidade (60 meses)
                    dataFim.setMonth(dataFim.getMonth() + 60);

                    const isActive = dataAtual >= dataInicio && dataAtual < dataFim;
                    return isActive && !isDeleted;
                }

                return !isDeleted;
            });

            // Separar por empresa
            let clientesStarken = clientesAtivos.filter(c => c.empresa === 'starken');
            let clientesAlpha = clientesAtivos.filter(c => c.empresa === 'alpha');

            // üéØ APLICAR ORDEM SALVA
            const starkenOrder = JSON.parse(localStorage.getItem('starken_cards_order') || '[]');
            const alphaOrder = JSON.parse(localStorage.getItem('alpha_cards_order') || '[]');

            if (starkenOrder.length > 0) {
                clientesStarken.sort((a, b) => {
                    const indexA = starkenOrder.indexOf(a.id.toString());
                    const indexB = starkenOrder.indexOf(b.id.toString());
                    // Se n√£o estiver na lista salva, joga pro final
                    const valA = indexA === -1 ? 9999 : indexA;
                    const valB = indexB === -1 ? 9999 : indexB;
                    return valA - valB;
                });
            }

            if (alphaOrder.length > 0) {
                clientesAlpha.sort((a, b) => {
                    const indexA = alphaOrder.indexOf(a.id.toString());
                    const indexB = alphaOrder.indexOf(b.id.toString());
                    const valA = indexA === -1 ? 9999 : indexA;
                    const valB = indexB === -1 ? 9999 : indexB;
                    return valA - valB;
                });
            }

            // Limpar grids completamente
            const starkenGrid = document.getElementById('starken-clients');
            const alphaGrid = document.getElementById('alpha-clients');

            if (starkenGrid) starkenGrid.innerHTML = '';
            if (alphaGrid) alphaGrid.innerHTML = '';

            // Adicionar cards Starken
            if (starkenGrid) {
                clientesStarken.forEach(cliente => {
                    const card = createManualClientCard(cliente);
                    starkenGrid.insertAdjacentHTML('beforeend', card);
                });
            }

            // Adicionar cards Alpha
            if (alphaGrid) {
                clientesAlpha.forEach(cliente => {
                    const card = createManualClientCard(cliente);
                    alphaGrid.insertAdjacentHTML('beforeend', card);
                });
            }

            console.log('üîÑ Clientes renderizados:', clientesStarken.length, 'Starken,', clientesAlpha.length, 'Alpha');
            console.log(`   (${deletedIds.length} cards exclu√≠dos permanentemente)`);

            // Atualizar contadores ap√≥s renderizar
            updateClientCounters();

            // Adicionar eventos de clique e bot√µes de delete
            addEditClickToCards();
            addDeleteButtonsToAllCards();

            // Adicionar drag and drop
            addDragAndDropToCards();

            // Atualizar tabelas em tempo real
            if (typeof StarkenTableManager !== 'undefined') {
                StarkenTableManager.renderTabela(DashboardState.mesAtual);
            }
            if (typeof AlphaTableManager !== 'undefined') {
                AlphaTableManager.renderTabela(DashboardState.mesAtual);
            }

            // Atualizar dashboard de indicadores
            if (typeof DashboardIndicatorsManager !== 'undefined') {
                DashboardIndicatorsManager.render(DashboardState.mesAtual);
            }
        }

        // Implementar Drag and Drop para reorganizar cards
        let draggedCard = null;

        function addDragAndDropToCards() {
            const cards = document.querySelectorAll('.client-card[draggable="true"]');
            const grids = document.querySelectorAll('.clients-grid');

            cards.forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    draggedCard = card;
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    // Seta imagem fantasma transparente
                    e.dataTransfer.setDragImage(new Image(), 0, 0); 
                });

                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                    draggedCard = null;
                    saveCardsOrder(); // Salvar ordem ao soltar
                });
            });

            grids.forEach(grid => {
                grid.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    const afterElement = getDragAfterElement(grid, e.clientY);
                    const draggable = document.querySelector('.dragging');
                    if (afterElement == null) {
                        grid.appendChild(draggable);
                    } else {
                        grid.insertBefore(draggable, afterElement);
                    }
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.client-card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function saveCardsOrder() {
            const starkenGrid = document.getElementById('starken-clients');
            const alphaGrid = document.getElementById('alpha-clients');
            
            if (starkenGrid) {
                const starkenOrder = [...starkenGrid.querySelectorAll('.client-card')].map(card => card.getAttribute('data-client-id'));
                localStorage.setItem('starken_cards_order', JSON.stringify(starkenOrder));
            }
            
            if (alphaGrid) {
                const alphaOrder = [...alphaGrid.querySelectorAll('.client-card')].map(card => card.getAttribute('data-client-id'));
                localStorage.setItem('alpha_cards_order', JSON.stringify(alphaOrder));
            }

            console.log('‚úÖ Ordem dos cards salva');
        }

        // Criar HTML do card manual
        function createManualClientCard(cliente) {
            const emoji = getEmojiForCategory(cliente.categoria);

            // Verificar se √© card de renova√ß√£o (n√£o conta na receita)
            const isRenovacao = cliente.statusRenovacao && cliente.mesRenovacao === DashboardState.mesAtual;

            // üéØ Verificar se h√° ajuste mensal para este m√™s (APENAS MRR)
            const mesAtual = DashboardState.mesAtual;
            const ajusteMensal = cliente.tipoValor === 'mrr' && cliente.ajustesMensais && cliente.ajustesMensais[mesAtual];

            // üéØ Verificar se MRR j√° chegou no m√™s do primeiro vencimento/pagamento
            let mrrTemReceitaNestesMes = true;
            if (cliente.tipoValor === 'mrr' && cliente.dataPagamentoMRR) {
                const mesPrimeiroVencimento = cliente.dataPagamentoMRR.substring(0, 7); // YYYY-MM
                // Se o m√™s atual for ANTES do m√™s do primeiro vencimento, n√£o tem receita ainda
                mrrTemReceitaNestesMes = mesAtual >= mesPrimeiroVencimento;
            }

            // üéØ L√ìGICA DE ALERTA DE RENOVA√á√ÉO TCV
            let isUltimoMesTCV = false;
            let diasParaVencer = 0;

            if (cliente.tipoValor === 'tcv') {
                // Calcular data final com base na dura√ß√£o
                let dataInicio = null;
                let duracaoMeses = 0;

                if (cliente.isProjecao) {
                    if (cliente.projecaoInicio) {
                        const [ano, mes] = cliente.projecaoInicio.split('-').map(Number);
                        dataInicio = new Date(ano, mes - 1, 1);
                        duracaoMeses = parseInt(cliente.projecaoDuracao, 10) || 12;
                    }
                } else {
                    // MUDAN√áA: Tentar usar dataFechamento PRIMEIRO para maior precis√£o (dia exato)
                    // Isso resolve o caso de contratos que fecham dia 27 e vencem dia 27
                if (cliente.dataFechamento) {
                    if (cliente.dataFechamento.includes('/')) {
                        const [dia, mes, ano] = cliente.dataFechamento.split('/').map(Number);
                        dataInicio = new Date(ano, mes - 1, dia);
                    } else if (cliente.dataFechamento.includes('-') && cliente.dataFechamento.split('-').length === 3) {
                        const [ano, mes, dia] = cliente.dataFechamento.split('-').map(Number);
                        dataInicio = new Date(ano, mes - 1, dia);
                    }
                }
                if (!dataInicio && cliente.mesInicio && cliente.mesInicio.includes('-')) {
                    const [ano, mes] = cliente.mesInicio.split('-').map(Number);
                    dataInicio = new Date(ano, mes - 1, 1);
                }
                    
                    // Prioriza 'duracao' (contrato), fallback para 'mesesTrabalho' (projeto)
                duracaoMeses = parseInt(cliente.duracao, 10) || parseInt(cliente.mesesTrabalho, 10) || 3;
            }

            // CORRE√á√ÉO CR√çTICA PARA PAIAGUAS:
            // O Paiaguas est√° aparecendo como "Contrato Vencido" em Fevereiro, mas vence em 01/03.
            // Isso acontece porque o c√°lculo de dura√ß√£o est√° errado.
            // Se in√≠cio = 01/12/2025 e Dura√ß√£o = 3 meses.
            // Vencimento = 01/03/2026.
            // Fevereiro √© o m√™s ANTERIOR ao vencimento.
            
            // Vamos depurar especificamente o Paiaguas.
            if (cliente.nome.includes('Paiaguas')) {
                 console.log('üçñ DEBUG PAIAGUAS:', {
                     inicio: dataInicio ? dataInicio.toISOString() : 'null',
                     duracao: duracaoMeses,
                     mesAtual: mesAtual
                 });
            }

            if (dataInicio) {
                    // Calcular data do √∫ltimo m√™s (Data Exata do Vencimento)
                    const dataTerminoContrato = new Date(dataInicio);
                    // Adiciona a dura√ß√£o em meses
                    dataTerminoContrato.setMonth(dataTerminoContrato.getMonth() + duracaoMeses);
                    
                    const anoUltimo = dataTerminoContrato.getFullYear();
                    const mesUltimo = String(dataTerminoContrato.getMonth() + 1).padStart(2, '0');
                    const stringUltimoMes = `${anoUltimo}-${mesUltimo}`; // Ex: 2026-02

                    // 1. M√™s do Vencimento (√öltimo M√™s)
                    if (mesAtual === stringUltimoMes) {
                        isUltimoMesTCV = true;
                        
                        // L√≥gica de Vencimento baseada no Dashboard MENSAL
                        // Se estamos vendo o dashboard de JANEIRO, e o contrato vence em FEVEREIRO.
                        // Janeiro < Fevereiro -> OK, est√° vigente.
                        
                        // Se estamos vendo o dashboard de FEVEREIRO, e o contrato vence 04/02.
                        // Fevereiro = Fevereiro -> √â o m√™s de renova√ß√£o.
                        // MAS, se hoje (data real) for 15/02, ent√£o J√Å VENCEU.
                        
                        // PROBLEMA RELATADO:
                        // O usu√°rio est√° vendo JANEIRO.
                        // Don Chevico vence 04/02 (Fevereiro).
                        // Maki Toro vence 27/02 (Fevereiro).
                        // Ambos aparecem com alerta "CONTRATO VENCIDO" em JANEIRO?
                        // Isso est√° errado. Em Janeiro eles deveriam estar normais ou com aviso de "Pr√≥ximo m√™s".
                        
                        // An√°lise do erro:
                        // A vari√°vel `mesAtual` vem do `DashboardState.mesAtual` (ex: '2026-01').
                        // `stringUltimoMes` √© o vencimento calculado (ex: '2026-02').
                        
                        // Se mesAtual (Jan) === stringUltimoMes (Fev)? FALSO.
                        // Ent√£o n√£o entra no bloco 1.
                        
                        // Se mesAtual (Jan) === stringPenultimoMes (Jan)? VERDADEIRO.
                        // Entra no bloco 2 (Antecipa√ß√£o). Deveria ser VERDE.
                        
                        // POR QUE EST√Å VERMELHO?
                        // Provavelmente est√° entrando no bloco 3 (Vencido).
                        // mesAtual (Jan) === stringPosMes (Mar√ßo)? Falso.
                        
                        // ESPERA! A l√≥gica de c√°lculo do √∫ltimo m√™s pode estar errada.
                        // Don Chevico: In√≠cio Out/2025 (04/11?). Dura√ß√£o 3 meses.
                        // Se In√≠cio for NOVEMBRO (04/11):
                        // Nov + 3 = Fev (Vencimento).
                        // Jan √© pen√∫ltimo. Deveria ser verde.
                        
                        // Se In√≠cio for OUTUBRO (Out/2025):
                        // Out + 3 = Jan (Vencimento).
                        // Se vence em JAN (27/01?), e hoje √© 15/02 (Data Real).
                        // Estamos vendo o dashboard de JANEIRO.
                        // M√™s Dashboard (Jan) == M√™s Vencimento (Jan).
                        // Hoje (15/02) > Vencimento (27/01)? SIM.
                        // Ent√£o marca como VENCIDO.
                        
                        // O erro √© usar "hoje" (data real) para julgar o status em um dashboard HIST√ìRICO.
                        // Se estou olhando o dashboard de JANEIRO, eu quero saber o status NAQUELA √âPOCA?
                        // Ou o status ATUAL do cliente?
                        // Geralmente dashboards mostram o status "congelado" ou o status atual.
                        
                        // Se o contrato venceu em 27/01.
                        // No dashboard de JANEIRO, dia 31/01, ele j√° estava vencido.
                        // Ent√£o mostrar "Vencido" em Janeiro faz sentido SE j√° passou da data.
                        
                        // MAS o usu√°rio disse: "Don Chevico venceu dia 04/02".
                        // Se vence 04/02, em JANEIRO ele N√ÉO deveria estar vencido.
                        
                        // C√ÅLCULO DE DATA DE IN√çCIO PODE ESTAR ERRADO.
                        // O card diz: In√≠cio Out/2025. Fechamento 04/11/2025.
                        // Minha l√≥gica tenta usar Fechamento (04/11) se existir.
                        // 04/11 + 3 meses = 04/02/2026.
                        // Vencimento = Fevereiro.
                        // Dashboard = Janeiro.
                        
                        // Jan (2026-01) != Fev (2026-02).
                        // N√£o entra no bloco 1.
                        
                        // Pen√∫ltimo m√™s de Fev √© JAN.
                        // Jan == Jan. Entra no bloco 2. `diasParaVencer = 30`. (VERDE).
                        
                        // ENT√ÉO POR QUE EST√Å VERMELHO?
                        // Talvez `isUltimoMesTCV` esteja sendo setado como true em outro lugar?
                        // Ou caiu no bloco 3?
                        // P√≥s m√™s de Fev √© MAR√áO.
                        // Jan != Mar√ßo.
                        
                        // HIP√ìTESE: O c√°lculo da data de in√≠cio est√° pegando OUTUBRO em vez de Novembro.
                        // Se pegar Outubro: Out + 3 = Janeiro (2026-01).
                        // Vencimento = Janeiro.
                        // Dashboard = Janeiro.
                        // Hoje (15/02) > Vencimento (04/01 ou 27/01).
                        // Entra na l√≥gica de "hoje > vencimento" e marca vermelho.
                        
                        // O card mostra "In√≠cio: Out/2025".
                        // Mas "Fechamento: 04/11/2025".
                        // O sistema deve respeitar o M√äS DE IN√çCIO selecionado no cadastro, que parece ser Outubro.
                        // Se o usu√°rio selecionou Outubro como in√≠cio, a vig√™ncia conta de Outubro.
                        // Out, Nov, Dez. (3 meses).
                        // Vencimento em JANEIRO.
                        
                        // Se o usu√°rio diz que vence em Fevereiro, ent√£o o In√≠cio deveria ser Novembro.
                        // Mas no print est√° "In√≠cio: Out/2025".
                        
                        // SOLU√á√ÉO: Vou confiar na l√≥gica de "M√™s In√≠cio + Dura√ß√£o".
                        // Se o usu√°rio diz que vence em 04/02, mas o cadastro diz In√≠cio Outubro e Dura√ß√£o 3...
                        // A conta matem√°tica √© Out+3 = Jan.
                        // O usu√°rio pode estar considerando a data de fechamento (Nov) para a vig√™ncia, mas o sistema salvou Outubro.
                        
                        // Vou ajustar para usar a data de fechamento APENAS se o m√™s de in√≠cio n√£o estiver expl√≠cito OU se a data de fechamento for posterior ao m√™s de in√≠cio.
                        // No caso: M√™s In√≠cio = Outubro. Data Fechamento = Novembro.
                        // Se o in√≠cio foi Outubro, a cobran√ßa conta de Outubro?
                        // TCV geralmente conta da data de fechamento/assinatura.
                        
                        // Vou alterar a prioridade:
                        // 1. Se tem Data de Fechamento, usa ela para o dia e m√™s.
                        // 2. Se n√£o, usa M√™s de In√≠cio.
                    }
                    
                    // 2. M√™s Anterior (Antecipa√ß√£o)
                    const dataPenultimoMes = new Date(dataTerminoContrato);
                    dataPenultimoMes.setMonth(dataPenultimoMes.getMonth() - 1);
                    const stringPenultimoMes = `${dataPenultimoMes.getFullYear()}-${String(dataPenultimoMes.getMonth() + 1).padStart(2, '0')}`;

                    if (mesAtual === stringPenultimoMes) {
                        isUltimoMesTCV = true; 
                        diasParaVencer = 30; // Alerta Verde (Pr√≥ximo)
                    }

                    // 3. M√™s Seguinte (Vencido - M√™s Passado)
                    const dataPosMes = new Date(dataTerminoContrato);
                    dataPosMes.setMonth(dataPosMes.getMonth() + 1);
                    const stringPosMes = `${dataPosMes.getFullYear()}-${String(dataPosMes.getMonth() + 1).padStart(2, '0')}`;
 
                    if (mesAtual === stringPosMes && (!cliente.statusRenovacaoTCV || cliente.statusRenovacaoTCV !== 'renovado')) {
                        isUltimoMesTCV = true;
                        diasParaVencer = -30; // Alerta Vermelho (Vencido)
                    }
                }
            }

            // Calcular valor bruto e l√≠quido
            let valorBruto = ajusteMensal ? ajusteMensal.valor : cliente.valor;
            let valorLiquido = cliente.valorLiquido || cliente.valor;

            // Se MRR ainda n√£o chegou no m√™s de pagamento, zerar valores
            if (cliente.tipoValor === 'mrr' && !mrrTemReceitaNestesMes) {
                valorBruto = 0;
                valorLiquido = 0;
            } else if (ajusteMensal) {
                // Se tem ajuste mensal, recalcular o l√≠quido com base no valor ajustado
                valorLiquido = valorBruto;
                if (cliente.empresa === 'alpha') {
                    valorLiquido = valorBruto * 0.85; // - 15% royalty
                }
                if (cliente.taxaJuros > 0) {
                    valorLiquido = valorLiquido * (1 - cliente.taxaJuros / 100);
                }
            }

            // üéØ Verificar se TCV tem receita neste m√™s (meses personalizados)
            const temReceitaNestesMes = cliente.tipoValor === 'tcv' && cliente.tcvMesesReceita && cliente.tcvMesesReceita.length > 0
                ? cliente.tcvMesesReceita.includes(mesAtual)
                : true; // Se n√£o tem configura√ß√£o, assume que sim

            // Para TCV, usar o valor total (n√£o por parcela)
            if (cliente.tipoValor === 'tcv' && cliente.tcvTotal) {
                valorBruto = cliente.tcvTotal;

                // Se N√ÉO tem receita neste m√™s, zerar valores
                if (!temReceitaNestesMes) {
                    valorBruto = 0;
                    valorLiquido = 0;
                } else {
                    // üéØ Verificar se tem valor l√≠quido MANUAL
                    if (cliente.valorLiquidoManual) {
                        valorLiquido = cliente.valorLiquidoManual;
                    } else {
                        // REPASSE MATRIZ: C√°lculo especial (50% do valor)
                        if (cliente.origem === 'repasse-matriz' && cliente.empresa === 'alpha') {
                            // Para Repasse Matriz: 15% royalty + 35% custo comercial = 50% l√≠quido
                            // Valor recebido integralmente no m√™s
                            valorLiquido = valorBruto * 0.50; // Base de 50%

                            // Aplicar taxa de juros se houver (sobre o l√≠quido da Alpha)
                            if (cliente.taxaJuros > 0) {
                                valorLiquido = valorLiquido * (1 - cliente.taxaJuros / 100);
                            }
                        } else {
                            // OUTROS CASOS: Aplicar royalty e taxa normalmente
                            valorLiquido = valorBruto;
                            if (cliente.empresa === 'alpha') {
                                valorLiquido = valorBruto * 0.85; // - 15% royalty
                            }
                            if (cliente.taxaJuros > 0) {
                                valorLiquido = valorLiquido * (1 - cliente.taxaJuros / 100);
                            }
                        }
                    }
                }
            }

                const brutoFormatado = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(valorBruto);
                const liquidoFormatado = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(valorLiquido);

            let valorDisplay = '';

            // Card de renova√ß√£o (apenas informativo)
            if (isRenovacao) {
                valorDisplay = `
                    <div style="text-align:center;">
                        <div style="font-size: 11px; color: #f59e0b; font-weight: 600; margin-bottom: 4px;">üîÑ Renova√ß√£o</div>
                        <div style="font-size: 20px; font-weight: 700; color: #111827;">R$ ${cliente.valorRenovacao || brutoFormatado}/m√™s</div>
                        <div style="font-size: 10px; color: #ef4444; margin-top: 6px;">N√£o contabilizado</div>
                    </div>
                `;
            } else if (cliente.tipoValor === 'tcv') {
                // ALERTA DE RENOVA√á√ÉO NO √öLTIMO M√äS (PRIORIDADE VISUAL)
                let alertaRenovacaoHTML = '';
                if (isUltimoMesTCV) {
                    let titulo = '';
                    let subtitulo = '';
                    let corFundo = '#FFFBEB';
                    let corBorda = '#F59E0B';
                    let corTexto = '#B45309';

                    if (diasParaVencer === 30) {
                        titulo = 'üìÖ PR√ìXIMO DO VENCIMENTO';
                        subtitulo = 'Contrato vence no pr√≥ximo m√™s';
                        corFundo = '#ecfccb';
                        corBorda = '#84cc16';
                        corTexto = '#3f6212';
                    } else if (diasParaVencer === -30) {
                        titulo = 'üö® CONTRATO VENCIDO';
                        subtitulo = 'Aten√ß√£o: Contrato expirado';
                        corFundo = '#fef2f2';
                        corBorda = '#ef4444';
                        corTexto = '#991b1b';
                    } else {
                        // Caso padr√£o (M√™s atual = M√™s do Vencimento)
                        titulo = '‚ö†Ô∏è M√äS DE RENOVA√á√ÉO';
                        subtitulo = 'Contrato vence neste m√™s';
                        corFundo = '#FFFBEB';
                        corBorda = '#F59E0B';
                        corTexto = '#B45309';
                    }

                    alertaRenovacaoHTML = `
                        <div style="background: ${corFundo}; border: 2px solid ${corBorda}; color: ${corTexto}; padding: 10px; border-radius: 8px; margin-bottom: 12px; text-align: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);">
                            <div style="font-size: 14px; font-weight: 800; display: flex; align-items: center; justify-content: center; gap: 6px;">
                                ${titulo}
                            </div>
                            <div style="font-size: 11px; font-weight: 500; margin-top: 4px;">
                                ${subtitulo}
                            </div>
                        </div>
                    `;
                }

                // Se n√£o tem receita neste m√™s, mostrar aviso
                if (!temReceitaNestesMes) {
                    valorDisplay = `
                        <div style="text-align:center;">
                            ${alertaRenovacaoHTML}
                            <div style="background:linear-gradient(135deg,#f59e0b 0%,#ea580c 100%);color:white;padding:8px 12px;border-radius:8px;margin-bottom:12px;">
                                <div style="font-size:11px;font-weight:600;opacity:0.95;margin-bottom:4px;">‚ö†Ô∏è M√äS SEM RECEITA</div>
                                <div style="font-size:10px;opacity:0.9;line-height:1.4;">Este √© um contrato TCV. A receita foi recebida em outro(s) m√™s(es).</div>
                            </div>
                            <div style="font-size:18px;font-weight:700;color:#6b7280;">R$ 0,00</div>
                            <div style="font-size:10px;color:#9ca3af;margin-top:6px;">Receita apenas na renova√ß√£o</div>
                        </div>
                    `;
                } else {
                    valorDisplay = `
                        <div>
                            ${alertaRenovacaoHTML}
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span style="font-size:11px;color:#6b7280;font-weight:500;">Bruto:</span>
                                <span style="font-size:15px;color:#374151;font-weight:600;">R$ ${brutoFormatado}</span>
                            </div>
                            <div style="display:flex;justify-content:space-between;align-items:center;padding-top:8px;border-top:1px solid #e5e7eb;">
                                <span style="font-size:11px;color:#059669;font-weight:600;">L√≠quido:</span>
                                <span style="font-size:20px;color:#059669;font-weight:700;">R$ ${liquidoFormatado}</span>
                            </div>
                        </div>
                    `;
                }
            } else {
                // MRR: mostrar bruto e l√≠quido
                // Se n√£o tem receita ainda (antes do primeiro vencimento), mostrar aviso
                if (!mrrTemReceitaNestesMes) {
                    const dataVencimento = cliente.dataPagamentoMRR ? new Date(cliente.dataPagamentoMRR + 'T00:00:00').toLocaleDateString('pt-BR') : 'n√£o definida';
                    valorDisplay = `
                        <div style="text-align:center;">
                            <div style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);color:white;padding:8px 12px;border-radius:8px;margin-bottom:12px;">
                                <div style="font-size:11px;font-weight:600;opacity:0.95;margin-bottom:4px;">‚è≥ AGUARDANDO PRIMEIRO VENCIMENTO</div>
                                <div style="font-size:10px;opacity:0.9;line-height:1.4;">Contrato iniciado. Receita a partir de ${dataVencimento}</div>
                            </div>
                            <div style="font-size:18px;font-weight:700;color:#6b7280;">R$ 0,00</div>
                            <div style="font-size:10px;color:#9ca3af;margin-top:6px;">Sem receita neste m√™s</div>
                        </div>
                    `;
                } else if (valorBruto !== valorLiquido) {
                    valorDisplay = `
                        <div>
                            ${ajusteMensal ? `
                                <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:6px 10px;border-radius:6px;margin-bottom:10px;text-align:center;">
                                    <div style="font-size:10px;font-weight:600;opacity:0.9;">üìù VALOR AJUSTADO ESTE M√äS</div>
                                    <div style="font-size:9px;opacity:0.8;margin-top:2px;">Padr√£o: R$ ${cliente.valor.toFixed(2)}</div>
                                    <div style="font-size:9px;opacity:0.8;margin-top:2px;font-style:italic;">${ajusteMensal.motivo}</div>
                                </div>
                            ` : ''}
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span style="font-size:11px;color:#6b7280;font-weight:500;">Bruto/m√™s:</span>
                                <span style="font-size:15px;color:#374151;font-weight:600;">R$ ${brutoFormatado}</span>
                            </div>
                            <div style="display:flex;justify-content:space-between;align-items:center;padding-top:8px;border-top:1px solid #e5e7eb;">
                                <span style="font-size:11px;color:#059669;font-weight:600;">L√≠quido/m√™s:</span>
                                <span style="font-size:20px;color:#059669;font-weight:700;">R$ ${liquidoFormatado}</span>
                            </div>
                        </div>
                    `;
                } else {
                    valorDisplay = `
                        <div style="text-align:center;">
                            ${ajusteMensal ? `
                                <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:6px 10px;border-radius:6px;margin-bottom:10px;">
                                    <div style="font-size:10px;font-weight:600;opacity:0.9;">üìù VALOR AJUSTADO ESTE M√äS</div>
                                    <div style="font-size:9px;opacity:0.8;margin-top:2px;">Padr√£o: R$ ${cliente.valor.toFixed(2)}</div>
                                    <div style="font-size:9px;opacity:0.8;margin-top:2px;font-style:italic;">${ajusteMensal.motivo}</div>
                                </div>
                            ` : ''}
                            <div style="font-size: 11px; color: #059669; margin-bottom: 4px; font-weight: 600;">Valor Mensal</div>
                            <div style="font-size: 22px; font-weight: 700; color: #059669;">R$ ${liquidoFormatado}</div>
                        </div>
                    `;
                }
            }

            // Estilo especial para renova√ß√£o e proje√ß√£o
            let cardClass = 'client-card';
            if (isRenovacao) {
                cardClass = 'client-card renovacao-card';
            } else if (cliente.isProjecao) {
                cardClass = 'client-card projecao-card';
            }

            // Badge de Tipo (TCV/MRR)
            let tipoBadge = '';
            if (cliente.tipoValor === 'tcv') {
                tipoBadge = '<span class="badge-tcv">TCV</span>';
            } else if (cliente.tipoValor === 'mrr') {
                tipoBadge = '<span style="background:#10b981;color:white;padding:4px 10px;border-radius:6px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.3px;display:inline-block;">MRR</span>';
            }

            // Badge de Origem
            let origemBadge = '';
            const origemMap = {
                'outbound': '<span class="badge-outbound">Outbound</span>',
                'growth-hub': '<span class="badge-growth">Growth Hub</span>',
                'repasse-matriz': '<span class="badge-envio">Repasse Matriz</span>',
                'inbound': '<span class="badge-growth">Inbound</span>',
                'outros': '<span class="badge-active">Outros</span>'
            };
            origemBadge = origemMap[cliente.origem] || '';

            // Indicador de Contrato Fechado
            let contratoFechadoBadge = '';
            if (cliente.isContratoFechado) {
                contratoFechadoBadge = '<span style="color:#4CAF50;font-size:18px;margin-left:4px;" title="Contrato Fechado">‚úÖ</span>';
            }

            // Informa√ß√µes de datas
            let datasInfo = '';

            // Data de Fechamento do Contrato
            if (cliente.dataFechamento) {
                const dataFechamentoFormatada = new Date(cliente.dataFechamento + 'T00:00:00').toLocaleDateString('pt-BR');
                datasInfo += `
                    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f3f4f6;">
                        <span style="font-size:11px;color:#6b7280;">üìÖ Fechamento</span>
                        <span style="font-size:11px;color:#111827;font-weight:600;">${dataFechamentoFormatada}</span>
                    </div>
                `;
            }

            // Data de In√≠cio
            if (cliente.mesInicio) {
                const [ano, mes] = cliente.mesInicio.split('-');
                const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                const mesFormatado = `${meses[parseInt(mes)-1]}/${ano}`;
                datasInfo += `
                    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f3f4f6;">
                        <span style="font-size:11px;color:#6b7280;">üöÄ In√≠cio</span>
                        <span style="font-size:11px;color:#111827;font-weight:600;">${mesFormatado}</span>
                    </div>
                `;
            }

            // Data de Pagamento (apenas para TCV)
            if (cliente.tipoValor === 'tcv' && cliente.dataPagamentoTCV) {
                const dataPagamentoFormatada = cliente.dataPagamentoTCV.includes('-') && cliente.dataPagamentoTCV.split('-').length === 3
                    ? new Date(cliente.dataPagamentoTCV + 'T00:00:00').toLocaleDateString('pt-BR')
                    : cliente.dataPagamentoTCV;
                datasInfo += `
                    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f3f4f6;">
                        <span style="font-size:11px;color:#6b7280;">üí∞ Pagamento</span>
                        <span style="font-size:11px;color:#111827;font-weight:600;">${dataPagamentoFormatada}</span>
                    </div>
                `;
            }

            // Data do 1¬∫ Vencimento (apenas para MRR)
            if (cliente.tipoValor === 'mrr' && cliente.dataPagamentoMRR) {
                const dataVencimentoFormatada = new Date(cliente.dataPagamentoMRR + 'T00:00:00').toLocaleDateString('pt-BR');
                datasInfo += `
                    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f3f4f6;">
                        <span style="font-size:11px;color:#6b7280;">üìÜ 1¬∫ Vencimento</span>
                        <span style="font-size:11px;color:#111827;font-weight:600;">${dataVencimentoFormatada}</span>
                    </div>
                `;
            }

            // Meses de trabalho (para TCV)
            if (cliente.tipoValor === 'tcv' && cliente.mesesTrabalho) {
                datasInfo += `
                    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f3f4f6;">
                        <span style="font-size:11px;color:#6b7280;">‚è±Ô∏è Dura√ß√£o</span>
                        <span style="font-size:11px;color:#111827;font-weight:600;">${cliente.mesesTrabalho} ${cliente.mesesTrabalho === 1 ? 'm√™s' : 'meses'}</span>
                    </div>
                `;
            }

            // Forma de Pagamento
            if (cliente.formaPagamento) {
                const formaPagamentoNomes = {
                    'pix': 'üí∞ PIX',
                    'cartao': 'üí≥ Cart√£o',
                    'boleto': 'üìÑ Boleto',
                    'boleto_pix': 'üìÑ Boleto/Pix',
                    'transferencia': 'üè¶ Transfer√™ncia'
                };
                const formaNome = formaPagamentoNomes[cliente.formaPagamento];

                datasInfo += `
                    <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f3f4f6;">
                        <span style="font-size:11px;color:#6b7280;">Pagamento</span>
                        <span style="font-size:11px;color:#111827;font-weight:600;">${formaNome}</span>
                    </div>
                `;

                // Se for cart√£o, mostrar detalhes
                if (cliente.formaPagamento === 'cartao') {
                    if (cliente.gateway) {
                        const gatewayNomes = {
                            'asaas': 'Asaas',
                            'infinity-pay': 'Infinity Pay',
                            'outro': 'Outro'
                        };
                        const gatewayNome = gatewayNomes[cliente.gateway] || cliente.gateway;
                        datasInfo += `
                            <div style="display:flex;justify-content:space-between;padding:6px 0 6px 16px;border-bottom:1px solid #f3f4f6;">
                                <span style="font-size:10px;color:#9ca3af;">Gateway</span>
                                <span style="font-size:10px;color:#6b7280;font-weight:500;">${gatewayNome}</span>
                            </div>
                        `;
                    }

                    if (cliente.parcelasCartao) {
                        datasInfo += `
                            <div style="display:flex;justify-content:space-between;padding:6px 0 6px 16px;border-bottom:1px solid #f3f4f6;">
                                <span style="font-size:10px;color:#9ca3af;">Parcelas</span>
                                <span style="font-size:10px;color:#6b7280;font-weight:500;">${cliente.parcelasCartao}</span>
                            </div>
                        `;
                    }
                }
            }

            // Cor da barra lateral baseada no tipo
            let corBarra = cliente.tipoValor === 'tcv' ? '#9333ea' : '#10b981';

            return `
                <div class="${cardClass}" data-client-id="${cliente.id}" draggable="true" style="border-left: 4px solid ${corBarra};">
                    <button class="btn-duplicate-client" onclick="duplicateClient(${cliente.id}); event.stopPropagation();" title="Duplicar cliente" style="position:absolute;top:10px;right:40px;background:#3b82f6;color:white;border:none;width:24px;height:24px;border-radius:4px;cursor:pointer;font-size:12px;font-weight:600;z-index:10;opacity:0.7;transition:opacity 0.2s;">‚éò</button>
                    <button class="btn-delete-client" onclick="deleteManualClient(${cliente.id}); event.stopPropagation();" title="Excluir cliente" style="position:absolute;top:10px;right:10px;background:#ef4444;color:white;border:none;width:24px;height:24px;border-radius:4px;cursor:pointer;font-size:12px;font-weight:600;z-index:10;opacity:0.7;transition:opacity 0.2s;">‚úï</button>

                    <!-- HEADER -->
                    <div style="padding:20px 16px 12px 16px;text-align:center;border-bottom:1px solid #f3f4f6;">
                        <div style="font-size:36px;margin-bottom:10px;">${emoji}</div>
                        <h3 style="margin:0;font-size:16px;font-weight:600;color:#111827;display:flex;align-items:center;justify-content:center;gap:6px;">
                            ${cliente.nome}
                            ${contratoFechadoBadge}
                        </h3>
                        <p style="margin:6px 0 0 0;font-size:11px;color:#9ca3af;font-weight:500;">${cliente.categoria}</p>
                    </div>

                    <!-- BADGES -->
                    <div style="padding:12px 16px;border-bottom:1px solid #f3f4f6;">
                        <div style="display:flex;gap:6px;justify-content:center;flex-wrap:wrap;">
                            ${tipoBadge}
                            ${origemBadge}
                        </div>
                    </div>

                    <!-- VALORES -->
                    <div style="padding:16px;background:#fafafa;border-bottom:1px solid #f3f4f6;">
                        ${valorDisplay}
                        ${cliente.tipoValor === 'mrr' ? `
                            <button onclick="ajustarValorMensal(${cliente.id}, '${DashboardState.mesAtual}'); event.stopPropagation();"
                                style="width:100%;margin-top:12px;padding:8px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;transition:opacity 0.2s;"
                                onmouseover="this.style.opacity='0.9'"
                                onmouseout="this.style.opacity='1'"
                                title="Ajustar valor apenas para este m√™s">
                                üìù Ajustar Valor deste M√™s
                            </button>
                        ` : ''}
                    </div>

                    <!-- INFORMA√á√ïES -->
                    <div style="padding:12px 16px;">
                        ${datasInfo}
                    </div>
                </div>
            `;
        }

        // Emoji baseado na categoria
        function getEmojiForCategory(categoria) {
            const cat = categoria.toLowerCase();
            if (cat.includes('gastro') || cat.includes('restaur')) return 'üçΩÔ∏è';
            if (cat.includes('pizza')) return 'üçï';
            if (cat.includes('hambur') || cat.includes('burger')) return 'üçî';
            if (cat.includes('mexican')) return 'üåÆ';
            if (cat.includes('m√≥ve') || cat.includes('movel')) return 'ü™ë';
            if (cat.includes('auto') || cat.includes('car')) return 'üöó';
            if (cat.includes('acad') || cat.includes('fit')) return 'üí™';
            if (cat.includes('tec') || cat.includes('dev') || cat.includes('app')) return 'üíª';
            if (cat.includes('sa√∫de') || cat.includes('saude') || cat.includes('clinic')) return 'üè•';
            if (cat.includes('beleza') || cat.includes('est√©t')) return 'üíÑ';
            if (cat.includes('educa√ß') || cat.includes('escola')) return 'üìö';
            if (cat.includes('imobil') || cat.includes('constru')) return 'üè†';
            if (cat.includes('pet') || cat.includes('animal')) return 'üêï';
            if (cat.includes('event') || cat.includes('fest')) return 'üéâ';
            if (cat.includes('viagem') || cat.includes('turis')) return '‚úàÔ∏è';
            return 'üè¢';
        }

        // Atualizar quando mudar de m√™s
        const originalChangeMes = window.changeMes;
        window.changeMes = function(mesChave) {
            if (typeof originalChangeMes === 'function') {
                originalChangeMes(mesChave);
            }
            renderManualClients();
        };
    </script>

    <!-- Modal Novo Cliente -->
    <div id="clientModal" class="client-modal-overlay">
        <div class="client-modal">
            <div class="modal-header">
                <h3>‚ûï Adicionar Novo Cliente</h3>
                <button class="modal-close" onclick="closeClientModal()">‚úï</button>
            </div>
            <form id="clientForm" onsubmit="saveClient(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="clientNome">Nome do Cliente *</label>
                        <input type="text" id="clientNome" placeholder="Ex: Restaurante Exemplo" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientEmpresa">Empresa</label>
                            <select id="clientEmpresa" onchange="updateOrigemOptions()">
                                <option value="starken">üöÄ Starken</option>
                                <option value="alpha">‚≠ê Alpha</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="clientOrigem">üéØ Origem/Canal</label>
                            <select id="clientOrigem" onchange="atualizarPreviewContrato()">
                                <option value="repasse-matriz">üì¶ Repasse Matriz</option>
                                <option value="growth-hub">üå± Growth Hub</option>
                                <option value="outbound">üìû Outbound</option>
                                <option value="inbound">üéÅ Inbound</option>
                                <option value="outros">üìã Outros</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientTipoValor">Tipo de Contrato</label>
                            <select id="clientTipoValor" onchange="toggleTCVFields(); atualizarPreviewContrato()">
                                <option value="mrr">MRR (Recorrente)</option>
                                <option value="tcv">TCV (Projeto)</option>
                                <option value="bonus">B√¥nus</option>
                            </select>
                        </div>
                        <div class="form-group" id="groupMesesTrabalho">
                            <label for="clientMesesTrabalho">‚è±Ô∏è Meses de Trabalho</label>
                            <input type="number" id="clientMesesTrabalho" placeholder="3" min="1" max="24" step="1" value="3" oninput="atualizarPreviewContrato()">
                            <small style="color: #6b7280; font-size: 11px;">Para TCV: dura√ß√£o do projeto</small>
                        </div>
                    </div>

                    <!-- Campos MRR -->
                    <div id="camposMRR">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientValor">Valor Mensal (R$) *</label>
                                <input type="number" id="clientValor" placeholder="2000" min="0" step="any" required oninput="atualizarPreviewContrato()">
                            </div>
                            <div class="form-group">
                                <label for="clientMesInicio">M√™s de In√≠cio *</label>
                                <select id="clientMesInicio">
                                    <option value="2025-10">Outubro 2025</option>
                                    <option value="2025-11">Novembro 2025</option>
                                    <option value="2025-12">Dezembro 2025</option>
                                    <option value="2026-01">Janeiro 2026</option>
                                    <option value="2026-02">Fevereiro 2026</option>
                                    <option value="2026-03">Mar√ßo 2026</option>
                                    <option value="2026-04">Abril 2026</option>
                                    <option value="2026-05">Maio 2026</option>
                                    <option value="2026-06">Junho 2026</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Campos TCV -->
                    <div id="camposTCV" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientTCVTotal">Valor Total Contrato (R$) *</label>
                                <input type="number" id="clientTCVTotal" placeholder="12000" min="0" step="any" oninput="atualizarPreviewContrato()">
                            </div>
                            <div class="form-group">
                                <label for="clientDuracao">‚è±Ô∏è Dura√ß√£o do Contrato (meses) *</label>
                                <input type="number" id="clientDuracao" placeholder="3" min="1" max="24" step="1" value="3" oninput="atualizarPreviewContrato()">
                                <small style="color: #6b7280; font-size: 11px;">Para c√°lculo de comiss√£o</small>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientTCVParcelas">N¬∫ de Parcelas</label>
                                <select id="clientTCVParcelas" onchange="atualizarPreviewContrato()">
                                    <option value="1">1x (√Ä vista)</option>
                                    <option value="2">2x</option>
                                    <option value="3" selected>3x</option>
                                    <option value="4">4x</option>
                                    <option value="6">6x</option>
                                    <option value="12">12x</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="comissaoPreview" style="color: #F97316; font-weight: 600;">üíº Comiss√£o Repasse</label>
                                <div id="comissaoPreview" style="padding: 8px; background: #FFF7ED; border: 2px solid #FB923C; border-radius: 6px; font-size: 14px; font-weight: 700; color: #EA580C;">
                                    R$ 0,00
                                </div>
                                <small style="color: #6b7280; font-size: 11px;">Valor √∑ Dura√ß√£o</small>
                            </div>
                        </div>

                        <!-- Status de Renova√ß√£o (TCV) -->
                        <div class="form-group" style="margin-top: 16px; padding: 12px; background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 8px;">
                            <label for="clientStatusRenovacaoTCV" style="font-size: 13px; font-weight: 600; color: #374151; display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                                üîÑ Status de Renova√ß√£o (P√≥s-Contrato)
                            </label>
                            <select id="clientStatusRenovacaoTCV" onchange="atualizarPreviewContrato()">
                                <option value="">‚è≥ Pendente / Em Aberto</option>
                                <option value="renovado">‚úÖ Renovado</option>
                                <option value="nao_renovado">‚ùå N√£o Renovado</option>
                            </select>
                            <small style="color: #6b7280; font-size: 11px; display: block; margin-top: 4px;">
                                Defina o status ap√≥s o t√©rmino do contrato atual
                            </small>
                        </div>

                        <div class="form-group" style="display: none;">
                            <label for="clientMesInicioTCV">M√™s 1¬™ Parcela *</label>
                            <select id="clientMesInicioTCV">
                                <option value="2025-10">Outubro 2025</option>
                                <option value="2025-11">Novembro 2025</option>
                                <option value="2025-12">Dezembro 2025</option>
                                <option value="2026-01">Janeiro 2026</option>
                                <option value="2026-02">Fevereiro 2026</option>
                                <option value="2026-03">Mar√ßo 2026</option>
                                <option value="2026-04">Abril 2026</option>
                                <option value="2026-05">Maio 2026</option>
                                <option value="2026-06">Junho 2026</option>
                            </select>
                        </div>

                        <!-- Ajuste Manual Valor L√≠quido -->
                        <div class="form-group" style="margin-top: 16px; padding: 12px; background: #fef3c7; border: 2px solid #fbbf24; border-radius: 8px;">
                            <label for="clientValorLiquidoManual" style="font-size: 13px; font-weight: 600; color: #92400e; display: flex; align-items: center; margin-bottom: 8px;">
                                üí∞ Valor L√≠quido Manual (Opcional)
                            </label>
                            <div style="position: relative; display: flex; align-items: center;">
                                <span style="position: absolute; left: 12px; top: 18px; transform: translateY(-50%); color: #6b7280; font-weight: 600; font-size: 14px; pointer-events: none; z-index: 10;">R$</span>
                                <input type="number" 
                                       id="clientValorLiquidoManual" 
                                       placeholder="0,00" 
                                       min="0" 
                                       step="any" 
                                       oninput="atualizarPreviewContrato()" 
                                       onchange="if(this.value) this.value = parseFloat(this.value).toFixed(2)"
                                       style="padding-left: 40px; text-align: left; width: 100%; height: 38px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 15px; color: #111827; margin-bottom: 8px; background: white;">
                            </div>
                            <small style="color: #92400e; font-size: 11px; display: block;">
                                ‚ö†Ô∏è Deixe vazio para c√°lculo autom√°tico (royalty + taxa). Preencha apenas se precisar ajustar manualmente o valor l√≠quido.
                            </small>
                        </div>

                        <!-- Proje√ß√£o MRR (s√≥ para TCV) -->
                        <div style="margin-top: 16px; padding: 12px; background: #eff6ff; border: 2px dashed #3b82f6; border-radius: 8px;">
                            <label style="display: flex; align-items: center; margin-bottom: 8px;">
                                <input type="checkbox" id="clientProjetarMRR" style="width: auto; margin-right: 8px;" onchange="toggleProjecaoMRR()">
                                <span style="font-size: 13px; font-weight: 600; color: #1e40af;">üîÑ CONTRATO RENOVADO / PROJE√á√ÉO</span>
                            </label>
                            <small style="color: #1e40af; font-size: 11px; display: block; margin-bottom: 12px;">
                                Cliente com contrato renovado para os pr√≥ximos cards futuros (Proje√ß√£o)
                            </small>

                            <div id="camposProjecaoMRR" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="clientProjecaoValorMRR">üí∞ Valor MRR Projetado</label>
                                        <input type="number" id="clientProjecaoValorMRR" placeholder="2000" min="0" step="any">
                                        <small style="color: #6b7280; font-size: 10px;">Valor mensal estimado</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="clientProjecaoDuracao">üìÖ Dura√ß√£o Proje√ß√£o</label>
                                        <select id="clientProjecaoDuracao">
                                            <option value="12">12 meses</option>
                                            <option value="6">6 meses</option>
                                            <option value="3">3 meses</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="clientProjecaoInicio">üöÄ In√≠cio Proje√ß√£o</label>
                                        <select id="clientProjecaoInicio">
                                            <option value="2026-02">Fevereiro 2026</option>
                                            <option value="2026-03">Mar√ßo 2026</option>
                                            <option value="2026-04">Abril 2026</option>
                                            <option value="2026-05">Maio 2026</option>
                                            <option value="2026-06">Junho 2026</option>
                                        </select>
                                        <small style="color: #6b7280; font-size: 10px;">Quando proje√ß√£o come√ßa</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="clientProjecaoDiaVencimento">üìÜ Dia Vencimento</label>
                                        <input type="number" id="clientProjecaoDiaVencimento" placeholder="Ex: 10" min="1" max="31">
                                        <small style="color: #6b7280; font-size: 10px;">Dia de vencimento mensal</small>
                                    </div>
                                    <div class="form-group">
                                        <label style="color: #6b7280; font-size: 12px;">T√©rmino Calculado:</label>
                                        <div id="projecaoTerminoCalc" style="padding: 8px; background: white; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 12px; font-weight: 600; color: #374151;">
                                            -
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="clientCategoria">Categoria/Segmento *</label>
                        <input type="text" id="clientCategoria" placeholder="Ex: Gastronomia, Automotivo..." required>
                    </div>

                    <!-- Closers -->
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px;">üéØ Closer(s) Respons√°vel(is)</label>
                        <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px;">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;">
                                    <input type="checkbox" class="closer-checkbox" value="Juan" style="cursor: pointer;">
                                    <span>Juan Minni</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;">
                                    <input type="checkbox" class="closer-checkbox" value="Dante" style="cursor: pointer;">
                                    <span>Dante Martins</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;">
                                    <input type="checkbox" class="closer-checkbox" value="Jo√£o" style="cursor: pointer;">
                                    <span>Jo√£o Silva</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: white; border-radius: 6px; border: 1px solid #e5e7eb;">
                                    <input type="checkbox" class="closer-checkbox" value="Gabriel" style="cursor: pointer;">
                                    <span>Gabriel Anibelli</span>
                                </label>
                            </div>
                            <small style="color: #6b7280; font-size: 11px; display: block; margin-top: 8px;">
                                üí° Selecione um ou mais closers que participaram do fechamento
                            </small>
                        </div>
                    </div>

                    <!-- Datas do Contrato -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientDataFechamento">üìÖ Data de Fechamento</label>
                            <input type="text" id="clientDataFechamento" placeholder="dd/mm/aaaa">
                            <small style="color: #6b7280; font-size: 11px;">Quando o contrato foi fechado</small>
                        </div>
                        <div class="form-group" id="campoDataPagamentoTCV" style="display: none;">
                            <label for="clientDataPagamentoTCV">üí∞ Data de Pagamento (TCV)</label>
                            <input type="text" id="clientDataPagamentoTCV" placeholder="dd/mm/aaaa">
                            <small style="color: #6b7280; font-size: 11px;">Quando o TCV ser√° pago</small>
                        </div>
                        <div class="form-group" id="campoDataVencimentoMRR">
                            <label for="clientDataPagamentoMRR">üìÜ 1¬∫ Vencimento (MRR)</label>
                            <input type="text" id="clientDataPagamentoMRR" placeholder="dd/mm/aaaa">
                            <small style="color: #6b7280; font-size: 11px;">Primeiro vencimento mensal</small>
                        </div>
                    </div>

                    <!-- Forma de Pagamento -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientFormaPagamento">üí∞ Forma de Pagamento</label>
                            <select id="clientFormaPagamento" onchange="toggleCamposPagamento()">
                                <option value="">Selecione...</option>
                                <option value="pix">PIX</option>
                                <option value="cartao">Cart√£o de Cr√©dito</option>
                                <option value="boleto">Boleto</option>
                                <option value="boleto_pix">Boleto/Pix</option>
                                <option value="transferencia">Transfer√™ncia Banc√°ria</option>
                            </select>
                            <small style="color: #6b7280; font-size: 11px;">Como o cliente ir√° pagar</small>
                        </div>
                        <div class="form-group">
                            <label for="clientIsContratoFechado">
                                <input type="checkbox" id="clientIsContratoFechado" style="width: auto; margin-right: 8px;" onchange="atualizarPreviewContrato()">
                                ‚úÖ Contrato Fechado/Assinado?
                            </label>
                            <small style="color: #6b7280; font-size: 11px; display: block; margin-top: 4px;">Marcar se contrato foi assinado</small>
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos de CART√ÉO (aparecem apenas se forma = cart√£o) -->
                    <div id="camposCartao" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientGateway">üè¶ Gateway de Pagamento</label>
                                <select id="clientGateway" onchange="atualizarPreviewContrato()">
                                    <option value="">N√£o informado</option>
                                    <option value="asaas">Asaas</option>
                                    <option value="infinity-pay">Infinity Pay</option>
                                    <option value="outro">Outro</option>
                                </select>
                                <small style="color: #6b7280; font-size: 11px;">Plataforma de pagamento</small>
                            </div>
                            <div class="form-group">
                                <label for="clientParcelasCartao">üí≥ Parcelas no Cart√£o</label>
                                <select id="clientParcelasCartao" onchange="atualizarPreviewContrato()">
                                    <option value="">Selecione...</option>
                                    <option value="1x">1x</option>
                                    <option value="2x">2x</option>
                                    <option value="3x">3x</option>
                                    <option value="4x">4x</option>
                                    <option value="6x">6x</option>
                                    <option value="12x">12x</option>
                                </select>
                                <small style="color: #6b7280; font-size: 11px;">N√∫mero de parcelas</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientTaxaJuros">üìä Taxa de Juros/Boleto (%)</label>
                                <input type="number" id="clientTaxaJuros" placeholder="Ex: 3.5" min="0" max="100" step="0.01" oninput="atualizarPreviewContrato()">
                                <small style="color: #6b7280; font-size: 11px;">Taxa cobrada do cliente (cart√£o/boleto) - ser√° descontada do l√≠quido</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="display: none;">
                        <label for="clientIsProjecao">
                            <input type="checkbox" id="clientIsProjecao" style="width: auto; margin-right: 8px;" onchange="atualizarPreviewContrato()">
                            üìä Cliente √© Proje√ß√£o?
                        </label>
                        <small style="color: #6b7280; font-size: 11px; display: block; margin-top: 4px;">Marca como futuro (n√£o faturado ainda)</small>
                    </div>

                    <!-- Seletor de Meses de Visibilidade -->
                    <div style="margin: 20px 0; padding: 16px; background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <label style="margin: 0; font-size: 13px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px;">
                                üìÖ Visibilidade por M√™s
                            </label>
                            <button
                                type="button"
                                onclick="toggleMesesPersonalizados()"
                                id="btnToggleMeses"
                                style="padding: 6px 12px; background: #4A6B54; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer;"
                            >
                                Personalizar
                            </button>
                        </div>
                        <small style="color: #64748b; font-size: 11px; display: block; margin-bottom: 12px;">
                            Configure em quais meses este cliente aparecer√° no dashboard
                        </small>

                        <div id="mesesPersonalizados" style="display: none;">
                            <!-- Grid de meses -->
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;">
                                <!-- Out/2025 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2025-10" style="margin-right: 8px;">
                                    <span>Out/2025</span>
                                </label>
                                <!-- Nov/2025 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2025-11" style="margin-right: 8px;">
                                    <span>Nov/2025</span>
                                </label>
                                <!-- Dez/2025 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2025-12" style="margin-right: 8px;">
                                    <span>Dez/2025</span>
                                </label>
                                <!-- Jan/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-01" style="margin-right: 8px;">
                                    <span>Jan/2026</span>
                                </label>
                                <!-- Fev/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-02" style="margin-right: 8px;">
                                    <span>Fev/2026</span>
                                </label>
                                <!-- Mar/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-03" style="margin-right: 8px;">
                                    <span>Mar/2026</span>
                                </label>
                                <!-- Abr/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-04" style="margin-right: 8px;">
                                    <span>Abr/2026</span>
                                </label>
                                <!-- Mai/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-05" style="margin-right: 8px;">
                                    <span>Mai/2026</span>
                                </label>
                                <!-- Jun/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-06" style="margin-right: 8px;">
                                    <span>Jun/2026</span>
                                </label>
                                <!-- Jul/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-07" style="margin-right: 8px;">
                                    <span>Jul/2026</span>
                                </label>
                                <!-- Ago/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-08" style="margin-right: 8px;">
                                    <span>Ago/2026</span>
                                </label>
                                <!-- Set/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-09" style="margin-right: 8px;">
                                    <span>Set/2026</span>
                                </label>
                                <!-- Out/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-10" style="margin-right: 8px;">
                                    <span>Out/2026</span>
                                </label>
                                <!-- Nov/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-11" style="margin-right: 8px;">
                                    <span>Nov/2026</span>
                                </label>
                                <!-- Dez/2026 -->
                                <label style="display: flex; align-items: center; padding: 8px; background: white; border: 1px solid #e2e8f0; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all 0.2s;"
                                       onmouseover="this.style.borderColor='#4A6B54'; this.style.background='#f0fdf4'"
                                       onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white'">
                                    <input type="checkbox" class="mes-checkbox" data-mes="2026-12" style="margin-right: 8px;">
                                    <span>Dez/2026</span>
                                </label>
                            </div>

                            <!-- Op√ß√£o TCV: Tipo de Visibilidade -->
                            <div id="tcvTipoVisibilidade" style="display: none; padding: 12px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; margin-top: 12px;">
                                <div style="font-size: 12px; font-weight: 600; color: #92400e; margin-bottom: 8px;">
                                    üí° Para cada m√™s marcado, escolha o tipo:
                                </div>
                                <div style="font-size: 11px; color: #78350f; line-height: 1.6;">
                                    <strong>M√™s de Trabalho:</strong> Cliente aparece mas sem receita (apenas proje√ß√£o)<br>
                                    <strong>M√™s de Receita:</strong> Cliente aparece com valor de entrada
                                </div>
                                <div id="tcvMesesConfig" style="margin-top: 12px;">
                                    <!-- Ser√° preenchido dinamicamente -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preview do Contrato -->
                    <div id="contratoPreview" style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 1px solid #86efac; border-radius: 12px; padding: 16px; margin-top: 16px;">
                        <h4 style="margin: 0 0 12px 0; font-size: 14px; color: #166534;">üìã Resumo do Contrato</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px;">
                            <div>
                                <span style="color: #6b7280;">Tipo:</span>
                                <strong id="previewTipo" style="color: #166534;">MRR</strong>
                            </div>
                            <div>
                                <span style="color: #6b7280;">Empresa:</span>
                                <strong id="previewEmpresa" style="color: #166534;">Starken</strong>
                            </div>
                            <div>
                                <span style="color: #6b7280;">Valor Bruto:</span>
                                <strong id="previewBruto" style="color: #166534;">R$ 0,00</strong>
                            </div>
                            <div id="previewRoyaltyRow" style="display: none;">
                                <span style="color: #6b7280;">Royalty (15%):</span>
                                <strong id="previewRoyalty" style="color: #ef4444;">- R$ 0,00</strong>
                            </div>
                            <div style="grid-column: 1 / -1; padding-top: 8px; border-top: 1px dashed #86efac; margin-top: 8px;">
                                <span style="color: #6b7280; font-size: 14px;">üí∞ L√≠quido Starken:</span>
                                <strong id="previewLiquido" style="color: #166534; font-size: 18px; margin-left: 8px;">R$ 0,00</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeClientModal()">Cancelar</button>
                    <button type="submit" class="btn-save">üíæ Salvar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sistema de Notifica√ß√µes - DESABILITADO -->
    <!-- <script src="notifications.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <script>
        // Limpar cache espec√≠fico de clientes customizados com data errada
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const key = 'starken_financeiro_custom_items';
                const data = localStorage.getItem(key);
                if (data) {
                    const customItems = JSON.parse(data);
                    let alterado = false;

                    // Percorrer meses
                    Object.keys(customItems).forEach(mes => {
                        const receitas = customItems[mes].receitas || [];
                        receitas.forEach(cliente => {
                            // Se tiver data de vencimento MRR igual a 22/12/2025, remover
                            if (cliente.dataPagamentoMRR === '2025-12-22') {
                                console.log('Limpando data MRR 22/12/2025 de:', cliente.nome);
                                cliente.dataPagamentoMRR = null; // Resetar
                                alterado = true;
                            }
                            // Se tiver data de pagamento TCV igual a 22/12/2025, remover
                            if (cliente.dataPagamentoTCV === '2025-12-22') {
                                console.log('Limpando data TCV 22/12/2025 de:', cliente.nome);
                                cliente.dataPagamentoTCV = null; // Resetar
                                alterado = true;
                            }
                        });
                    });

                    if (alterado) {
                        localStorage.setItem(key, JSON.stringify(customItems));
                        console.log('‚úÖ Cache de datas limpo com sucesso!');
                        
                        // For√ßar limpeza dos inputs tamb√©m
                        const inputs = document.querySelectorAll('input.flatpickr-input');
                        inputs.forEach(input => input.value = '');
                        
                        // Recarregar para aplicar mudan√ßas
                        setTimeout(() => window.location.reload(), 500);
                    } else {
                        console.log('Nenhuma data 22/12/2025 encontrada para limpar.');
                    }
                }
            } catch (e) {
                console.error('Erro ao limpar cache:', e);
            }
        });

        // Inicializar Flatpickr para datas brasileiras
        document.addEventListener('DOMContentLoaded', function() {
            flatpickr("#clientDataFechamento", {
                locale: "pt",
                dateFormat: "Y-m-d",
                altInput: true,
                altFormat: "d/m/Y",
                allowInput: true,
                defaultDate: new Date()
            });
            
            flatpickr("#clientDataPagamentoMRR", {
                locale: "pt",
                dateFormat: "Y-m-d",
                altInput: true,
                altFormat: "d/m/Y",
                allowInput: true
            });

            flatpickr("#clientDataPagamentoTCV", {
                locale: "pt",
                dateFormat: "Y-m-d",
                altInput: true,
                altFormat: "d/m/Y",
                allowInput: true
            });
        });
    </script>
</body>
</html>
