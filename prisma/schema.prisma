generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabela para armazenar status de pagamentos (despesas e receitas)
model PaymentStatus {
  id            String   @id @default(cuid())
  mes           String   // Ex: "2025-12"
  tipo          String   // "despesa" ou "receita"
  itemNome      String   // Nome do item
  status        String   // "Pago", "A Pagar", "Recebido", "A Receber"
  dataPagamento String?  // Data do pagamento se pago
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([mes, tipo, itemNome])
  @@index([mes])
  @@index([status])
  @@index([mes, tipo])
  @@map("payment_status")
}

// Tabela para itens customizados (despesas/receitas adicionadas manualmente)
model CustomItem {
  id            String   @id @default(cuid())
  mes           String   // Ex: "2025-12"
  tipo          String   // "despesa" ou "receita"
  nome          String
  valor         Float
  categoria     String?
  status        String   @default("A Pagar")
  vencimento    String?
  dataPagamento String?
  funcao        String?
  tipoDetalhe   String?
  empresa       String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([mes])
  @@index([tipo])
  @@index([status])
  @@index([mes, tipo])
  @@map("custom_items")
}

// Tabela para itens deletados (para não mostrar itens do dados-mensais.js)
model DeletedItem {
  id        String   @id @default(cuid())
  mes       String
  tipo      String
  itemNome  String
  createdAt DateTime @default(now())

  @@unique([mes, tipo, itemNome])
  @@index([mes])
  @@index([mes, tipo])
  @@map("deleted_items")
}

// Tabela para itens editados
model EditedItem {
  id           String   @id @default(cuid())
  mes          String
  tipo         String
  itemNome     String
  novoNome     String?
  novoValor    Float?
  novaCategoria String?
  novoVencimento String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([mes, tipo, itemNome])
  @@index([mes])
  @@index([mes, tipo])
  @@map("edited_items")
}

// Mensagens de conversa do STARK
model ConversationMessage {
  id        String   @id @default(cuid())
  role      String   // "user" ou "assistant"
  content   String
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([createdAt])
  @@map("conversation_messages")
}

// Memória persistente do STARK
model StarkMemory {
  id         String   @id @default(cuid())
  tipo       String   // fato, preferencia, lembrete, contexto
  conteudo   String
  relevancia Int      @default(5) // 1-10
  mes        String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([tipo])
  @@index([relevancia])
  @@index([mes])
  @@map("stark_memories")
}

// =====================================================
// ÁREA FINANCEIRA PESSOAL DOS SÓCIOS
// =====================================================

// Sócios com autenticação separada
model Socio {
  id            String   @id @default(cuid())
  username      String   @unique  // juan, gabriel
  nome          String
  senhaHash     String   // bcrypt hash da senha pessoal
  email         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relações
  despesasPessoais  DespesaPessoal[]
  emprestimos       Emprestimo[]
  investimentos     Investimento[]

  @@map("socios")
}

// Despesas pessoais do sócio
model DespesaPessoal {
  id            String    @id @default(cuid())
  socioId       String
  socio         Socio     @relation(fields: [socioId], references: [id])

  mes           String    // 2025-12
  nome          String    // "Cartão Nubank", "Aluguel Apartamento"
  valor         Float
  categoria     String    // moradia, transporte, alimentacao, lazer, saude, outros
  status        String    @default("A Pagar") // A Pagar, Pago
  vencimento    DateTime?
  dataPagamento DateTime?
  observacao    String?
  recorrente    Boolean   @default(false)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([socioId])
  @@index([mes])
  @@index([status])
  @@index([socioId, mes])
  @@map("despesas_pessoais")
}

// Empréstimos entre sócios e empresa
model Emprestimo {
  id             String    @id @default(cuid())
  socioId        String
  socio          Socio     @relation(fields: [socioId], references: [id])

  tipo           String    // "emprestimo_para_empresa", "adiantamento_do_socio", "emprestimo_entre_socios"
  valor          Float
  valorRestante  Float     // Quanto ainda falta pagar/receber
  descricao      String
  dataInicio     DateTime
  dataPrevisao   DateTime? // Previsão de quitação
  status         String    @default("Ativo") // Ativo, Quitado

  // Se for entre sócios
  socioDestinoId String?

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([socioId])
  @@index([status])
  @@index([socioId, status])
  @@map("emprestimos")
}

// Investimentos/Aportes dos sócios
model Investimento {
  id            String   @id @default(cuid())
  socioId       String
  socio         Socio    @relation(fields: [socioId], references: [id])

  tipo          String   // "aporte_capital", "reinvestimento", "distribuicao"
  valor         Float
  descricao     String
  dataOperacao  DateTime
  mes           String   // Para filtrar por período

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([socioId])
  @@index([mes])
  @@index([socioId, mes])
  @@map("investimentos")
}
